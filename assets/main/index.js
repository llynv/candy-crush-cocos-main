System.register("chunks:///_virtual/AnimationConfig.ts",["cc"],(function(i){var n;return{setters:[function(i){n=i.cclegacy}],execute:function(){n._RF.push({},"48ef7wzMFJKFrBHyPhWcPlB","AnimationConfig",void 0);i("CONFIG",{SELECTION_CONFIG:{duration:.3,glowDuration:.18,settleDuration:.12,easing:"sineOut"},DRAG_CONFIG:{duration:.2,easing:"backOut",scaleMultiplier:1.3},DESTRUCTION_CONFIG:{duration:.35,easing:"backIn",bounceMultiplier:1.4},SPAWN_CONFIG:{duration:.5,easing:"backOut",scaleMultiplier:1},BOUNCE_CONFIG:{duration:.08,easing:"quadOut",scaleMultiplier:1.25},MOVEMENT_CONFIG:{duration:.25,easing:"quadOut"},PULSE_CONFIG:{duration:.15,easing:"sineInOut",scaleMultiplier:1.08},DESELECTION_CONFIG:{duration:.2,easing:"sineIn"}}),i("COLOR_PRESETS",{SELECTION_GLOW:{r:255,g:255,b:150,a:255},SELECTION_ACTIVE:{r:255,g:255,b:200,a:255},DRAG_TINT:{r:180,g:180,b:255,a:160},ORIGINAL:{r:255,g:255,b:255,a:255},TRANSPARENT:{r:255,g:255,b:255,a:0}});n._RF.pop()}}}));

System.register("chunks:///_virtual/AnimationManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Tile.ts","./GameConfig.ts","./BoardManager.ts","./AnimationConfig.ts","./ParticleEffectManager.ts"],(function(n){var e,t,i,o,a,r,s,l,c,u,d,p,g,f,h,m,w,P,b,x,v,y,S;return{setters:[function(n){e=n.applyDecoratedDescriptor,t=n.inheritsLoose,i=n.initializerDefineProperty,o=n.assertThisInitialized,a=n.asyncToGenerator,r=n.regeneratorRuntime,s=n.createForOfIteratorHelperLoose},function(n){l=n.cclegacy,c=n._decorator,u=n.Node,d=n.Vec3,p=n.Color,g=n.tween,f=n.Component,h=n.Tween,m=n.instantiate,w=n.Sprite,P=n.UITransform},function(n){b=n.Tile},function(n){x=n.GameConfig},function(n){v=n.BoardManager},function(n){y=n.CONFIG},function(n){S=n.ParticleEffectManager}],execute:function(){var O,I,C,M,T;l._RF.push({},"4f953lsZIFErKJ3FieNEEoj","AnimationManager",void 0);var k=c.ccclass,E=c.property;n("AnimationManager",(O=k("AnimationManager"),I=E(u),O((T=e((M=function(n){function e(){for(var e,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=n.call.apply(n,[this].concat(a))||this,i(e,"rotationContainer",T,o(e)),e.boardManager=null,e.tile=null,e.originalScale=new d(1,1,1),e.originalColor=p.WHITE.clone(),e.isAnimating=!1,e.selectionTween=null,e}t(e,n);var l=e.prototype;return l.onLoad=function(){this.boardManager=this.node.getComponent(v),this.tile=this.getComponent(b),this.tile?(this.originalScale.set(this.node.scale),this.tile.getSprite()&&this.originalColor.set(this.tile.getSprite().color)):console.error("AnimationManager requires a Tile component")},l.animateSwap=function(n,e,t){if(!(n.node&&e.node&&n.node.isValid&&e.node.isValid))throw new Error("Invalid tiles for swap animation");n.node.setSiblingIndex(e.node.parent.children.length),g(n.node).to(.15,{position:new d(e.node.x,e.node.y,n.node.position.z),scale:new d(1.85,1.85,1)},{easing:"linear"}).to(.15,{scale:new d(1,1,1)},{easing:"linear"}).start(),g(e.node).to(.3,{position:new d(n.node.x,n.node.y,e.node.position.z)},{easing:"linear"}).call((function(){t()})).start()},l.animateFall=function(){var n=a(r().mark((function n(e){var t,i,o,a,l,c=this;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.boardManager){n.next=2;break}throw new Error("BoardManager not set");case 2:for(t=e[0].tile.node.parent.children,i=s(t);!(o=i()).done;)a=o.value,h.stopAllByTarget(a),a.setScale(1,1,1);return e.forEach((function(n){var e=n.tile,t=n.fromY,i=n.toY,o=n.x,a=n.isNewTile;c.boardManager.getWorldPosition({x:o,y:i});if(a)e.node.setScale(.8,.8,1);else{var r=c.boardManager.getWorldPosition({x:o,y:t});e.node.setPosition(r.x,r.y,0)}})),.1,l=[],e.forEach((function(n,e){var t=n.tile,i=n.toY,o=n.x,a=n.isNewTile,r=n.fromY,s=c.boardManager.getWorldPosition({x:o,y:i}),u=new Promise((function(n){var e=a?.05*Math.abs(r):0,o=.1+.02*Math.abs(r-i),l=g(t.node);e>0&&(l=l.delay(e)),a&&(l=l.to(.1,{scale:new d(1,1,1)},{easing:"backOut"})),l.to(o,{position:new d(s.x,s.y,0)},{easing:"quartIn"}).to(.1,{scale:new d(1.05,.95,1)},{easing:"quadOut"}).to(.1,{scale:new d(1,1,1)},{easing:"backOut"}).call((function(){return n()})).start()}));l.push(u)})),n.next=10,Promise.all(l);case 10:case"end":return n.stop()}}),n,this)})));return function(e){return n.apply(this,arguments)}}(),l.animateIdleTiles=function(){var n=a(r().mark((function n(e){var t,i,o,a,s,l,c,u;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=0;case 1:if(!(t<x.GridHeight)){n.next=8;break}for(i=0,o=t;i<=t&&o>=0;i++,o--)(a=e[o][i])&&a.onPlayerIdle();return n.next=5,new Promise((function(n){return setTimeout(n,50)}));case 5:t++,n.next=1;break;case 8:s=1;case 9:if(!(s<x.GridWidth)){n.next=16;break}for(l=s,c=x.GridHeight-1;l<x.GridWidth&&c>=0;l++,c--)(u=e[c][l])&&u.onPlayerIdle();return n.next=13,new Promise((function(n){return setTimeout(n,50)}));case 13:s++,n.next=9;break;case 16:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),l.animateMatchedTiles=function(n){},l.animateSelection=function(){if(!this.isAnimating){this.stopAllAnimations(),this.isAnimating=!0;var n=this.originalScale.clone().multiplyScalar(1.2);this.selectionTween=g(this.node).to(y.SELECTION_CONFIG.duration,{scale:n},{easing:"sineOut"}).to(y.SELECTION_CONFIG.duration,{scale:this.originalScale},{easing:"sineIn"}).union().repeatForever().start()}},l.animateDeselection=function(){this.isAnimating=!1,this.selectionTween&&(this.selectionTween.stop(),this.selectionTween=null),this.node.scale=this.originalScale},l.animateBounce=function(){var n=this;return new Promise((function(e){if(n.isAnimating)e();else{n.isAnimating=!0;var t=n.originalScale.clone().multiplyScalar(y.BOUNCE_CONFIG.scaleMultiplier);g(n.node).to(y.BOUNCE_CONFIG.duration,{scale:t},{easing:y.BOUNCE_CONFIG.easing}).to(y.BOUNCE_CONFIG.duration,{scale:n.originalScale},{easing:y.BOUNCE_CONFIG.easing}).call((function(){n.isAnimating=!1,e()})).start()}}))},l.animateMoveTo=function(n,e){var t=this,i=e||y.MOVEMENT_CONFIG.duration;return new Promise((function(e){g(t.node).to(i,{position:n},{easing:y.MOVEMENT_CONFIG.easing}).call((function(){e()})).start()}))},l.animatePulse=function(n){if(void 0===n&&(n=2),!this.isAnimating){this.isAnimating=!0;var e=this.originalScale.clone().multiplyScalar(y.PULSE_CONFIG.scaleMultiplier);g(this.node).to(y.PULSE_CONFIG.duration,{scale:e},{easing:y.PULSE_CONFIG.easing}).to(y.PULSE_CONFIG.duration,{scale:this.originalScale},{easing:y.PULSE_CONFIG.easing}).union().repeat(n).start()}},l.stopAllAnimations=function(){var n,e;this.isAnimating&&(g(this.node).stop(),null!=(n=this.tile)&&n.getSprite()&&g(this.tile.getSprite()).stop(),this.selectionTween&&(this.selectionTween.stop(),this.selectionTween=null),this.node.scale=this.originalScale,null!=(e=this.tile)&&e.getSprite()&&(this.tile.getSprite().color=this.originalColor),this.isAnimating=!1)},l.getIsAnimating=function(){return this.isAnimating},l.updateOriginalValues=function(){var n;this.originalScale.set(this.node.scale),null!=(n=this.tile)&&n.getSprite()&&this.originalColor.set(this.tile.getSprite().color)},l.animatePlayerIdle=function(){var n=this;this.isAnimating||(this.isAnimating=!0,g(this.node).to(.4,{scale:new d(1.15,1.15,1.15)},{easing:"sineOut"}).to(.4,{scale:new d(1,1,1)},{easing:"sineIn"}).union().call((function(){n.isAnimating=!1})).start())},l.animateDestroy=function(n,e){g(this.node).to(.1,{scale:new d(1.1,1.1,1.1)},{easing:"quadOut"}).to(.15,{scale:new d(0,0,0)},{easing:"quadIn"}).call((function(){null==n||n(),null==e||e()})).start()},l.animateMilestoneCelebration=function(){var n=a(r().mark((function n(e,t){var i,o,a,s,l,c,u,p,f,h,w,P,b,v,y,S,O;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.boardManager){n.next=2;break}throw new Error("BoardManager not set");case 2:for(o=[],a=0;a<x.GridHeight;a++)for(s=0;s<x.GridWidth;s++)(l=e[a][s])&&l.node&&l.node.isValid&&o.push({tile:l,originalPos:l.node.position.clone(),originalParent:l.node.parent});if(0!==o.length){n.next=6;break}return n.abrupt("return");case 6:return c=o.length,u=x.MilestoneSystem.celebrationAnimationDuration,p=.1*u,f=.7*u,h=.2*u,w=t.position.clone(),P=x.GridWidth*x.TileWidth/2-x.TileWidth,b=x.GridHeight*x.TileHeight/2-x.TileHeight,v=1.1*Math.min(P,b),y=o.map((function(n,e){return new Promise((function(t){var i=e/c*Math.PI*2,o=w.x+Math.cos(i)*v,a=w.y+Math.sin(i)*v,r=e/c*.05;g(n.tile.node).delay(r).parallel(g(n.tile.node).to(p,{position:new d(o,a,0)},{easing:"quadOut"}),g(n.tile.node).to(.5*p,{scale:new d(.85,.85,1)},{easing:"quadOut"}).to(.5*p,{scale:new d(1,1,1)},{easing:"quadOut"})).call((function(){return t()})).start()}))})),n.next=18,Promise.all(y);case 18:return S=m(this.rotationContainer),null==(i=t.parent)||i.addChild(S),S.setPosition(w),S.setSiblingIndex(this.rotationContainer.getSiblingIndex()),o.forEach((function(n){var e=n.tile.node.getWorldPosition();n.tile.node.setParent(S),n.tile.node.setWorldPosition(e)})),n.next=25,new Promise((function(n){g(S).to(f,{angle:-720},{easing:"sineInOut"}).call((function(){return n()})).start()}));case 25:return o.forEach((function(n){var e=n.tile.node.getWorldPosition();n.tile.node.setParent(n.originalParent),n.tile.node.setWorldPosition(e)})),S.destroy(),O=o.map((function(n,e){return new Promise((function(t){var i=e/c*.1;g(n.tile.node).delay(i).parallel(g(n.tile.node).to(h,{position:n.originalPos},{easing:"backOut"}),g(n.tile.node).to(.2*h,{scale:new d(1.1,1.1,1)},{easing:"quadOut"}).to(.8*h,{scale:new d(1,1,1)},{easing:"bounceOut"})).call((function(){return t()})).start()}))})),n.next=30,Promise.all(O);case 30:case"end":return n.stop()}}),n,this)})));return function(e,t){return n.apply(this,arguments)}}(),l.animateDoubleRainbow=function(){var n=a(r().mark((function n(e,t,i){var o,a,s,l,c,u,p,f;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=e.node)&&o.isValid&&null!=(a=t.node)&&a.isValid){n.next=2;break}return n.abrupt("return");case 2:if(this.node.getComponent(S),e.node.parent){n.next=6;break}return n.abrupt("return");case 6:return e.node.setSiblingIndex(t.node.parent.children.length),t.node.setSiblingIndex(e.node.parent.children.length),s=e.node.position.clone(),l=t.node.position.clone(),(c=s.clone().add(l).multiplyScalar(.5)).y+=120,u=function(n){return new Promise((function(e){g(n.node).to(.25,{position:new d(n.node.position.x,n.node.position.y+120,0),scale:new d(1.2,1.2,1)},{easing:"quadOut"}).to(.25,{position:c},{easing:"quadIn"}).call((function(){return e()})).start()}))},n.next=15,Promise.all([u(e),u(t)]);case 15:return n.next=17,new Promise((function(n){g(t.node).to(.2,{scale:new d(0,0,0)}).call((function(){return n()})).start()}));case 17:return n.next=19,new Promise((function(n){g(e.node).to(.2,{scale:new d(2.5,2.5,1)},{easing:"sineOut"}).call((function(){n()})).start()}));case 19:return p=function(n){return new Promise((function(e){g(n.node).to(.25,{position:new d(n.node.position.x,n.node.position.y+120,0)},{easing:"quadOut"}).call((function(){return e()})).start()}))},n.next=22,Promise.all([p(e),p(t)]);case 22:return f=function(n){return new Promise((function(e){g(n.node).to(.25,{position:new d(l.x,l.y,0)},{easing:"quadOut"}).call((function(){return e()})).start()}))},n.next=25,Promise.all([f(e),f(t)]);case 25:case"end":return n.stop()}}),n,this)})));return function(e,t,i){return n.apply(this,arguments)}}(),l.animateRainbowClickEffect=function(){var n=a(r().mark((function n(e,t){var i,o,a;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(i=e.node)&&i.isValid&&e.node.parent){n.next=2;break}return n.abrupt("return");case 2:e.node.setSiblingIndex(e.node.parent.children.length),o=e.node.position.clone(),a=e.node.scale.clone(),g(e.node).parallel(g(e.node).to(.2,{position:new d(o.x,o.y+60,0)},{easing:"backOut"}),g(e.node).to(.2,{scale:new d(1.5*a.x,1.5*a.y,1)},{easing:"backOut"})).parallel(g(e.node).to(.2,{position:o},{easing:"backIn"}),g(e.node).to(.2,{scale:new d(.5*a.x,.5*a.y,1)},{easing:"backIn"})).delay(.1).call((function(){null==t||t()})).start();case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),l.animateRainbowSwapToType=function(){var n=a(r().mark((function n(e,t,i){var o,a,s,l,c,p,f,h,m,b,v,y;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=e.node)&&o.isValid&&e.node.parent){n.next=2;break}return n.abrupt("return");case 2:if(i.length){n.next=4;break}return n.abrupt("return");case 4:for(a=i.length,s=[],l=e.node.position.clone(),c=0;c<a;c++)(p=new u("RainbowPiece_"+c)).addComponent(w),f=p.getComponent(w),(h=p.addComponent(P))&&h.setContentSize(x.SpriteSize,x.SpriteSize),(m=e.getSprite())&&m.spriteFrame&&(f.spriteFrame=m.spriteFrame),p.setParent(e.node.parent),p.setPosition(l),p.setScale(.5,.5,1),s.push(p);return g(e.node).to(.2,{scale:new d(0,0,1)},{easing:"backIn"}).start(),b=s.map((function(n,e){var t=e/a*360+60*Math.random()-30,i=80+40*Math.random(),o=Math.cos(t*Math.PI/180)*i,r=Math.sin(t*Math.PI/180)*i;return new Promise((function(e){g(n).to(.3,{position:new d(l.x+o,l.y+r,0),scale:new d(.6,.6,1)},{easing:"backOut"}).call((function(){return e()})).start()}))})),n.next=12,Promise.all(b);case 12:return n.next=14,new Promise((function(n){return setTimeout(n,200)}));case 14:return v=s.map((function(n,e){var t,o=i[e];if(null==(t=o.node)||!t.isValid)return Promise.resolve();var a=o.node.position.clone(),r=.07*e;return new Promise((function(e){g(n).delay(r).to(.5,{position:a,scale:new d(.2,.2,1)},{easing:"quadInOut"}).call((function(){var t;null!=(t=o.node)&&t.isValid&&g(o.node).to(.1,{scale:new d(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new d(0,0,1)},{easing:"backIn"}).start(),n.destroy(),e()})).start()}))})),n.next=17,Promise.all(v);case 17:(y=this.node.getComponent(S))&&e.node.parent&&y.playSparkleEffect(l,e.node.parent);case 19:case"end":return n.stop()}}),n,this)})));return function(e,t,i){return n.apply(this,arguments)}}(),l.animateCombine=function(){var n=a(r().mark((function n(e,t,i,o){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:g(e.node).to(.1,{position:t.node.getPosition()},{easing:"quadOut"}).call((function(){null==i||i(),null==o||o()})).start();case 1:case"end":return n.stop()}}),n)})));return function(e,t,i,o){return n.apply(this,arguments)}}(),e}(f)).prototype,"rotationContainer",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=M))||C));l._RF.pop()}}}));

System.register("chunks:///_virtual/AssetLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,o,t,s,a,i,n,c,p,u,l;return{setters:[function(r){e=r.applyDecoratedDescriptor,o=r.inheritsLoose,t=r.initializerDefineProperty,s=r.assertThisInitialized},function(r){a=r.cclegacy,i=r._decorator,n=r.ProgressBar,c=r.director,p=r.resources,u=r.SpriteFrame,l=r.Component}],execute:function(){var d,f,g,h,B;a._RF.push({},"ff792SUt8BAQoHTgLc+DQEW","AssetLoader",void 0);var m=i.ccclass,y=i.property;r("AssetLoader",(d=m("AssetLoader"),f=y(n),d((B=e((h=function(r){function e(){for(var e,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=r.call.apply(r,[this].concat(a))||this,t(e,"progressBar",B,s(e)),e}o(e,r);var a=e.prototype;return a.__preload=function(){if(!this.progressBar)throw new Error("ProgressBar is required");c.preloadScene("GameScene"),p.preloadDir("images")},a.start=function(){var r=this;p.loadDir("images",u,(function(e,o){r.updateProgressBar(e/o)}),(function(e){e?console.error(e):(r.updateProgressBar(1),r.switchToGameScene())}))},a.updateProgressBar=function(r){this.progressBar.progress=r},a.switchToGameScene=function(){c.loadScene("GameScene")},e}(l)).prototype,"progressBar",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=h))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/BoardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Tile.ts","./Frame.ts","./GameGlobalData.ts"],(function(t){var i,e,r,n,a,l,o,s,h,d,u,f,c,G;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,l=t._decorator,o=t.Prefab,s=t.instantiate,h=t.Button,d=t.Component},function(t){u=t.GameConfig},function(t){f=t.Tile},function(t){c=t.Frame},function(t){G=t.GameGlobalData}],execute:function(){var g,T,v,m,p,y,b;a._RF.push({},"76c733eZfpJ+bMWRYNX9PiB","BoardManager",void 0);var A=l.ccclass,P=l.property;t("BoardManager",(g=A("BoardManager"),T=P(o),v=P(o),g((y=i((p=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),l=0;l<e;l++)a[l]=arguments[l];return i=t.call.apply(t,[this].concat(a))||this,r(i,"tilePrefab",y,n(i)),r(i,"framePrefab",b,n(i)),i.tileGrid=[],i.frameGrid=[],i.virtualGrid=[],i.tileCoords=new Map,i.maxDifference=4,i.VIRTUAL_GRID_HEIGHT=u.GridHeight,i}e(i,t);var a=i.prototype;return a.__preload=function(){if(null===this.tilePrefab)throw new Error("Tile prefab is not set");if(null===this.framePrefab)throw new Error("Frame prefab is not set")},a.setTilePrefab=function(t){this.tilePrefab=t},a.setFramePrefab=function(t){this.framePrefab=t},a.createFrames=function(){this.frameGrid=[];for(var t=0;t<u.GridHeight;t++){this.frameGrid[t]=[];for(var i=0;i<u.GridWidth;i++)this.frameGrid[t][i]=this.createFrame(i,t)}},a.initializeBoard=function(){this.createTiles(),this.initializeVirtualGrid()},a.getTileGrid=function(){return this.tileGrid},a.getFrameGrid=function(){return this.frameGrid},a.getVirtualGrid=function(){return this.virtualGrid},a.getVirtualGridHeight=function(){return this.VIRTUAL_GRID_HEIGHT},a.getTileCoords=function(){return this.tileCoords},a.getTileAt=function(t,i){if(i>=0&&i<this.tileGrid.length&&t>=0&&t<this.tileGrid[i].length)return this.tileGrid[i][t]},a.getVirtualTileAt=function(t,i){if(i>=0&&i<this.virtualGrid.length&&t>=0&&t<this.virtualGrid[i].length)return this.virtualGrid[i][t]},a.setTileAt=function(t,i,e){i>=0&&i<this.tileGrid.length&&t>=0&&t<this.tileGrid[i].length&&(this.tileGrid[i][t]=e,e&&this.tileCoords.set(e,{x:t,y:i}))},a.setVirtualTileAt=function(t,i,e){i>=0&&i<this.virtualGrid.length&&t>=0&&t<this.virtualGrid[i].length&&(this.virtualGrid[i][t]=e,e&&this.tileCoords.set(e,{x:t,y:-(i+1)}))},a.getWorldPosition=function(t){return{x:-u.GridWidth*u.TileWidth/2+u.TileWidth/2+t.x*u.TileWidth+u.OffsetX,y:-(-u.GridHeight*u.TileHeight/2+u.TileHeight/2+t.y*u.TileHeight+u.OffsetY)}},a.getVirtualWorldPosition=function(t){return{x:-u.GridWidth*u.TileWidth/2+u.TileWidth/2+t.x*u.TileWidth,y:-(-u.GridHeight*u.TileHeight/2+u.TileHeight/2+(-t.y-this.VIRTUAL_GRID_HEIGHT)*u.TileHeight)}},a.getNeighbors=function(t){var i=[],e=t.x,r=t.y;return e>0&&this.getTileAt(e-1,r)&&i.push(this.getTileAt(e-1,r)),e<u.GridWidth-1&&this.getTileAt(e+1,r)&&i.push(this.getTileAt(e+1,r)),r>0&&this.getTileAt(e,r-1)&&i.push(this.getTileAt(e,r-1)),r<u.GridHeight-1&&this.getTileAt(e,r+1)&&i.push(this.getTileAt(e,r+1)),i},a.createTileAt=function(t,i){var e,r=u.CandyTypes[Math.floor(Math.random()*Math.min(this.maxDifference,u.CandyTypes.length))],n=s(this.tilePrefab);if(null===n)throw new Error("Failed to instantiate tile prefab");var a=n.getComponent(f);if(null===a)throw new Error("Failed to get tile component");null==(e=this.node)||e.addChild(n),a.setTileType(r);var l=this.getWorldPosition({x:t,y:i}),o=l.x,h=l.y;n.setPosition(o,h);var d=this.frameGrid[i][t];return d&&a.setFrame(d),this.tileCoords.set(a,{x:t,y:i}),this.tileGrid[i][t]=a,a},a.createVirtualTileAt=function(t,i){var e,r=u.CandyTypes[Math.floor(Math.random()*Math.min(this.maxDifference,u.CandyTypes.length))],n=s(this.tilePrefab);if(null===n)throw new Error("Failed to instantiate tile prefab");var a=n.getComponent(f);if(null===a)throw new Error("Failed to get tile component");null==(e=this.node)||e.addChild(n),a.setTileType(r);var l=this.getVirtualWorldPosition({x:t,y:i}),o=l.x,h=l.y;return n.setPosition(o,h),n.active=!1,this.tileCoords.set(a,{x:t,y:-(i+1)}),this.virtualGrid[i][t]=a,a},a.moveVirtualTileToMainGrid=function(t,i,e,r){var n=this.getVirtualTileAt(t,i);if(!n)return null;this.setVirtualTileAt(t,i,void 0),this.setTileAt(e,r,n);var a=this.frameGrid[r][e];return a&&n.setFrame(a),n},a.getVirtualTilesForColumn=function(t,i){for(var e=[],r=0,n=this.VIRTUAL_GRID_HEIGHT-1;n>=0&&r<i;n--){var a=this.getVirtualTileAt(t,n);if(a){a.node.active=!0;var l=a.node.getComponent(h);l&&(l.interactable=!G.getInstance().getIsGamePaused());var o=-(r+1),s=this.getWorldPosition({x:t,y:o});a.node.setPosition(s.x,s.y,0),e.push(a),this.setVirtualTileAt(t,n,void 0),r++}}return e},a.refillVirtualGrid=function(){for(var t=0;t<u.GridWidth;t++)for(var i=0;i<this.VIRTUAL_GRID_HEIGHT;i++){if(!this.getVirtualTileAt(t,i))this.createVirtualTileAt(t,i).node.active=!1}},a.clearTileAt=function(t,i){var e=this.tileGrid[i][t];e&&(this.tileCoords.delete(e),this.tileGrid[i][t]=void 0)},a.initializeVirtualGrid=function(){this.virtualGrid=[];for(var t=0;t<this.VIRTUAL_GRID_HEIGHT;t++){this.virtualGrid[t]=[];for(var i=0;i<u.GridWidth;i++)this.virtualGrid[t][i]=this.createVirtualTileAt(i,t)}},a.createTiles=function(){this.tileGrid=[];for(var t=0;t<u.GridHeight;t++){this.tileGrid[t]=[];for(var i=0;i<u.GridWidth;i++)this.tileGrid[t][i]=this.createTileAt(i,t)}},a.createFrame=function(t,i){var e,r=s(this.framePrefab);if(null===r)throw new Error("Failed to instantiate frame prefab");var n=r.getComponent(c);if(null===n)throw new Error("Failed to get Frame component");var a=this.getWorldPosition({x:t,y:i}),l=a.x,o=a.y;return r.setPosition(l,o),n.setSpriteFrame((t+i)%2),null==(e=this.node)||e.addChild(r),n.setTweenDuration(.15),n},i}(d)).prototype,"tilePrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=i(p.prototype,"framePrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=p))||m));a._RF.pop()}}}));

System.register("chunks:///_virtual/Frame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts"],(function(i){var t,e,r,s,o,n,a,p,h,l,c,u;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,r=i.initializerDefineProperty,s=i.assertThisInitialized},function(i){o=i.cclegacy,n=i._decorator,a=i.Sprite,p=i.SpriteFrame,h=i.UITransform,l=i.tween,c=i.Component},function(i){u=i.GameConfig}],execute:function(){var g,f,m,v,F,A,b;o._RF.push({},"6a8c2mjIgVAtJADtmbpcPpA","Frame",void 0);var w=n.ccclass,y=n.property;i("Frame",(g=w("Frame"),f=y(a),m=y([p]),g((A=t((F=function(i){function t(){for(var t,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return t=i.call.apply(i,[this].concat(o))||this,r(t,"sprite",A,s(t)),r(t,"spriteFrames",b,s(t)),t.originalAlpha=.6,t.hoverAlpha=.7,t.isHovering=!1,t.tweenDuration=.15,t}e(t,i);var o=t.prototype;return o.__preload=function(){if(!this.sprite)throw new Error("Sprite is required for Frame")},o.onLoad=function(){if(!this.sprite)throw new Error("Sprite is required for Frame");var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.originalAlpha)},o.setSpriteFrame=function(i){if(!(!this.sprite||!this.spriteFrames||i<0||i>=this.spriteFrames.length)){this.sprite.spriteFrame=this.spriteFrames[i];var t=this.sprite.node.getComponent(h);t&&t.setContentSize(u.FrameSize,u.FrameSize)}},o.triggerMouseEnter=function(){if(!this.isHovering&&this.sprite){this.isHovering=!0;var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.hoverAlpha)}},o.triggerMouseLeave=function(){if(this.isHovering&&this.sprite){this.isHovering=!1;var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.originalAlpha)}},o.setHoverState=function(i){i?this.triggerMouseEnter():this.triggerMouseLeave()},o.setHoverAlpha=function(i){this.hoverAlpha=Math.max(0,Math.min(1,i))},o.setOriginalAlpha=function(i){this.originalAlpha=Math.max(0,Math.min(1,i))},o.setTweenDuration=function(i){this.tweenDuration=Math.max(.05,i)},o.getIsHovering=function(){return this.isHovering},o.resetFrame=function(){if(this.sprite){l(this.sprite).stop();var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.originalAlpha),this.isHovering=!1}},o.onDestroy=function(){this.sprite&&l(this.sprite).stop()},t}(c)).prototype,"sprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(F.prototype,"spriteFrames",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=F))||v));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameConfig.ts",["cc"],(function(e){var n,w,a;return{setters:[function(e){n=e.cclegacy,w=e.Vec3,a=e.Color}],execute:function(){n._RF.push({},"066a2a7XoVHzJHXDKi1vGjH","GameConfig",void 0);e("PatternShape",[{name:"HorizontalLine5",shape:[new w(0,0),new w(1,0),new w(2,0),new w(3,0),new w(4,0)]},{name:"VerticalLine5",shape:[new w(0,0),new w(0,1),new w(0,2),new w(0,3),new w(0,4)]},{name:"PlusShape",shape:[new w(0,0),new w(1,0),new w(0,1),new w(0,-1),new w(-1,0)]},{name:"LShapeLeft",shape:[new w(0,0),new w(0,1),new w(0,2),new w(-1,0),new w(-2,0)]},{name:"LShapeRight",shape:[new w(0,0),new w(0,1),new w(0,2),new w(1,0),new w(2,0)]},{name:"LShapeUp",shape:[new w(0,0),new w(0,-1),new w(0,-2),new w(1,0),new w(2,0)]},{name:"LShapeDown",shape:[new w(0,0),new w(0,-1),new w(0,-2),new w(-1,0),new w(-2,0)]},{name:"TShapeUp",shape:[new w(0,0),new w(-1,0),new w(1,0),new w(0,1),new w(0,2)]},{name:"TShapeDown",shape:[new w(0,0),new w(-1,0),new w(1,0),new w(0,-1),new w(0,-2)]},{name:"TShapeLeft",shape:[new w(0,0),new w(0,1),new w(0,-1),new w(-1,0),new w(-2,0)]},{name:"TShapeRight",shape:[new w(0,0),new w(0,1),new w(0,-1),new w(1,0),new w(2,0)]},{name:"HorizontalLine4",shape:[new w(0,0),new w(1,0),new w(2,0),new w(3,0)]},{name:"VerticalLine4",shape:[new w(0,0),new w(0,1),new w(0,2),new w(0,3)]},{name:"HorizontalLine3",shape:[new w(0,0),new w(1,0),new w(2,0)]},{name:"VerticalLine3",shape:[new w(0,0),new w(0,1),new w(0,2)]}]),e("GameConfig",{GridWidth:8,GridHeight:8,TileWidth:64,TileHeight:64,SpriteSize:58,FrameSize:60,OffsetX:0,OffsetY:40,MaxIdleTime:10,HintTime:5,Moves:10,MilestoneSystem:{milestoneThresholds:[2e3,4500,7500,11e3,15e3,2e4,25e3,3e4,35e3,4e4,45e3,5e4,55e3,6e4,65e3,7e4,75e3,8e4,85e3,9e4,95e3,1e5],movePerMilestone:[10,20,30,40,50,60,70,80,90,100],pointsPerTile:10,bonusPoints:{match4:50,match5Plus:100},celebrationAnimationDuration:6},RainbowClick:{minDestroyCount:6,maxDestroyCount:20},CandyTypes:[{name:"Blue Candy",color:new a(55,78,252,255)},{name:"Green Candy",color:new a(0,128,0,255)},{name:"Orange Candy",color:new a(255,126,25,255)},{name:"Red Candy",color:new a(255,0,0,255)},{name:"Yellow Candy",color:new a(255,255,0,255)},{name:"Purple Candy",color:new a(128,0,128,255)}]});n._RF.pop()}}}));

System.register("chunks:///_virtual/GameGlobalData.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton.ts"],(function(e){var t,s,n;return{setters:[function(e){t=e.inheritsLoose},function(e){s=e.cclegacy},function(e){n=e.Singleton}],execute:function(){s._RF.push({},"65b77HWEHtHDpqHoObcPmcf","GameGlobalData",void 0);e("GameGlobalData",function(e){function s(){for(var t,s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).isMouseDown=!1,t.isGamePaused=!1,t.isGameOver=!1,t}t(s,e);var n=s.prototype;return n.getIsMouseDown=function(){return this.isMouseDown},n.setIsMouseDown=function(e){this.isMouseDown=e},n.getIsGamePaused=function(){return this.isGamePaused},n.setIsGamePaused=function(e){this.isGamePaused=e},n.getIsGameOver=function(){return this.isGameOver},n.setIsGameOver=function(e){this.isGameOver=e},s}(n));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./GameGlobalData.ts","./BoardManager.ts","./MatchManager.ts","./AnimationManager.ts","./InputManager.ts","./ProgressManager.ts","./SpecialTileManager.ts","./ParticleEffectManager.ts","./Singleton.ts","./SpecialTileConfig.ts","./MilestoneAchievementUI.ts","./PausePopup.ts","./GameOverPopup.ts","./ProgressUI.ts","./ScreenAdapter.ts"],(function(e){var t,n,i,r,a,s,o,l,c,u,d,h,p,f,g,v,m,b,M,T,w,x,y,S,I,k,G,P,C,B;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,s=e.regeneratorRuntime,o=e.createForOfIteratorHelperLoose},function(e){l=e.cclegacy,c=e._decorator,u=e.Camera,d=e.Node,h=e.Button,p=e.tween,f=e.Vec3},function(e){g=e.GameConfig},function(e){v=e.GameGlobalData},function(e){m=e.BoardManager},function(e){b=e.MatchManager},function(e){M=e.AnimationManager},function(e){T=e.InputManager},function(e){w=e.ProgressManager},function(e){x=e.SpecialTileManager},function(e){y=e.ParticleEffectManager},function(e){S=e.Singleton},function(e){I=e.SpecialTileType},function(e){k=e.MilestoneAchievementUI},function(e){G=e.PausePopup},function(e){P=e.GameOverPopup},function(e){C=e.ProgressUI},function(e){B=e.ScreenAdapter}],execute:function(){var E,A,O,D,R,U,H,F,N,W,_,V,q,z,Y,L,j,J,K;l._RF.push({},"cb6b24lA09FMol6Lsdq977r","GameManager",void 0);var Q=c.ccclass,X=c.property;e("default",(E=Q("GameManager"),A=X(u),O=X(d),D=X(d),R=X(d),U=X(G),H=X(P),F=X(h),N=X(B),E((V=t((_=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,i(t,"camera",V,r(t)),i(t,"celebrationNode",q,r(t)),i(t,"milestoneUINode",z,r(t)),i(t,"progressUINode",Y,r(t)),i(t,"pausePopupUI",L,r(t)),i(t,"gameOverPopup",j,r(t)),i(t,"pauseButton",J,r(t)),i(t,"screenAdapter",K,r(t)),t.boardManager=null,t.matchManager=null,t.animationManager=null,t.inputManager=null,t.specialTileManager=null,t.particleEffectManager=null,t.milestoneAchievementUI=null,t.pausePopup=null,t.progressUI=null,t.playerIdleTimeForHint=0,t.playerIdleTimeForMaxIdle=0,t.canMove=!1,t.firstSelectedTile=void 0,t.secondSelectedTile=void 0,t.swappedTiles=[],t.triggeredSpecialTiles=[],t.isGamePaused=!1,t.isGameOver=!1,t.movesRemaining=g.Moves,t.hintActive=!1,t}n(t,e);var l=t.prototype;return l.__preload=function(){var e,t;if(this.assignManagers(),!this.boardManager)throw new Error("BoardManager is required");if(!this.matchManager)throw new Error("MatchManager is required");if(!this.animationManager)throw new Error("AnimationManager is required");if(!this.inputManager)throw new Error("InputManager is required");if(!this.specialTileManager)throw new Error("SpecialTileManager is required");if(!this.particleEffectManager)throw new Error("ParticleEffectManager is required");if(!this.pausePopup)throw new Error("PausePopup is required");this.milestoneAchievementUI=null==(e=this.milestoneUINode)?void 0:e.getComponent(k),this.progressUI=null==(t=this.progressUINode)?void 0:t.getComponent(C)},l.start=function(){this.setupScreenAdapter(),this.setupProgressManager(),this.createBoard(),this.setupPauseButton()},l.update=function(e){this.checkIdleTime(e)},l.assignManagers=function(){var e;this.boardManager=this.node.getComponent(m),this.matchManager=this.node.getComponent(b),this.animationManager=this.node.getComponent(M),this.inputManager=this.node.getComponent(T),this.specialTileManager=this.node.getComponent(x),this.particleEffectManager=this.node.getComponent(y),this.pausePopup=null==(e=this.pausePopupUI)?void 0:e.getComponent(G),this.screenAdapter||(this.screenAdapter=this.node.getComponent(B)||this.node.getComponentInChildren(B))},l.setupScreenAdapter=function(){this.screenAdapter?(console.log("Screen adapter found, applying mobile responsiveness..."),this.screenAdapter.forceAdaptation()):console.warn("ScreenAdapter not found. Mobile responsiveness may not work properly.")},l.setupProgressManager=function(){w.getInstance().onMilestoneCompleted(this.handleMilestoneCompleted.bind(this))},l.setupPauseButton=function(){this.pausePopup&&(this.setupPausePopupCallbacks(),this.setupPauseButtonEvents())},l.setupPausePopupCallbacks=function(){var e=this;this.pausePopup.setCallbacks((function(){var t;e.setGameInteractionEnabled(!0),v.getInstance().setIsGamePaused(!1),e.checkMatches(),null==(t=e.pausePopup)||t.hide()}),(function(){return e.startNewGame()}))},l.setupPauseButtonEvents=function(){var e,t,n,i,r,a=this;null==(e=this.pauseButton)||e.node.on(d.EventType.TOUCH_END,(function(){var e;null==(e=a.pausePopup)||e.show(),console.log(a.pausePopup),a.setGameInteractionEnabled(!1),v.getInstance().setIsGamePaused(!0)})),null==(t=this.pauseButton)||t.node.on(d.EventType.TOUCH_START,(function(){a.animatePauseButtonPress()})),null==(n=this.pauseButton)||n.node.on(d.EventType.TOUCH_END,(function(){a.animatePauseButtonRelease()})),null==(i=this.pauseButton)||i.node.on(d.EventType.MOUSE_ENTER,(function(){a.animatePauseButtonHover()})),null==(r=this.pauseButton)||r.node.on(d.EventType.MOUSE_LEAVE,(function(){a.animatePauseButtonLeave()}))},l.animatePauseButtonPress=function(){var e;p(null==(e=this.pauseButton)?void 0:e.node).to(.1,{scale:new f(.9,.9,1)},{easing:"quadOut"}).start()},l.animatePauseButtonRelease=function(){var e;p(null==(e=this.pauseButton)?void 0:e.node).to(.1,{scale:new f(1,1,1)},{easing:"quadOut"}).start()},l.animatePauseButtonHover=function(){var e;p(null==(e=this.pauseButton)?void 0:e.node).to(.1,{scale:new f(1.1,1.1,1)},{easing:"quadOut"}).start()},l.animatePauseButtonLeave=function(){var e;p(null==(e=this.pauseButton)?void 0:e.node).to(.1,{scale:new f(1,1,1)},{easing:"quadOut"}).start()},l.handleMilestoneCompleted=function(){var e=a(s().mark((function e(){var t,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Milestone completed! Starting celebration sequence..."),this.canMove=!1,v.getInstance().setIsMouseDown(!1),t=w.getInstance().getMilestoneData(),this.milestoneAchievementUI&&this.milestoneAchievementUI.showMilestoneAchievement(t),this.clearBoard(),this.boardManager.initializeBoard(),this.resetFrames(),n=this.boardManager.getTileGrid(),i=this.animationManager.animateMilestoneCelebration(n,this.celebrationNode),e.next=12,Promise.all([i]);case 12:return this.setupTileCallbacks(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.movesRemaining=g.Moves,this.updateMovesDisplay(this.movesRemaining),e.next=19,this.resetTile();case 19:return e.next=21,this.checkMatches();case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.clearBoard=function(){for(var e=this.boardManager.getTileGrid(),t=0;t<g.GridHeight;t++)for(var n=0;n<g.GridWidth;n++){var i=e[t][n];i&&i.node&&i.node.isValid&&i.node.destroy(),this.boardManager.setTileAt(n,t,void 0)}},l.createBoard=function(){var e=a(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=!1),this.canMove=!1,t||this.boardManager.createFrames(),v.getInstance().setIsMouseDown(!0),this.boardManager.initializeBoard(),this.setupTileCallbacks(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,e.next=10,this.checkMatches();case 10:this.updateMovesDisplay(this.movesRemaining);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.setupTileCallbacks=function(){for(var e=this.boardManager.getTileGrid(),t=0;t<g.GridHeight;t++)for(var n=0;n<g.GridWidth;n++){var i=e[t][n];i&&(i.addOnMouseDownCallback(this.tileDown.bind(this)),i.addOnMouseUpCallback(this.tileDown.bind(this)),i.addOnRainbowClickCallback(this.handleRainbowClick.bind(this)))}},l.checkIdleTime=function(e){this.playerIdleTimeForHint+=e,this.playerIdleTimeForMaxIdle+=e,this.playerIdleTimeForHint>=g.HintTime&&(this.playerIdleTimeForHint=0,this.showHint()),this.playerIdleTimeForMaxIdle>=g.MaxIdleTime&&(this.playerIdleTimeForMaxIdle=0,this.animationManager.animateIdleTiles(this.boardManager.getTileGrid()))},l.tileDown=function(e){if(!v.getInstance().getIsGamePaused()&&!this.isGameOver&&this.canMove)if(this.playerIdleTimeForHint=0,this.playerIdleTimeForMaxIdle=0,this.firstSelectedTile&&this.firstSelectedTile!==e){this.secondSelectedTile=e;var t=this.boardManager.getTileCoords(),n=t.get(this.firstSelectedTile),i=t.get(this.secondSelectedTile),r=Math.abs(n.x-i.x),a=Math.abs(n.y-i.y);1===r&&0===a||0===r&&1===a?(this.canMove=!1,this.swapTiles()):(this.firstSelectedTile.changeState("idle"),this.firstSelectedTile=e,e.changeState("select"),this.secondSelectedTile=void 0)}else this.firstSelectedTile=e,e.changeState("select")},l.isInBounds=function(e){return e.x>=0&&e.x<g.GridWidth&&e.y>=0&&e.y<g.GridHeight},l.swapTiles=function(){if(!this.firstSelectedTile||!this.secondSelectedTile)return this.canMove=!0,void v.getInstance().setIsMouseDown(!1);var e=this.boardManager.getTileCoords(),t=this.boardManager.getTileGrid(),n=e.get(this.firstSelectedTile),i=e.get(this.secondSelectedTile);return n&&i?this.isInBounds(n)&&this.isInBounds(i)?void this.performTileSwap(t,e,n,i):(console.error("Selected tile coordinates are out of bounds"),this.tileUp(),this.canMove=!0,void v.getInstance().setIsMouseDown(!1)):(console.error("Selected tile coordinates not found - tiles may have been destroyed"),this.tileUp(),this.canMove=!0,void v.getInstance().setIsMouseDown(!1))},l.performTileSwap=function(e,t,n,i){var r=this;this.firstSelectedTile&&this.secondSelectedTile&&(this.swappedTiles=[this.firstSelectedTile,this.secondSelectedTile],e[n.y][n.x]=this.secondSelectedTile,e[i.y][i.x]=this.firstSelectedTile,t.set(this.secondSelectedTile,{x:n.x,y:n.y}),t.set(this.firstSelectedTile,{x:i.x,y:i.y}),this.animationManager.animateSwap(this.firstSelectedTile,this.secondSelectedTile,(function(){return r.checkMatches(!0)})),this.firstSelectedTile=e[n.y][n.x],this.secondSelectedTile=e[i.y][i.x],this.firstSelectedTile&&this.secondSelectedTile&&(t.set(this.firstSelectedTile,{x:n.x,y:n.y}),t.set(this.secondSelectedTile,{x:i.x,y:i.y})))},l.checkMatches=function(){var e=a(s().mark((function e(t){var n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),!v.getInstance().getIsGamePaused()){e.next=3;break}return e.abrupt("return");case 3:if(n=this.boardManager.getTileGrid(),i=this.matchManager.findMatches(n),t&&this.swappedTiles.some((function(e){return e.isRainbowTile()}))&&i.push(this.swappedTiles),!(i.length>0)){e.next=15;break}return t&&this.processMove(),e.next=10,this.removeTileGroup(i);case 10:return e.next=12,this.resetTile();case 12:this.tileUp(),e.next=22;break;case 15:return e.next=17,this.checkMilestoneCompleted();case 17:if(!e.sent){e.next=20;break}return e.abrupt("return");case 20:t?this.swapTiles():(this.canMove=!0,v.getInstance().setIsMouseDown(!1),this.resetFrames(),this.checkGameOverConditions()),this.tileUp();case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.checkMilestoneCompleted=function(){var e=a(s().mark((function e(){var t,n,i,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.getInstance().processPendingScores()){e.next=3;break}return e.abrupt("return",!1);case 3:for(t=this.boardManager.getTileGrid(),n=!1,i=0;i<g.GridHeight&&!n;i++)for(r=0;r<g.GridWidth&&!n;r++)(a=t[i][r])&&a.node&&a.node.isValid&&(n=!0);if(!n){e.next=11;break}return e.next=9,this.handleMilestoneCompleted();case 9:e.next=14;break;case 11:console.warn("No valid tiles found for milestone animation, creating new board directly"),this.clearBoard(),this.createBoard();case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.resetFrames=function(){for(var e=this.boardManager.getTileGrid(),t=this.boardManager.getFrameGrid(),n=0;n<g.GridHeight;n++)for(var i=0;i<g.GridWidth;i++)e[n][i]&&t[n][i]&&e[n][i].setFrame(t[n][i])},l.resetTileFromExistingTile=function(e,t,n,i,r){for(var a=g.GridHeight-1;a>=0;a--)void 0!==e[a][r]&&n.push({tile:e[a][r],currentY:a});for(var s=0;s<g.GridHeight;s++)this.boardManager.setTileAt(r,s,void 0);for(var o=0;o<n.length;o++){var l=n[o],c=g.GridHeight-1-o;this.boardManager.setTileAt(r,c,l.tile),l.tile.setFrame(t[c][r]),l.currentY!==c&&i.push({tile:l.tile,fromY:l.currentY,toY:c,x:r,isNewTile:!1})}},l.resetTileFromVirtualTile=function(e,t,n,i,r){var a=g.GridHeight-n.length;if(a>0)for(var s=this.boardManager.getVirtualTilesForColumn(r,a),o=0;o<s.length;o++){var l=g.GridHeight-n.length-1-o,c=s[o];this.boardManager.setTileAt(r,l,c),c.addOnMouseDownCallback(this.tileDown.bind(this)),c.addOnMouseUpCallback(this.tileDown.bind(this)),c.addOnRainbowClickCallback(this.handleRainbowClick.bind(this)),c.setFrame(t[l][r]);var u=-(o+1);i.push({tile:c,fromY:u,toY:l,x:r,isNewTile:!1})}},l.resetTile=function(){var e=a(s().mark((function e(){var t,n,i,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[],n=this.boardManager.getTileGrid(),i=this.boardManager.getFrameGrid(),this.boardManager.getTileCoords(),r=0;r<g.GridWidth;r++)a=[],this.resetTileFromExistingTile(n,i,a,t,r),this.resetTileFromVirtualTile(n,i,a,t,r);if(this.boardManager.refillVirtualGrid(),0!==t.length){e.next=10;break}return e.next=9,this.checkMatches();case 9:return e.abrupt("return");case 10:return e.next=12,this.animationManager.animateFall(t);case 12:if(this.hasSwappablePair()){e.next=15;break}return e.next=15,this.shuffleBoard();case 15:return e.next=17,this.checkMatches();case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.tileUp=function(){var e,t;null==(e=this.firstSelectedTile)||e.changeState("idle"),null==(t=this.secondSelectedTile)||t.changeState("idle"),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0},l.handleCombineTile=function(e,t,n,i){var r=this;console.log("match special tile",4===e.length?I.BOMB:I.RAINBOW),n.push(a(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.filter((function(e){return e!==i})),t.next=3,r.specialTileManager.createSpecialTile(i,4===e.length?I.BOMB:I.RAINBOW,n,(function(){for(var e,t=o(n);!(e=t()).done;){var i=e.value;i.node&&i.node.isValid&&i.node.destroy()}}));case 3:case"end":return t.stop()}}),t)}))));for(var l,c=o(e);!(l=c()).done;){var u=l.value;u!==i&&(t.has(u)&&this.boardManager.clearTileAt(t.get(u).x,t.get(u).y))}},l.handleSpecialTileDestroy=function(){var e=a(s().mark((function e(t,n,i,r){var a,o,l,c,u,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t===this.firstSelectedTile?null!=(a=this.secondSelectedTile)?a:t:null!=(o=this.firstSelectedTile)?o:t,!t.isSpecial()){e.next=13;break}if(c=this.swappedTiles&&-1!==this.swappedTiles.indexOf(t),(u=this.specialTileManager.activateSpecialTile(t,l,i,c)).length>0&&u.forEach((function(e){return r.add(e)})),d=this.swappedTiles.filter((function(e){return e.isRainbowTile()})).length,!c||2!=d){e.next=12;break}return e.next=9,this.animationManager.animateDoubleRainbow(this.swappedTiles[0],this.swappedTiles[1],this.swappedTiles);case 9:return e.next=11,this.resolveDestroyAllForRainbow(this.swappedTiles);case 11:return e.abrupt("return",!0);case 12:!c&&t.isRainbowTile()&&n();case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,i,r){return e.apply(this,arguments)}}(),l.handleDestroyMatchTiles=function(){var e=a(s().mark((function e(t,n,i,r){var l,c,u,d,h=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=s().mark((function e(){var o,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=d.value,i.has(o)&&i.get(o)){e.next=4;break}return n(),e.abrupt("return",0);case 4:return l=i.get(o),e.next=7,h.handleSpecialTileDestroy(o,n,l,t);case 7:if(!e.sent){e.next=10;break}return e.abrupt("return",{v:!0});case 10:r.push(a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&o.node&&o.node.isValid){e.next=3;break}return n(),e.abrupt("return");case 3:return o.isSpecial()&&h.particleEffectManager.playSpecialTileDestroyEffect(o.node.getWorldPosition(),o.node.parent,o.getSpecialType()),e.next=6,o.playDestroyAnimation();case 6:if(o.isSpecial()){e.next=9;break}return e.next=9,o.playParticleEffect();case 9:o.node.destroy(),n();case 11:case"end":return e.stop()}}),e)})))),h.boardManager.clearTileAt(l.x,l.y);case 12:case"end":return e.stop()}}),e)})),u=o(t);case 2:if((d=u()).done){e.next=11;break}return e.delegateYield(l(),"t0",4);case 4:if(0!==(c=e.t0)){e.next=7;break}return e.abrupt("continue",9);case 7:if(!c){e.next=9;break}return e.abrupt("return",c.v);case 9:e.next=2;break;case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})));return function(t,n,i,r){return e.apply(this,arguments)}}(),l.removeTileGroup=function(e){var t=this;return new Promise(a(s().mark((function n(i){var r,a,l,c,u,d,h,p,f,g,v,m;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(r=t.boardManager.getTileCoords(),a=new Set,l=0,c=[],u=o(e);!(d=u()).done;)p=d.value,f=p.length>=4&&p.every((function(e){return!e.isRainbowTile()})),g=null!=(h=p.find((function(e){return-1!==t.swappedTiles.indexOf(e)})))?h:p[0],f?t.handleCombineTile(p,r,c,g):p.forEach((function(e){return a.add(e)})),w.getInstance().addPendingScore(p.length,p.length);if(0===c.length){n.next=10;break}return n.next=8,Promise.all(c.map((function(e){return e()})));case 8:return i(),n.abrupt("return");case 10:return v=[],m=function(){++l>=a.size&&i()},n.next=14,t.handleDestroyMatchTiles(a,m,r,v);case 14:if(!n.sent){n.next=18;break}return i(),n.abrupt("return");case 18:return n.next=20,Promise.all(v.map((function(e){return e()})));case 20:t.swappedTiles=[];case 21:case"end":return n.stop()}}),n)}))))},l.resolveDestroyAllForRainbow=function(){var e=a(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(a(s().mark((function e(i){var r,l,c,u,d,h,p,f,v,m,b,M,T,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,l=n.boardManager.getTileCoords(),c=n.boardManager.getTileGrid(),u=t.map((function(e){return l.get(e)})),d=o(c);case 5:if((h=d()).done){e.next=17;break}p=h.value,f=s().mark((function e(){var t,i,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.value){e.next=3;break}return e.abrupt("return",1);case 3:o=l.get(i),c=Math.max(Math.min(Math.abs(o.x-u[0].x),Math.abs(o.x-u[1].x)),Math.min(Math.abs(o.y-u[0].y),Math.abs(o.y-u[1].y))),r.set(c,[].concat(null!=(t=r.get(c))?t:[],[a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.playDestroyAnimation();case 2:return e.next=4,i.playParticleEffect();case 4:i.node&&i.node.isValid&&i.node.destroy(),M();case 6:case"end":return e.stop()}}),e)})))])),n.boardManager.clearTileAt(o.x,o.y);case 7:case"end":return e.stop()}}),e)})),v=o(p);case 9:if((m=v()).done){e.next=15;break}return e.delegateYield(f(),"t0",11);case 11:if(!e.t0){e.next=13;break}return e.abrupt("continue",13);case 13:e.next=9;break;case 15:e.next=5;break;case 17:b=0,M=function(){++b>=g.GridWidth*g.GridHeight&&i()},T=0;case 20:if(!(T<=Math.max(g.GridWidth,g.GridHeight))){e.next=28;break}if(!(w=r.get(T))){e.next=25;break}return e.next=25,Promise.all(w.map((function(e){return e()})));case 25:T++,e.next=20;break;case 28:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l.setGameInteractionEnabled=function(e){if(this.boardManager)for(var t=this.boardManager.getTileGrid(),n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var r=t[n][i];if(r){var a=r.getComponent(h);a&&(a.interactable=e)}}},l.startNewGame=function(){console.log("Starting new game..."),v.getInstance().setIsGamePaused(!1),this.isGameOver=!1,this.canMove=!1,this.movesRemaining=g.Moves,this.gameOverPopup&&this.gameOverPopup.hide(!1);var e=w.getInstance();e&&e.resetProgress(),this.clearBoard(),this.createBoard(!0),this.setGameInteractionEnabled(!0),this.updateMovesDisplay(this.movesRemaining),console.log("New game started!")},l.checkGameOverConditions=function(){this.isGameOver||v.getInstance().getIsGamePaused()||this.movesRemaining<=0&&this.triggerGameOver()},l.triggerGameOver=function(){var e=this;console.log("Game Over - No moves remaining!"),this.isGameOver=!0,this.canMove=!1,this.setGameInteractionEnabled(!1),v.getInstance().setIsGameOver(!0);var t=w.getInstance(),n=t?t.getCurrentScore():0;this.gameOverPopup&&(this.gameOverPopup.show(n),this.gameOverPopup.setCallback((function(){e.startNewGame()})))},l.processMove=function(){this.isGameOver||(this.movesRemaining--,this.movesRemaining<0&&(this.movesRemaining=0),this.updateMovesDisplay(this.movesRemaining))},l.updateMovesDisplay=function(e){this.progressUI?this.progressUI.updateMovesDisplay(e):console.log("Moves remaining: "+e)},l.handleRainbowClick=function(){var e=a(s().mark((function e(t){var n,i,r,a,l,c,u,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.getInstance().getIsGamePaused()&&!this.isGameOver&&this.canMove){e.next=2;break}return e.abrupt("return");case 2:return this.canMove=!1,this.playerIdleTimeForHint=0,this.playerIdleTimeForMaxIdle=0,n=this.specialTileManager.activateSpecialTile(t,t,{x:0,y:0},!1,!0),console.log("affectedTiles",n),e.next=9,this.animationManager.animateRainbowClickEffect(t);case 9:i=this.boardManager.getTileCoords(),(r=i.get(t))&&this.boardManager.clearTileAt(r.x,r.y),a=o(n);case 13:if((l=a()).done){e.next=27;break}if((c=l.value)&&c.node&&c.node.isValid){e.next=17;break}return e.abrupt("continue",25);case 17:return c.playDestroyAnimation(),e.next=20,c.playParticleEffect();case 20:return c.node&&c.node.isValid&&c.node.destroy(),e.next=23,new Promise((function(e){return d.scheduleOnce(e,.05)}));case 23:(u=i.get(c))&&this.boardManager.clearTileAt(u.x,u.y);case 25:e.next=13;break;case 27:return w.getInstance().addPendingScore(n.length,n.length),this.processMove(),e.next=31,this.resetTile();case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.findSwappablePair=function(){for(var e=this.boardManager.getTileGrid(),t=0;t<g.GridHeight;t++)for(var n=0;n<g.GridWidth;n++){var i=e[t][n];if(i){if(n<g.GridWidth-1){var r=e[t][n+1];if(r&&this.wouldSwapResultInMatch(i,r,e))return[i,r]}if(t<g.GridHeight-1){var a=e[t+1][n];if(a&&this.wouldSwapResultInMatch(i,a,e))return[i,a]}}}return null},l.wouldSwapResultInMatch=function(e,t,n){for(var i=-1,r=-1,a=-1,s=-1,o=0;o<g.GridHeight;o++)for(var l=0;l<g.GridWidth;l++)n[o][l]===e&&(r=o,i=l),n[o][l]===t&&(s=o,a=l);if(-1===i||-1===r||-1===a||-1===s)return!1;n[r][i]=t,n[s][a]=e;var c=this.matchManager.findMatches(n);return n[r][i]=e,n[s][a]=t,c.length>0},l.showHint=function(){var e=a(s().mark((function e(){var t,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hintActive){e.next=2;break}return e.abrupt("return");case 2:if(i=this.findSwappablePair()){e.next=5;break}return e.abrupt("return");case 5:return this.hintActive=!0,e.next=8,Promise.all([null==(t=i[0].getComponent(M))?void 0:t.animatePulse(10),null==(n=i[1].getComponent(M))?void 0:n.animatePulse(10)]);case 8:this.hintActive=!1;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.hasSwappablePair=function(){return null!==this.findSwappablePair()},l.shuffleBoard=function(){var e=a(s().mark((function e(){var t,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.boardManager.getTileGrid(),n=this.collectAllTiles(t),i=0;case 3:if(this.shuffleArray(n),this.repositionTiles(n,t),this.updateTileCoordinates(t),!(++i>20)){e.next=9;break}return e.abrupt("break",10);case 9:if(!this.hasSwappablePair()){e.next=3;break}case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.collectAllTiles=function(e){for(var t=[],n=0;n<g.GridHeight;n++)for(var i=0;i<g.GridWidth;i++){var r=e[n][i];r&&t.push(r)}return t},l.shuffleArray=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),i=[e[n],e[t]];e[t]=i[0],e[n]=i[1]}},l.repositionTiles=function(e,t){for(var n=0,i=0;i<g.GridHeight;i++)for(var r=0;r<g.GridWidth;r++)if(t[i][r]){t[i][r]=e[n++];var a=this.boardManager.getWorldPosition({x:r,y:i});t[i][r].node.setPosition(a.x,a.y,0)}},l.updateTileCoordinates=function(e){var t=this.boardManager.getTileCoords();t.clear();for(var n=0;n<g.GridHeight;n++)for(var i=0;i<g.GridWidth;i++){var r=e[n][i];r&&t.set(r,{x:i,y:n})}},l.onDestroy=function(){var e,t;null!=(e=this.pauseButton)&&e.node&&(this.pauseButton.node.off(d.EventType.TOUCH_END),this.pauseButton.node.off(d.EventType.TOUCH_START),this.pauseButton.node.off(d.EventType.MOUSE_ENTER),this.pauseButton.node.off(d.EventType.MOUSE_LEAVE));var n=w.getInstance();n&&n.offMilestoneCompleted(this.handleMilestoneCompleted.bind(this)),this.pausePopup&&this.pausePopup.destroy(),null!=(t=this.pauseButton)&&t.node&&p(this.pauseButton.node).stop(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.swappedTiles=[],this.triggeredSpecialTiles=[]},t}(S)).prototype,"camera",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(_.prototype,"celebrationNode",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(_.prototype,"milestoneUINode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(_.prototype,"progressUINode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(_.prototype,"pausePopupUI",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(_.prototype,"gameOverPopup",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(_.prototype,"pauseButton",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(_.prototype,"screenAdapter",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=_))||W));l._RF.pop()}}}));

System.register("chunks:///_virtual/GameOverPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,n,i,a,r,s,l,c,h,u,p,d,g,b,f,w,v,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,s=e.Node,l=e.Label,c=e.Button,h=e.sys,u=e.Sprite,p=e.Color,d=e.Vec2,g=e.UITransform,b=e.tween,f=e.Vec3,w=e.EventHandler,v=e.UIOpacity,m=e.Component}],execute:function(){var S,L,C,y,O,P,E,B,G,k,T,H,N,z,M;a._RF.push({},"b2c3dTl9qeJAbzeI0VniQEj","GameOverPopup",void 0);var U=r.ccclass,A=r.property;e("GameOverPopup",(S=U("GameOverPopup"),L=A(s),C=A(s),y=A(l),O=A(l),P=A(l),E=A(c),S((k=t((G=function(e){function t(){for(var t,o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,n(t,"popupPanel",k,i(t)),n(t,"backgroundOverlay",T,i(t)),n(t,"titleLabel",H,i(t)),n(t,"scoreLabel",N,i(t)),n(t,"highScoreLabel",z,i(t)),n(t,"newGameButton",M,i(t)),t.isVisible=!1,t.onNewGameCallback=null,t.currentScore=0,t.highScore=0,t}o(t,e);var a=t.prototype;return a.start=function(){this.loadHighScore(),this.enhanceExistingUI(),this.setupButtons(),this.hide(!1)},a.loadHighScore=function(){var e=h.localStorage.getItem("candyCrushHighScore");this.highScore=e?parseInt(e):0},a.saveHighScore=function(){h.localStorage.setItem("candyCrushHighScore",this.highScore.toString())},a.enhanceExistingUI=function(){this.enhancePopupPanel(),this.enhanceBackgroundOverlay(),this.enhanceTitleLabel(),this.enhanceScoreLabel(),this.enhanceNewGameButton(),this.addVisualEffects()},a.enhancePopupPanel=function(){if(this.popupPanel){var e=this.popupPanel.getComponent(u);e&&(e.color=new p(40,15,25,245))}},a.enhanceBackgroundOverlay=function(){if(this.backgroundOverlay){var e=this.backgroundOverlay.getComponent(u);e&&(e.color=new p(0,0,0,180))}},a.enhanceTitleLabel=function(){this.titleLabel&&(this.titleLabel.string="GAME OVER",this.titleLabel.fontSize=30,this.titleLabel.isBold=!0,this.titleLabel.color=new p(220,20,60,255),this.titleLabel.enableOutline=!0,this.titleLabel.outlineColor=new p(139,0,0,255),this.titleLabel.outlineWidth=4,this.titleLabel.enableShadow=!0,this.titleLabel.shadowColor=new p(0,0,0,200),this.titleLabel.shadowOffset=new d(4,-4),this.titleLabel.shadowBlur=6)},a.enhanceScoreLabel=function(){this.scoreLabel&&(this.scoreLabel.fontSize=52,this.scoreLabel.isBold=!0,this.scoreLabel.color=new p(255,215,0,255),this.scoreLabel.enableOutline=!0,this.scoreLabel.outlineColor=new p(139,69,19,255),this.scoreLabel.outlineWidth=3,this.scoreLabel.enableShadow=!0,this.scoreLabel.shadowColor=new p(255,165,0,150),this.scoreLabel.shadowOffset=new d(2,-2),this.scoreLabel.shadowBlur=8)},a.enhanceNewGameButton=function(){if(this.newGameButton){var e=this.newGameButton.getComponent(u);e&&(e.color=new p(255,140,0,255));var t=this.newGameButton.node.getChildByName("Label");if(t){var o=t.getComponent(l);o&&(o.string="NEW GAME",o.fontSize=14,o.isBold=!0,o.color=new p(255,255,255,255),o.enableOutline=!0,o.outlineColor=new p(0,0,0,200),o.outlineWidth=2,o.enableShadow=!0,o.shadowColor=new p(0,0,0,150),o.shadowOffset=new d(1,-1),o.shadowBlur=3)}}},a.addVisualEffects=function(){this.createFloatingParticles(),this.addBorderGlow()},a.createFloatingParticles=function(){if(this.popupPanel)for(var e=0;e<8;e++){var t=new s("Particle"+e);this.popupPanel.addChild(t),t.addComponent(g).setContentSize(6,6);var o=t.addComponent(u);o.color=new p(255,215,0,150);var n=e/8*Math.PI*2,i=180+40*Math.random(),a=Math.cos(n)*i,r=Math.sin(n)*i;t.setPosition(a,r,0),b(t).to(3+2*Math.random(),{position:new f(a+60*(Math.random()-.5),r+20,0)}).to(3+2*Math.random(),{position:new f(a,r,0)}).union().repeatForever().start(),b(o).to(1.5,{color:new p(255,215,0,50)}).to(1.5,{color:new p(255,215,0,150)}).union().repeatForever().start()}},a.addBorderGlow=function(){if(this.popupPanel){var e=new s("GlowBorder");this.popupPanel.addChild(e),e.setSiblingIndex(0);var t=e.addComponent(g),o=this.popupPanel.getComponent(g);o&&t.setContentSize(o.contentSize.width+20,o.contentSize.height+20);var n=e.addComponent(u);n.color=new p(255,215,0,30),b(n).to(2,{color:new p(255,215,0,60)}).to(2,{color:new p(255,215,0,30)}).union().repeatForever().start()}},a.setupButtons=function(){if(this.newGameButton){this.setupButtonAnimations(this.newGameButton);var e=new w;e.target=this.node,e.component="GameOverPopup",e.handler="onNewGameClicked",this.newGameButton.clickEvents.push(e)}},a.setupButtonAnimations=function(e){var t=e.node,o=t.scale.clone(),n=e.node.getComponent(u),i=n.color.clone();t.on(s.EventType.MOUSE_ENTER,(function(){b(t).to(.1,{scale:new f(1.1,1.1,1)},{easing:"quadOut"}).start(),b(n).to(.1,{color:new p(i.r+40,i.g+40,i.b+40,i.a)}).start()})),t.on(s.EventType.MOUSE_LEAVE,(function(){b(t).to(.1,{scale:o},{easing:"quadOut"}).start(),b(n).to(.1,{color:i}).start()})),t.on(s.EventType.TOUCH_START,(function(){b(t).to(.05,{scale:new f(.95,.95,1)},{easing:"quadOut"}).start()})),t.on(s.EventType.TOUCH_END,(function(){b(t).to(.15,{scale:new f(1.15,1.15,1)},{easing:"backOut"}).to(.1,{scale:o},{easing:"quadOut"}).start()})),t.on(s.EventType.TOUCH_CANCEL,(function(){b(t).to(.1,{scale:o},{easing:"quadOut"}).start()}))},a.show=function(e){if(!this.isVisible){if(console.log("GameOverPopup show called with score:",e),this.currentScore=e,this.checkAndUpdateHighScore(),this.updateScoreDisplays(),this.isVisible=!0,this.node.active=!0,this.popupPanel){this.popupPanel.setScale(0,0,1);var t=this.popupPanel.getComponent(v);t||(t=this.popupPanel.addComponent(v)),t.opacity=0}if(this.backgroundOverlay){var o=this.backgroundOverlay.getComponent(v);o||(o=this.backgroundOverlay.addComponent(v)),o.opacity=0}if(this.backgroundOverlay){var n=this.backgroundOverlay.getComponent(v);b(n).to(.4,{opacity:255},{easing:"quadOut"}).start()}if(this.popupPanel){var i=this.popupPanel.getComponent(v);b(i).to(.5,{opacity:255},{easing:"quadOut"}).start(),b(this.popupPanel).to(.2,{scale:new f(.3,.3,1)},{easing:"quadOut"}).to(.4,{scale:new f(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new f(1,1,1)},{easing:"quadOut"}).start()}this.animateScoreCounting()}},a.animateScoreCounting=function(){var e=this;if(this.scoreLabel){var t=0,o=this.currentScore,n=o/60;setTimeout((function i(){t=Math.min(t+n,o),e.scoreLabel.string=Math.floor(t).toLocaleString(),t<o&&setTimeout(i,25)}),800)}},a.checkAndUpdateHighScore=function(){this.currentScore>this.highScore&&(this.highScore=this.currentScore,this.saveHighScore(),this.celebrateNewHighScore())},a.celebrateNewHighScore=function(){if(this.highScoreLabel){var e=this.highScoreLabel.color.clone();b(this.highScoreLabel).to(.2,{color:new p(255,215,0,255)}).to(.2,{color:new p(255,255,255,255)}).to(.2,{color:new p(255,215,0,255)}).to(.2,{color:e}).start(),b(this.highScoreLabel.node).to(.3,{scale:new f(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new f(1,1,1)},{easing:"quadOut"}).start()}},a.updateScoreDisplays=function(){this.scoreLabel&&(this.scoreLabel.string="0"),this.highScoreLabel&&(this.highScoreLabel.string=this.highScore.toLocaleString())},a.hide=function(e){var t=this;if(void 0===e&&(e=!0),this.isVisible||!e)if(this.isVisible=!1,e){if(this.popupPanel){var o=this.popupPanel.getComponent(v);o||(o=this.popupPanel.addComponent(v)),b(this.popupPanel).to(.3,{scale:new f(.6,.6,1)},{easing:"backIn"}).start(),b(o).to(.3,{opacity:0},{easing:"quadIn"}).start()}if(this.backgroundOverlay){var n=this.backgroundOverlay.getComponent(v);n||(n=this.backgroundOverlay.addComponent(v)),b(n).to(.25,{opacity:0},{easing:"quadIn"}).call((function(){t.node.active=!1})).start()}else setTimeout((function(){t.node.active=!1}),300)}else this.node.active=!1},a.setCallback=function(e){this.onNewGameCallback=e},a.onNewGameClicked=function(){var e=this;this.hide(),this.onNewGameCallback&&setTimeout((function(){return e.onNewGameCallback()}),300)},a.getHighScore=function(){return this.highScore},a.resetHighScore=function(){this.highScore=0,this.saveHighScore(),this.highScoreLabel&&(this.highScoreLabel.string="0")},a.onDestroy=function(){var e,t,o;if(null!=(e=this.newGameButton)&&e.node&&(this.newGameButton.node.off(s.EventType.MOUSE_ENTER),this.newGameButton.node.off(s.EventType.MOUSE_LEAVE),this.newGameButton.node.off(s.EventType.TOUCH_START),this.newGameButton.node.off(s.EventType.TOUCH_END),this.newGameButton.node.off(s.EventType.TOUCH_CANCEL)),this.popupPanel){b(this.popupPanel).stop(),this.popupPanel.children.filter((function(e){return e.name.startsWith("Particle")})).forEach((function(e){b(e).stop();var t=e.getComponent(u);t&&b(t).stop()}));var n=this.popupPanel.getChildByName("GlowBorder");if(n){var i=n.getComponent(u);i&&b(i).stop()}}if(this.backgroundOverlay){var a=this.backgroundOverlay.getComponent(v);a&&b(a).stop()}null!=(t=this.titleLabel)&&t.node&&b(this.titleLabel.node).stop(),this.scoreLabel&&b(this.scoreLabel).stop(),null!=(o=this.highScoreLabel)&&o.node&&(b(this.highScoreLabel.node).stop(),b(this.highScoreLabel).stop()),this.onNewGameCallback=null},t}(m)).prototype,"popupPanel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(G.prototype,"backgroundOverlay",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(G.prototype,"titleLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(G.prototype,"scoreLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(G.prototype,"highScoreLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(G.prototype,"newGameButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=G))||B));a._RF.pop()}}}));

System.register("chunks:///_virtual/IdleState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileState.ts","./AnimationManager.ts"],(function(n){var t,e,i,a;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy},function(n){i=n.TileState},function(n){a=n.AnimationManager}],execute:function(){e._RF.push({},"22289Nm7F9CA4w+U3Kkqxb/","IdleState",void 0);n("IdleState",function(n){function e(t){var e;return(e=n.call(this,t)||this).animationHandler=null,e.animationHandler=t.getComponent(a),e}t(e,n);var i=e.prototype;return i.onEnter=function(){var n,t;null==(n=this.animationHandler)||n.updateOriginalValues(),null==(t=this.animationHandler)||t.stopAllAnimations()},i.onExit=function(){},i.onUpdate=function(){},i.onPlayerIdle=function(){var n;null==(n=this.animationHandler)||n.animatePlayerIdle()},e}(i));e._RF.pop()}}}));

System.register("chunks:///_virtual/InputManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,s,n;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,s=e._decorator,n=e.Component}],execute:function(){var l;i._RF.push({},"27ed9f/giNFtYZoHrSdQky5","InputManager",void 0);var r=s.ccclass;e("InputManager",r("InputManager")(l=function(e){function i(){for(var t,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(t=e.call.apply(e,[this].concat(s))||this).firstSelectedTile=void 0,t.secondSelectedTile=void 0,t.boardManager=null,t.canMove=!0,t}t(i,e);var s=i.prototype;return s.setBoardManager=function(e){this.boardManager=e},s.setCanMove=function(e){this.canMove=e},s.getCanMove=function(){return this.canMove},s.handleTileClick=function(e){if(!this.canMove||!this.boardManager)return{isValid:!1,shouldSwap:!1,firstTile:e};if(!this.firstSelectedTile||this.firstSelectedTile===e)return this.selectFirstTile(e),{isValid:!0,shouldSwap:!1,firstTile:e};if(this.secondSelectedTile=e,this.areAdjacent(this.firstSelectedTile,this.secondSelectedTile)){var t={isValid:!0,shouldSwap:!0,firstTile:this.firstSelectedTile,secondTile:this.secondSelectedTile};return this.canMove=!1,t}return this.deselectAll(),this.selectFirstTile(e),{isValid:!0,shouldSwap:!1,firstTile:e}},s.swapCompleted=function(){this.canMove=!0,this.deselectAll()},s.swapFailed=function(){this.canMove=!0},s.getSelectedTiles=function(){return{first:this.firstSelectedTile,second:this.secondSelectedTile}},s.deselectAll=function(){var e,t;null==(e=this.firstSelectedTile)||e.changeState("idle"),null==(t=this.secondSelectedTile)||t.changeState("idle"),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0},s.selectFirstTile=function(e){this.deselectAll(),this.firstSelectedTile=e,e.changeState("select")},s.areAdjacent=function(e,t){if(!this.boardManager)return!1;var i=this.boardManager.getTileCoords().get(e),s=this.boardManager.getTileCoords().get(t);if(!i||!s)return!1;var n=Math.abs(i.x-s.x),l=Math.abs(i.y-s.y);return 1===n&&0===l||0===n&&1===l},s.reset=function(){this.deselectAll(),this.canMove=!0},i}(n))||l);i._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AssetLoader.ts","./Frame.ts","./GameGlobalData.ts","./GameManager.ts","./ProgressUI.ts","./ResponsiveWidget.ts","./ScreenAdapter.ts","./Tile.ts","./AnimationManager.ts","./BoardManager.ts","./InputManager.ts","./MatchManager.ts","./ParticleEffectManager.ts","./ProgressManager.ts","./SpecialTileManager.ts","./Singleton.ts","./IdleState.ts","./SelectState.ts","./TileState.ts","./GameOverPopup.ts","./MilestoneAchievementUI.ts","./PausePopup.ts","./AnimationConfig.ts","./GameConfig.ts","./SpecialTileConfig.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MatchManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./SpecialTileConfig.ts"],(function(e){var t,n,a,r,i,o,c,h;return{setters:[function(e){t=e.inheritsLoose,n=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,r=e._decorator,i=e.Component},function(e){o=e.GameConfig,c=e.PatternShape},function(e){h=e.SpecialTileType}],execute:function(){var s;a._RF.push({},"32a97mjyCxIAaOfDGLjqzvl","MatchManager",void 0);var u=r.ccclass;e("MatchManager",u("MatchManager")(s=function(e){function a(){return e.apply(this,arguments)||this}t(a,e);var r=a.prototype;return r.findMatches=function(e){var t=[],n=new Set;return this.findShapeMatches(e,t,n),console.log("matches",t),t},r.findShapeMatches=function(e,t,n){for(var a=this,r=function(r){var i=c.filter((function(e){return e.shape.length===r}));a.findShapeMatchesByPatterns(e,t,n,i)},i=5;i>=3;i--)r(i)},r.findShapeMatchesByPatterns=function(e,t,a,r){for(var i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++){var c=e[i][o];if(c&&!a.has(c)&&c.getSpecialType()!==h.RAINBOW)for(var s,u=n(r);!(s=u()).done;){var f=s.value,l=this.findPatternMatch(e,o,i,f,a);l&&(t.push(l),l.forEach((function(e){return a.add(e)})))}}},r.isInGrid=function(e,t){return e>=0&&e<o.GridWidth&&t>=0&&t<o.GridHeight},r.findPatternMatch=function(e,t,a,r,i){for(var o,c,h=[],s=r.shape,u=null==(o=e[a][t])?void 0:o.getTileType(),f=n(s);!(c=f()).done;){var l=c.value,p=t+l.x,v=a+l.y;if(!this.isInGrid(p,v))return null;var d=e[v][p];if(!d||i.has(d)||d.getTileType()!==u||d.isRainbowTile())return null;h.push(d)}return h.length>=r.shape.length?h:null},a}(i))||s);a._RF.pop()}}}));

System.register("chunks:///_virtual/MilestoneAchievementUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,a,o,l,s,c,u,p,h,f,b,m,v,g,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){l=e.cclegacy,s=e._decorator,c=e.Node,u=e.Label,p=e.Sprite,h=e.Prefab,f=e.Tween,b=e.Component,m=e.instantiate,v=e.UIOpacity,g=e.tween,d=e.Vec3}],execute:function(){var w,y,P,L,I,S,x,k,E,z,A,M,T,q,C;l._RF.push({},"583aatI2IlIeqzd1+f18JPf","MilestoneAchievementUI",void 0);var U=s.ccclass,D=s.property;e("MilestoneAchievementUI",(w=U("MilestoneAchievementUI"),y=D(c),P=D(u),L=D(u),I=D(u),S=D(p),x=D(h),w((z=t((E=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,r(t,"achievementPanel",z,i(t)),r(t,"titleLabel",A,i(t)),r(t,"levelLabel",M,i(t)),r(t,"messageLabel",T,i(t)),r(t,"backgroundSprite",q,i(t)),r(t,"confettiPrefab",C,i(t)),t}n(t,e);var l=t.prototype;return l.showMilestoneAchievement=function(){var e=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Showing milestone achievement UI",t),this.updateLabels(t),this.node.active=!0,this.achievementPanel&&(this.achievementPanel.setScale(0,0,0),(n=this.achievementPanel.getComponent(v))&&(n.opacity=255)),e.next=6,this.animateEntrance();case 6:return this.confettiPrefab&&((r=m(this.confettiPrefab)).setParent(this.node),r.setPosition(0,350,0),r.setScale(0,0,0),(i=r.getComponent(v))&&(i.opacity=255),g(r).to(.5,{scale:new d(1.1,1.1,1.1)},{easing:"quadOut"}).to(.2,{scale:new d(1,1,1)},{easing:"quadIn"}).start()),e.next=9,new Promise((function(e){return setTimeout(e,3e3)}));case 9:return e.next=11,this.animateExit();case 11:this.node.active=!1;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.updateLabels=function(e){this.titleLabel&&(this.titleLabel.string="MILESTONE ACHIEVED!"),this.levelLabel&&(this.levelLabel.string="LEVEL "+e.currentMilestone),this.messageLabel&&(this.messageLabel.string="Congratulations!\nYou've reached level "+e.currentMilestone+"!\nTotal Score: "+e.currentScore)},l.animateEntrance=function(){var e=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.achievementPanel){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){g(t.achievementPanel).to(.5,{scale:new d(1.1,1.1,1.1)},{easing:"quadOut"}).to(.2,{scale:new d(1,1,1)},{easing:"quadIn"}).call((function(){e()})).start()})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.animateExit=function(){var e=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.achievementPanel){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){var n=t.achievementPanel.getComponent(v);n&&g(n).to(.3,{opacity:0},{easing:"quadIn"}).start(),g(t.achievementPanel).to(.3,{scale:new d(.8,.8,.8)},{easing:"quadIn"}).call((function(){e()})).start()})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.onDestroy=function(){this.achievementPanel&&f.stopAllByTarget(this.achievementPanel),this.backgroundSprite&&f.stopAllByTarget(this.backgroundSprite)},t}(b)).prototype,"achievementPanel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(E.prototype,"titleLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(E.prototype,"levelLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(E.prototype,"messageLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(E.prototype,"backgroundSprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(E.prototype,"confettiPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=E))||k));l._RF.pop()}}}));

System.register("chunks:///_virtual/ParticleEffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpecialTileConfig.ts"],(function(t){var e,n,r,i,o,a,c,f,u,s,l,p,h,b,d,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){c=t.cclegacy,f=t._decorator,u=t.Prefab,s=t.Vec3,l=t.UITransform,p=t.instantiate,h=t.ParticleSystem2D,b=t.Color,d=t.Component},function(t){w=t.SpecialTileType}],execute:function(){var E,y,v,g,m,C,k,x,P,B,T,A,S,z,O,M,V,R,I;c._RF.push({},"e3f4g5h6-i7j8-9012-3456-789012cdefgh","ParticleEffectManager",void 0);var N=f.ccclass,W=f.property;t("ParticleEffectManager",(E=N("ParticleEffectManager"),y=W(u),v=W(u),g=W(u),m=W(u),C=W(u),k=W(u),x=W(u),P=W(u),E((A=e((T=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,r(e,"bombCreationEffect",A,i(e)),r(e,"rainbowCreationEffect",S,i(e)),r(e,"bombActivationEffect",z,i(e)),r(e,"rainbowActivationEffect",O,i(e)),r(e,"explosionEffect",M,i(e)),r(e,"sparkleEffect",V,i(e)),r(e,"confettiEffect",R,i(e)),r(e,"shockwaveEffect",I,i(e)),e}n(e,t);var c=e.prototype;return c.playSpecialTileCreationEffect=function(){var t=o(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=this.getCreationEffectPrefab(n))&&e.node&&e.node.isValid){t.next=3;break}return t.abrupt("return");case 3:return t.abrupt("return",this.playEffect(r,e.node.worldPosition,e.node.parent));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.playSpecialTileActivationEffect=function(t,e){var n=this.getActivationEffectPrefab(e);n&&t.node&&t.node.isValid&&this.playEffect(n,t.node.worldPosition,t.node.parent)},c.playExplosionEffect=function(){var t=o(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.explosionEffect){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",this.playEffect(this.explosionEffect,e,n));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.playSparkleEffect=function(){var t=o(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sparkleEffect){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",this.playEffect(this.sparkleEffect,e,n));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.playConfettiEffect=function(){var t=o(a().mark((function t(e,n,r){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.confettiEffect||this.sparkleEffect){t.next=3;break}return t.abrupt("return");case 3:return t.abrupt("return",this.playColoredEffect(i,e,n,r));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}(),c.playMilestoneConfetti=function(){var t=o(a().mark((function t(e){var n,r,i,o=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[new b(255,215,0,255),new b(255,20,147,255),new b(0,191,255,255),new b(50,205,50,255),new b(255,165,0,255),new b(138,43,226,255)],r=this.generateConfettiPositions(e),i=r.map((function(t,r){return new Promise((function(i){setTimeout((function(){var a=n[r%n.length];o.playConfettiEffect(t,e,a).then(i)}),150*r)}))})),t.next=5,Promise.all(i);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),c.generateConfettiPositions=function(t){var e=[],n=this.getNodeBounds(t);return e.push(new s(n.left+100,n.top-100,0),new s(n.right-100,n.top-100,0),new s(n.center.x,n.top-50,0),new s(n.left+50,n.center.y+100,0),new s(n.right-50,n.center.y+100,0),new s(n.center.x-200,n.top-150,0),new s(n.center.x+200,n.top-150,0)),e},c.getNodeBounds=function(t){try{var e=t.getComponent(l);if(e&&e.contentSize){var n=e.contentSize;return{left:-n.width/2,right:n.width/2,top:n.height/2,bottom:-n.height/2,center:{x:0,y:0}}}}catch(t){console.warn("Could not get node bounds, using defaults:",t)}return{left:-400,right:400,top:300,bottom:-300,center:{x:0,y:0}}},c.getCreationEffectPrefab=function(t){switch(t){case w.BOMB:return this.bombCreationEffect;case w.RAINBOW:return this.rainbowCreationEffect;default:return null}},c.getActivationEffectPrefab=function(t){switch(t){case w.BOMB:return this.bombActivationEffect;case w.RAINBOW:return this.rainbowActivationEffect;default:return null}},c.playEffect=function(t,e,n){if(n){var r=p(t);n.addChild(r),r.setWorldPosition(e);var i=r.getComponent(h);i&&(i.playOnLoad=!0,setTimeout((function(){r&&r.isValid&&r.destroy()}),3e3))}},c.playColoredEffect=function(t,e,n,r){if(n){var i=p(t);n.addChild(i),i.setWorldPosition(e);var o=i.getComponent(h);o&&(o.playOnLoad=!0,r&&(o.startColor=r,o.endColor=r,o.startColorVar=new b(50,50,50,0),o.endColorVar=new b(50,50,50,0)),setTimeout((function(){i&&i.isValid&&i.destroy()}),3e3))}},c.playMultipleEffects=function(){var t=o(a().mark((function t(e,n,r){var i,o=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.map((function(t,e){return new Promise((function(i){setTimeout((function(){"explosion"===n?o.playExplosionEffect(t,r).then(i):"sparkle"===n?o.playSparkleEffect(t,r).then(i):"confetti"===n?o.playConfettiEffect(t,r).then(i):"shockwave"===n?o.playShockwaveEffect(t,r).then(i):i()}),100*e)}))})),t.next=3,Promise.all(i);case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),c.playSpecialTileDestroyEffect=function(){var t=o(a().mark((function t(e,n,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shockwaveEffect){t.next=2;break}return t.abrupt("return");case 2:t.t0=r,t.next=t.t0===w.BOMB?5:t.t0===w.RAINBOW?6:7;break;case 5:return t.abrupt("return",this.playEffect(this.shockwaveEffect,e,n));case 6:case 7:return t.abrupt("break",8);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}(),c.getParticleEffectPrefab=function(t){switch(t){case w.BOMB:return this.bombCreationEffect;case w.RAINBOW:return this.rainbowCreationEffect;default:return null}},c.createTileParticleEffect=function(t,e){if(t.node&&t.node.isValid){var n=t.getTileType().color,r=this.getParticleEffectPrefab(e);if(console.log("effectPrefab",r),r){var i=p(r);i.setParent(t.node),t.node.addChild(i),i.setPosition(0,-20,0);var o=i.getComponent(h);console.log("particleSystem",o),o&&e!==w.RAINBOW&&(o.startColor=n,o.startColorVar=new b(0,0,0,255),o.endColor=n,o.endColorVar=new b(0,0,0,255),o.playOnLoad=!0)}}},c.playShockwaveEffect=function(){var t=o(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shockwaveEffect){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",this.playEffect(this.shockwaveEffect,e,n));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.onDestroy=function(){this.node.children.forEach((function(t){t.isValid&&t.destroy()}))},e}(d)).prototype,"bombCreationEffect",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(T.prototype,"rainbowCreationEffect",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(T.prototype,"bombActivationEffect",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(T.prototype,"rainbowActivationEffect",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(T.prototype,"explosionEffect",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(T.prototype,"sparkleEffect",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(T.prototype,"confettiEffect",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(T.prototype,"shockwaveEffect",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=T))||B));c._RF.pop()}}}));

System.register("chunks:///_virtual/PausePopup.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,o,i,a,u,s,l,r,c,p,h,d,g,f,b,C,v;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,o=n.initializerDefineProperty,i=n.assertThisInitialized},function(n){a=n.cclegacy,u=n._decorator,s=n.Node,l=n.Button,r=n.Toggle,c=n.Label,p=n.EventHandler,h=n.Sprite,d=n.tween,g=n.Vec3,f=n.Color,b=n.UIOpacity,C=n.AudioSource,v=n.Component}],execute:function(){var m,y,k,T,w,P,O,E,B,N,S,G,_,U,V;a._RF.push({},"a1b2cPU5fZ4kKvNEjRWeJAS","PausePopup",void 0);var q=u.ccclass,A=u.property;n("PausePopup",(m=q("PausePopup"),y=A(s),k=A(s),T=A(l),w=A(l),P=A(r),O=A(c),m((N=t((B=function(n){function t(){for(var t,e=arguments.length,a=new Array(e),u=0;u<e;u++)a[u]=arguments[u];return t=n.call.apply(n,[this].concat(a))||this,o(t,"popupPanel",N,i(t)),o(t,"backgroundOverlay",S,i(t)),o(t,"continueButton",G,i(t)),o(t,"newGameButton",_,i(t)),o(t,"soundToggle",U,i(t)),o(t,"titleLabel",V,i(t)),t.isVisible=!1,t.onContinueCallback=null,t.onNewGameCallback=null,t}e(t,n);var a=t.prototype;return a.start=function(){this.isVisible=!1,this.setupButtons(),this.hide(!1),this.enhanceVisualStyling()},a.setupButtons=function(){var n=this;if(this.continueButton){this.setupButtonAnimations(this.continueButton);var t=new p;t.target=this.node,t.component="PausePopup",t.handler="onContinueClicked",this.continueButton.node.on(s.EventType.TOUCH_END,(function(){n.onContinueClicked()}))}if(this.newGameButton){this.setupButtonAnimations(this.newGameButton);var e=new p;e.target=this.node,e.component="PausePopup",e.handler="onNewGameClicked",this.newGameButton.node.on(s.EventType.TOUCH_END,(function(){n.onNewGameClicked()}))}if(this.soundToggle){var o=new p;o.target=this.node,o.component="PausePopup",o.handler="onSoundToggled",this.soundToggle.checkEvents.push(o),this.soundToggle.isChecked=!0}},a.setupButtonAnimations=function(n){var t=n.node,e=t.scale.clone(),o=t.getComponent(h),i=o.color.clone();t.on(s.EventType.MOUSE_ENTER,(function(){d(t).to(.1,{scale:new g(1.1,1.1,1)},{easing:"quadOut"}).start(),d(o).to(.1,{color:new f(i.r+30,i.g+30,i.b+30,i.a)}).start()})),t.on(s.EventType.MOUSE_LEAVE,(function(){d(t).to(.1,{scale:e},{easing:"quadOut"}).start(),d(o).to(.1,{color:i}).start()})),t.on(s.EventType.TOUCH_START,(function(){d(t).to(.05,{scale:new g(.95,.95,1)},{easing:"quadOut"}).start()})),t.on(s.EventType.TOUCH_END,(function(){d(t).to(.1,{scale:new g(1.1,1.1,1)},{easing:"backOut"}).start()})),t.on(s.EventType.TOUCH_CANCEL,(function(){d(t).to(.1,{scale:e},{easing:"quadOut"}).start()}))},a.enhanceVisualStyling=function(){this.popupPanel&&d(this.popupPanel.getComponent(h)).to(2,{color:new f(255,255,255,255)}).to(2,{color:new f(255,240,200,255)}).union().repeatForever().start()},a.show=function(){if(console.log("show: "+this.isVisible),!this.isVisible){if(this.isVisible=!0,this.node.active=!0,this.popupPanel)this.popupPanel.setScale(0,0,1),(this.popupPanel.getComponent(b)||this.popupPanel.addComponent(b)).opacity=0;if(this.backgroundOverlay)(this.backgroundOverlay.getComponent(b)||this.backgroundOverlay.addComponent(b)).opacity=0;if(this.backgroundOverlay){var n=this.backgroundOverlay.getComponent(b);d(n).to(.3,{opacity:255},{easing:"quadOut"}).start()}if(this.popupPanel){var t=this.popupPanel.getComponent(b);d(t).to(.2,{opacity:255},{easing:"quadOut"}).start(),d(this.popupPanel).to(.3,{scale:new g(1.2,1.2,1)},{easing:"backOut"}).to(.2,{scale:new g(1,1,1)},{easing:"quadOut"}).start()}}},a.hide=function(n){var t=this;if(void 0===n&&(n=!0),this.isVisible||!n)if(this.isVisible=!1,n){if(this.popupPanel){var e=this.popupPanel.getComponent(b)||this.popupPanel.addComponent(b);d(this.popupPanel).to(.3,{scale:new g(.8,.8,1)},{easing:"backIn"}).start(),d(e).to(.3,{opacity:0},{easing:"quadIn"}).start()}if(this.backgroundOverlay){var o=this.backgroundOverlay.getComponent(b)||this.backgroundOverlay.addComponent(b);d(o).to(.2,{opacity:0},{easing:"quadIn"}).call((function(){t.node.active=!1})).start()}else setTimeout((function(){t.node.active=!1}),300)}else this.node.active=!1},a.setCallbacks=function(n,t){this.onContinueCallback=n,this.onNewGameCallback=t},a.onContinueClicked=function(){var n=this;this.hide(),this.onContinueCallback&&setTimeout((function(){return n.onContinueCallback()}),100)},a.onNewGameClicked=function(){var n=this;this.hide(),this.onNewGameCallback&&setTimeout((function(){return n.onNewGameCallback()}),100)},a.onSoundToggled=function(){if(this.soundToggle){var n=this.soundToggle.isChecked;this.node.getComponentsInChildren(C).forEach((function(t){t.volume=n?1:0})),console.log("Sound toggled:",n?"ON":"OFF")}},a.isSoundEnabled=function(){return!this.soundToggle||this.soundToggle.isChecked},a.setSoundEnabled=function(n){this.soundToggle&&(this.soundToggle.isChecked=n,this.onSoundToggled())},a.onDestroy=function(){var n,t;if(null!=(n=this.continueButton)&&n.node&&this.continueButton.node.off(s.EventType.TOUCH_END),null!=(t=this.newGameButton)&&t.node&&this.newGameButton.node.off(s.EventType.TOUCH_END),this.popupPanel){d(this.popupPanel).stop();var e=this.popupPanel.getComponent(h);e&&d(e).stop()}if(this.backgroundOverlay){var o=this.backgroundOverlay.getComponent(b);o&&d(o).stop()}this.onContinueCallback=null,this.onNewGameCallback=null},t}(v)).prototype,"popupPanel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(B.prototype,"backgroundOverlay",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(B.prototype,"continueButton",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(B.prototype,"newGameButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(B.prototype,"soundToggle",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(B.prototype,"titleLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=B))||E));a._RF.pop()}}}));

System.register("chunks:///_virtual/ProgressManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Singleton.ts"],(function(e){var t,n,s,o,r,i,c;return{setters:[function(e){t=e.inheritsLoose,n=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy,o=e._decorator,r=e.EventTarget},function(e){i=e.GameConfig},function(e){c=e.Singleton}],execute:function(){var l;s._RF.push({},"a1b2cPU5fZ4kBI0VniQq83v","ProgressManager",void 0);var a=o.ccclass;e("ProgressManager",a("ProgressManager")(l=function(e){function s(){for(var t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(t=e.call.apply(e,[this].concat(s))||this).eventTarget=new r,t.currentScore=0,t.currentMilestone=0,t.moveLeft=0,t.totalMilestones=i.MilestoneSystem.milestoneThresholds.length,t.pendingMilestoneData=[],t}t(s,e);var o=s.prototype;return o.onLoad=function(){},o.onDestroy=function(){this.eventTarget.targetOff(this),this.pendingMilestoneData=[]},o.addPendingScore=function(e,t){this.pendingMilestoneData.push({matchCount:e,matchSize:t})},o.processPendingScores=function(){if(0===this.pendingMilestoneData.length)return!1;for(var e,t=0,s=n(this.pendingMilestoneData);!(e=s()).done;){var o=e.value,r=o.matchCount*i.MilestoneSystem.pointsPerTile;o.matchSize>=5?r+=i.MilestoneSystem.bonusPoints.match5Plus:4===o.matchSize&&(r+=i.MilestoneSystem.bonusPoints.match4),t+=r}this.currentScore+=t,this.pendingMilestoneData=[];var c=this.checkMilestoneCompletion();return console.log("Processed pending scores, total points:",t,"currentScore:",this.currentScore),this.eventTarget.emit("progress-updated",this.getMilestoneData()),c},o.addScore=function(e,t){var n=e*i.MilestoneSystem.pointsPerTile;t>=5?n+=i.MilestoneSystem.bonusPoints.match5Plus:4===t&&(n+=i.MilestoneSystem.bonusPoints.match4),this.currentScore+=n;var s=this.checkMilestoneCompletion();return console.log("currentScore",this.currentScore),this.eventTarget.emit("progress-updated",this.getMilestoneData()),s},o.checkMilestoneCompletion=function(){if(this.currentMilestone>=this.totalMilestones)return!1;var e=i.MilestoneSystem.milestoneThresholds[this.currentMilestone];return this.currentScore>=e&&(this.currentMilestone++,this.eventTarget.emit("milestone-completed",this.getMilestoneData()),!0)},o.getMilestoneData=function(){var e=this.currentMilestone<this.totalMilestones?i.MilestoneSystem.milestoneThresholds[this.currentMilestone]:i.MilestoneSystem.milestoneThresholds[this.totalMilestones-1],t=this.currentMilestone>0?i.MilestoneSystem.milestoneThresholds[this.currentMilestone-1]:0,n=this.currentScore-t,s=e-t,o=Math.min(n/s,1);return{currentMilestone:this.currentMilestone,currentScore:this.currentScore,currentMilestoneProgress:o,milestoneThreshold:e,totalMilestones:this.totalMilestones}},o.onProgressUpdate=function(e){this.eventTarget.on("progress-updated",e)},o.onMilestoneCompleted=function(e){this.eventTarget.on("milestone-completed",e)},o.offProgressUpdate=function(e){this.eventTarget.off("progress-updated",e)},o.offMilestoneCompleted=function(e){this.eventTarget.off("milestone-completed",e)},o.resetProgress=function(){this.currentScore=0,this.currentMilestone=0,this.moveLeft=0,this.pendingMilestoneData=[],this.eventTarget.emit("progress-updated",this.getMilestoneData())},o.getCurrentScore=function(){return this.currentScore},o.getCurrentMilestone=function(){return this.currentMilestone},o.getMoveLeft=function(){return this.moveLeft},s}(c))||l);s._RF.pop()}}}));

System.register("chunks:///_virtual/ProgressUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ProgressManager.ts","./GameConfig.ts"],(function(e){var s,o,t,r,n,a,i,l,c,h,g,d,u,b,p,L,m,f;return{setters:[function(e){s=e.applyDecoratedDescriptor,o=e.inheritsLoose,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,i=e.ProgressBar,l=e.Label,c=e.Node,h=e.Color,g=e.Vec2,d=e.tween,u=e.Vec3,b=e.UITransform,p=e.Sprite,L=e.Component},function(e){m=e.ProgressManager},function(e){f=e.GameConfig}],execute:function(){var B,w,v,M,S,C,k,y,P,z,I,O,D,U,T;n._RF.push({},"b2c3d4e5-f6g7-8901-2345-678901bcdefg","ProgressUI",void 0);var x=a.ccclass,N=a.property;e("ProgressUI",(B=x("ProgressUI"),w=N(i),v=N(l),M=N(l),S=N(l),C=N(l),k=N(c),B((z=s((P=function(e){function s(){for(var s,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return s=e.call.apply(e,[this].concat(n))||this,t(s,"progressBar",z,r(s)),t(s,"milestoneLabel",I,r(s)),t(s,"scoreLabel",O,r(s)),t(s,"progressLabel",D,r(s)),t(s,"movesLabel",U,r(s)),t(s,"celebrationNode",T,r(s)),s.progressManager=null,s.scoreBackground=null,s.progressBackground=null,s.milestoneBackground=null,s}o(s,e);var n=s.prototype;return n.start=function(){this.progressManager=m.getInstance(),this.progressManager?(this.enhanceUIElements(),this.progressManager.onProgressUpdate(this.updateProgressDisplay.bind(this)),this.progressManager.onMilestoneCompleted(this.onMilestoneCompleted.bind(this)),this.updateProgressDisplay(this.progressManager.getMilestoneData()),this.updateMovesDisplay(f.Moves)):console.error("ProgressManager not found")},n.enhanceUIElements=function(){this.enhanceScoreLabel(),this.enhanceMilestoneLabel(),this.enhanceProgressLabel(),this.enhanceProgressBar(),this.addUIBackgrounds(),this.enhanceMovesLabel()},n.enhanceMovesLabel=function(){this.movesLabel&&(this.movesLabel.color=new h(255,255,255,255),this.movesLabel.fontSize=22,this.movesLabel.isBold=!0,this.movesLabel.enableOutline=!0,this.movesLabel.outlineColor=new h(0,0,139,255),this.movesLabel.outlineWidth=2,this.movesLabel.enableShadow=!0,this.movesLabel.shadowColor=new h(0,0,0,100),this.movesLabel.shadowOffset=new g(1,-1),this.movesLabel.shadowBlur=3)},n.enhanceScoreLabel=function(){this.scoreLabel&&(this.scoreLabel.color=new h(255,215,0,255),this.scoreLabel.fontSize=28,this.scoreLabel.isBold=!0,this.scoreLabel.enableOutline=!0,this.scoreLabel.outlineColor=new h(139,69,19,255),this.scoreLabel.outlineWidth=3,this.scoreLabel.enableShadow=!0,this.scoreLabel.shadowColor=new h(255,165,0,150),this.scoreLabel.shadowOffset=new g(0,0),this.scoreLabel.shadowBlur=8)},n.enhanceMilestoneLabel=function(){this.milestoneLabel&&(this.milestoneLabel.color=new h(147,0,211,255),this.milestoneLabel.fontSize=24,this.milestoneLabel.isBold=!0,this.milestoneLabel.enableOutline=!0,this.milestoneLabel.outlineColor=new h(255,255,255,255),this.milestoneLabel.outlineWidth=2,this.milestoneLabel.enableShadow=!0,this.milestoneLabel.shadowColor=new h(0,0,0,100),this.milestoneLabel.shadowOffset=new g(1,-1),this.milestoneLabel.shadowBlur=3)},n.enhanceProgressLabel=function(){this.progressLabel&&(this.progressLabel.color=new h(0,255,255,255),this.progressLabel.fontSize=22,this.progressLabel.isBold=!0,this.progressLabel.enableOutline=!0,this.progressLabel.outlineColor=new h(0,0,139,255),this.progressLabel.outlineWidth=2)},n.enhanceProgressBar=function(){if(this.progressBar){this.progressBar.barSprite&&this.updateProgressBarColor(this.progressBar.progress);var e=this.progressBar.node;e&&d(e).to(.3,{scale:new u(1.05,1.05,1)}).to(.3,{scale:new u(1,1,1)}).union().repeatForever().start()}},n.updateProgressBarColor=function(e){var s;if(null!=(s=this.progressBar)&&s.barSprite){var o;if(e<.3)o=new h(255,Math.floor(e/.3*165),0,255);else if(e<.7){var t=(e-.3)/.4;o=new h(255,Math.floor(165+90*t),0,255)}else{var r=(e-.7)/.3;o=new h(Math.floor(255-255*r),255,Math.floor(100*r),255)}this.progressBar.barSprite.color=o}},n.addUIBackgrounds=function(){this.createScoreBackground(),this.createMilestoneBackground(),this.createProgressBackground()},n.createScoreBackground=function(){var e;if(this.scoreLabel){this.scoreBackground=new c("ScoreBackground"),null==(e=this.scoreLabel.node.parent)||e.addChild(this.scoreBackground),this.scoreBackground.setPosition(this.scoreLabel.node.position),this.scoreBackground.setSiblingIndex(this.scoreLabel.node.getSiblingIndex()),this.scoreBackground.addComponent(b).setContentSize(120,50);var s=this.scoreBackground.addComponent(p);s.type=p.Type.SLICED,s.sizeMode=p.SizeMode.CUSTOM,s.color=new h(139,69,19,200),d(this.scoreBackground).to(1,{scale:new u(1.1,1.1,1)}).to(1,{scale:new u(1,1,1)}).union().repeatForever().start()}},n.createMilestoneBackground=function(){var e;if(this.milestoneLabel){this.milestoneBackground=new c("MilestoneBackground"),null==(e=this.milestoneLabel.node.parent)||e.addChild(this.milestoneBackground),this.milestoneBackground.setPosition(this.milestoneLabel.node.position),this.milestoneBackground.setSiblingIndex(this.milestoneLabel.node.getSiblingIndex()),this.milestoneBackground.addComponent(b).setContentSize(160,45);var s=this.milestoneBackground.addComponent(p);s.type=p.Type.SLICED,s.sizeMode=p.SizeMode.CUSTOM,s.color=new h(75,0,130,180)}},n.createProgressBackground=function(){var e;if(this.progressBar){this.progressBackground=new c("ProgressBackground"),null==(e=this.progressBar.node.parent)||e.addChild(this.progressBackground),this.progressBackground.setPosition(this.progressBar.node.position.x,this.progressBar.node.position.y+5),this.progressBackground.setSiblingIndex(this.progressBar.node.getSiblingIndex()),this.progressBackground.addComponent(b).setContentSize(220,60);var s=this.progressBackground.addComponent(p);s.type=p.Type.SLICED,s.sizeMode=p.SizeMode.CUSTOM,s.color=new h(25,25,112,150);var o=new c("ProgressBorder");this.progressBackground.addChild(o),o.addComponent(b).setContentSize(225,65);var t=o.addComponent(p);t.type=p.Type.SLICED,t.sizeMode=p.SizeMode.CUSTOM,t.color=new h(255,215,0,100)}},n.updateProgressDisplay=function(e){var s=this;if(this.progressBar){var o=e.currentMilestoneProgress;d(this.progressBar).to(.8,{progress:o},{easing:"quartOut",onUpdate:function(){s.updateProgressBarColor(s.progressBar.progress)}}).start()}if(this.milestoneLabel){var t="Level: "+(e.currentMilestone+1);this.milestoneLabel.string!==t&&this.animateTextChange(this.milestoneLabel,t)}if(this.scoreLabel){var r="Score: "+e.currentScore.toLocaleString();this.scoreLabel.string!==r&&this.animateScoreChange(this.scoreLabel,r)}if(this.progressLabel){var n=Math.floor(100*e.currentMilestoneProgress)+"%";this.progressLabel.string!==n&&this.animateTextChange(this.progressLabel,n)}},n.animateTextChange=function(e,s){d(e.node).to(.1,{scale:new u(1.3,1.3,1)}).call((function(){e.string=s})).to(.2,{scale:new u(1,1,1)},{easing:"backOut"}).start()},n.animateScoreChange=function(e,s){var o=e.color.clone(),t=new h(255,255,255,255);d(e).to(.1,{color:t}).to(.2,{color:o}).start(),d(e.node).to(.15,{scale:new u(1.4,1.4,1)}).call((function(){e.string=s})).to(.25,{scale:new u(1,1,1)},{easing:"elasticOut"}).start()},n.onMilestoneCompleted=function(e){this.playEnhancedCelebrationAnimation(),this.updateProgressDisplay(e)},n.playEnhancedCelebrationAnimation=function(){var e=this;this.celebrateScoreLabel(),this.celebrateMilestoneLabel(),this.celebrateProgressBar(),this.celebrationNode&&(this.celebrationNode.setScale(0,0,1),this.celebrationNode.active=!0,d(this.celebrationNode).to(.4,{scale:new u(1.3,1.3,1)},{easing:"backOut"}).to(.3,{scale:new u(1,1,1)},{easing:"quadOut"}).delay(2).to(.4,{scale:new u(0,0,1)},{easing:"backIn"}).call((function(){e.celebrationNode.active=!1})).start())},n.celebrateScoreLabel=function(){var e=this;if(this.scoreLabel){var s=this.scoreLabel.color.clone(),o=[new h(255,215,0,255),new h(255,255,255,255),new h(255,165,0,255),new h(255,215,0,255)],t=0;d(this.scoreLabel).repeat(4,d(this.scoreLabel).call((function(){e.scoreLabel.color=o[t],t=(t+1)%o.length})).delay(.2)).call((function(){e.scoreLabel.color=s})).start()}},n.celebrateMilestoneLabel=function(){this.milestoneLabel&&d(this.milestoneLabel.node).to(.2,{scale:new u(1.5,1.5,1)}).to(.3,{scale:new u(1,1,1)},{easing:"bounceOut"}).start()},n.celebrateProgressBar=function(){var e,s=this;if(null!=(e=this.progressBar)&&e.barSprite){var o=this.progressBar.barSprite.color.clone(),t=[new h(255,0,0,255),new h(255,165,0,255),new h(255,255,0,255),new h(0,255,0,255),new h(0,0,255,255),new h(75,0,130,255),new h(238,130,238,255)],r=0;d(this.progressBar.barSprite).repeat(t.length,d(this.progressBar.barSprite).call((function(){s.progressBar.barSprite.color=t[r],r++})).delay(.15)).call((function(){s.progressBar.barSprite.color=o})).start()}},n.resetProgress=function(){this.progressManager&&this.progressManager.resetProgress()},n.onDestroy=function(){var e,s,o,t,r,n;this.progressManager&&(this.progressManager.offProgressUpdate(this.updateProgressDisplay.bind(this)),this.progressManager.offMilestoneCompleted(this.onMilestoneCompleted.bind(this))),null!=(e=this.progressBar)&&e.node&&d(this.progressBar.node).stop(),null!=(s=this.progressBar)&&s.barSprite&&d(this.progressBar.barSprite).stop(),null!=(o=this.scoreLabel)&&o.node&&(d(this.scoreLabel.node).stop(),d(this.scoreLabel).stop()),null!=(t=this.milestoneLabel)&&t.node&&d(this.milestoneLabel.node).stop(),null!=(r=this.progressLabel)&&r.node&&d(this.progressLabel.node).stop(),null!=(n=this.movesLabel)&&n.node&&(d(this.movesLabel.node).stop(),d(this.movesLabel).stop()),this.celebrationNode&&d(this.celebrationNode).stop(),this.scoreBackground&&this.scoreBackground.isValid&&(d(this.scoreBackground).stop(),this.scoreBackground.destroy()),this.progressBackground&&this.progressBackground.isValid&&this.progressBackground.destroy(),this.milestoneBackground&&this.milestoneBackground.isValid&&this.milestoneBackground.destroy()},n.updateMovesDisplay=function(e){if(this.movesLabel){console.log("movesRemaining",e);var s="Moves: "+e;this.movesLabel.string!==s&&this.animateMovesChange(e,s)}},n.animateMovesChange=function(e,s){var o,t=this;this.movesLabel&&(o=e<=5?new h(255,69,0,255):e<=10?new h(255,165,0,255):new h(255,255,255,255),d(this.movesLabel).to(.1,{color:new h(255,255,255,255)}).to(.2,{color:o}).start(),d(this.movesLabel.node).to(.1,{scale:new u(1.2,1.2,1)}).call((function(){t.movesLabel.string=s})).to(.2,{scale:new u(1,1,1)},{easing:"backOut"}).start(),e<=0?d(this.movesLabel.node).delay(.3).to(.15,{scale:new u(1.3,1.3,1)}).to(.15,{scale:new u(.9,.9,1)}).to(.15,{scale:new u(1.3,1.3,1)}).to(.15,{scale:new u(1,1,1)}).start():e<=5&&d(this.movesLabel.node).delay(.3).to(.1,{scale:new u(1.1,1.1,1)}).to(.1,{scale:new u(1,1,1)}).to(.1,{scale:new u(1.1,1.1,1)}).to(.1,{scale:new u(1,1,1)}).start())},s}(L)).prototype,"progressBar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=s(P.prototype,"milestoneLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=s(P.prototype,"scoreLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=s(P.prototype,"progressLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=s(P.prototype,"movesLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=s(P.prototype,"celebrationNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/ResponsiveWidget.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,n,o,s,a,r,c,l,h,u,f,p;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){s=e.cclegacy,a=e._decorator,r=e.Size,c=e.Vec3,l=e.UITransform,h=e.Widget,u=e.screen,f=e.view,p=e.Component}],execute:function(){var g,d,S,m,w,v,A,y,R,b,I,z,E,T,M;s._RF.push({},"247a3cr90pEVZy7W0V47Jmj","ResponsiveWidget",void 0);var _=a.ccclass,C=a.property,L=e("ResponsiveMode",function(e){return e[e.MAINTAIN_ASPECT_RATIO=0]="MAINTAIN_ASPECT_RATIO",e[e.FILL_SCREEN=1]="FILL_SCREEN",e[e.SCALE_WITH_SCREEN=2]="SCALE_WITH_SCREEN",e[e.FIXED_SIZE=3]="FIXED_SIZE",e}({}));e("ResponsiveWidget",(g=_("ResponsiveWidget"),d=C({type:L,tooltip:"How this widget should respond to screen size changes"}),S=C({tooltip:"Minimum scale factor (prevents UI from becoming too small)"}),m=C({tooltip:"Maximum scale factor (prevents UI from becoming too large)"}),w=C({tooltip:"Reference resolution width for scaling calculations"}),v=C({tooltip:"Reference resolution height for scaling calculations"}),A=C({tooltip:"Apply safe area adjustments for mobile devices"}),g((b=i((R=function(e){function i(){for(var i,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return i=e.call.apply(e,[this].concat(s))||this,n(i,"responsiveMode",b,o(i)),n(i,"minScale",I,o(i)),n(i,"maxScale",z,o(i)),n(i,"referenceWidth",E,o(i)),n(i,"referenceHeight",T,o(i)),n(i,"applySafeArea",M,o(i)),i.originalSize=new r,i.originalScale=new c,i.uiTransform=null,i.widget=null,i}t(i,e);var s=i.prototype;return s.onLoad=function(){var e=this;this.uiTransform=this.getComponent(l),this.widget=this.getComponent(h),this.uiTransform&&(this.originalSize=this.uiTransform.contentSize.clone()),this.originalScale=this.node.scale.clone(),u.on("window-resize",this.onScreenResize,this),u.on("orientation-change",this.onOrientationChange,this),this.scheduleOnce((function(){e.updateResponsiveLayout()}),.1)},s.onDestroy=function(){u.off("window-resize",this.onScreenResize,this),u.off("orientation-change",this.onOrientationChange,this)},s.onScreenResize=function(){var e=this;this.scheduleOnce((function(){e.updateResponsiveLayout()}),.1)},s.onOrientationChange=function(){var e=this;this.scheduleOnce((function(){e.updateResponsiveLayout()}),.2)},s.updateResponsiveLayout=function(){if(this.uiTransform){var e=f.getVisibleSize(),i=u.windowSize;switch(console.log("ResponsiveWidget: Updating layout for screen "+i.width+"x"+i.height),this.responsiveMode){case L.MAINTAIN_ASPECT_RATIO:this.maintainAspectRatio(e);break;case L.FILL_SCREEN:this.fillScreen(e);break;case L.SCALE_WITH_SCREEN:this.scaleWithScreen(e);break;case L.FIXED_SIZE:this.useFixedSize()}this.applySafeArea&&this.applySafeAreaAdjustments(),this.widget&&this.widget.updateAlignment()}},s.maintainAspectRatio=function(e){var i=e.width/this.referenceWidth,t=e.height/this.referenceHeight,n=Math.min(i,t);n=Math.max(this.minScale,Math.min(this.maxScale,n)),this.node.setScale(this.originalScale.x*n,this.originalScale.y*n,this.originalScale.z)},s.fillScreen=function(e){if(this.uiTransform){this.uiTransform.setContentSize(e.width-20,e.height-20)}},s.scaleWithScreen=function(e){var i=e.width/this.referenceWidth,t=e.height/this.referenceHeight,n=Math.max(this.minScale,Math.min(this.maxScale,i)),o=Math.max(this.minScale,Math.min(this.maxScale,t));this.node.setScale(this.originalScale.x*n,this.originalScale.y*o,this.originalScale.z)},s.useFixedSize=function(){this.uiTransform&&this.uiTransform.setContentSize(this.originalSize),this.node.setScale(this.originalScale)},s.applySafeAreaAdjustments=function(){var e=u.windowSize,i=e.width>e.height;if(this.isMobileDevice()&&this.widget){var t=i?40:20;this.widget.top<t&&this.widget.isAlignTop&&(this.widget.top=t),this.widget.bottom<t&&this.widget.isAlignBottom&&(this.widget.bottom=t),this.widget.left<t&&this.widget.isAlignLeft&&(this.widget.left=t),this.widget.right<t&&this.widget.isAlignRight&&(this.widget.right=t)}},s.isMobileDevice=function(){return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||u.windowSize.width<768},s.forceUpdate=function(){this.updateResponsiveLayout()},s.setResponsiveMode=function(e){this.responsiveMode=e,this.updateResponsiveLayout()},s.getScaleInfo=function(){return{scale:this.node.scale.clone(),originalScale:this.originalScale.clone(),mode:this.responsiveMode}},i}(p)).prototype,"responsiveMode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L.MAINTAIN_ASPECT_RATIO}}),I=i(R.prototype,"minScale",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),z=i(R.prototype,"maxScale",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),E=i(R.prototype,"referenceWidth",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 390}}),T=i(R.prototype,"referenceHeight",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 844}}),M=i(R.prototype,"applySafeArea",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),y=R))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/ScreenAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,n,t,o,a,s,r,c,h,l,d,u,g,p,f,S;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,s=e._decorator,r=e.Canvas,c=e.Camera,h=e.Node,l=e.screen,d=e.view,u=e.ResolutionPolicy,g=e.UITransform,p=e.Rect,f=e.Vec3,S=e.Component}],execute:function(){var w,m,v,z,b,C,A,R,y;a._RF.push({},"d8c6ercWfFCA7ex89rKLFXN","ScreenAdapter",void 0);var L=s.ccclass,M=s.property;e("ScreenAdapter",(w=L("ScreenAdapter"),m=M(r),v=M(c),z=M(h),w((A=i((C=function(e){function i(){for(var i,n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return i=e.call.apply(e,[this].concat(a))||this,t(i,"canvas",A,o(i)),t(i,"camera",R,o(i)),t(i,"gameContainer",y,o(i)),i.designResolution={width:390,height:844},i.isLandscape=!1,i}n(i,e);var a=i.prototype;return a.onLoad=function(){var e=this;this.setupScreenAdapter(),l.on("orientation-change",this.onOrientationChange,this),l.on("window-resize",this.onWindowResize,this),this.scheduleOnce((function(){e.adaptToScreen()}),.1)},a.onDestroy=function(){l.off("orientation-change",this.onOrientationChange,this),l.off("window-resize",this.onWindowResize,this)},a.setupScreenAdapter=function(){this.canvas||(this.canvas=this.getComponent(r)||this.node.getComponentInChildren(r)),this.camera||(this.camera=this.getComponent(c)||this.node.getComponentInChildren(c))},a.onOrientationChange=function(){var e=this;this.scheduleOnce((function(){e.adaptToScreen()}),.1)},a.onWindowResize=function(){var e=this;this.scheduleOnce((function(){e.adaptToScreen()}),.1)},a.adaptToScreen=function(){var e=l.windowSize,i=d.getVisibleSize(),n=d.getFrameSize();console.log("Screen adaptation - Screen size:",e),console.log("Screen adaptation - Visible size:",i),console.log("Screen adaptation - Frame size:",n),this.isLandscape=e.width>e.height;var t=e.width/e.height,o=this.designResolution.width/this.designResolution.height;console.log("Screen aspect:",t,"Design aspect:",o);var a=u.SHOW_ALL,s=1;this.isMobile()?Math.abs(t-o)<.1?a=u.EXACT_FIT:t>o?a=u.SHOW_ALL:(a=u.FIXED_HEIGHT,s=Math.min(i.width/this.designResolution.width,i.height/this.designResolution.height)):a=u.SHOW_ALL,d.setDesignResolutionSize(this.designResolution.width,this.designResolution.height,a),this.applyAdditionalScaling(s,i),this.adjustUIElements()},a.applyAdditionalScaling=function(e,i){if(this.gameContainer){var n=e;i.width<360||i.height<640?n=Math.max(.8,.9*e):(i.width>800||i.height>1400)&&(n=Math.min(1.2,1.1*e)),console.log("Applying additional scale:",n),1!==n&&this.gameContainer.setScale(n,n,1)}},a.adjustUIElements=function(){if(this.canvas){var e=this.canvas.getComponent(g);if(e){var i=d.getVisibleSize();e.setContentSize(i.width,i.height)}}this.camera&&this.isMobile()&&(this.camera.rect=new p(0,0,1,1))},a.isMobile=function(){return l.devicePixelRatio>1&&(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||l.windowSize.width<768)},a.forceAdaptation=function(){this.adaptToScreen()},a.getAdaptationInfo=function(){var e;return{visibleSize:d.getVisibleSize(),screenSize:l.windowSize,designResolution:this.designResolution,isLandscape:this.isLandscape,isMobile:this.isMobile(),currentScale:(null==(e=this.gameContainer)?void 0:e.scale)||new f(1,1,1)}},i}(S)).prototype,"canvas",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=i(C.prototype,"camera",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(C.prototype,"gameContainer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=C))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/SelectState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileState.ts","./AnimationManager.ts"],(function(n){var t,e,a,i;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy},function(n){a=n.TileState},function(n){i=n.AnimationManager}],execute:function(){e._RF.push({},"f621dOHpPFLWbtXLt0mpO4n","SelectState",void 0);n("SelectState",function(n){function e(t){var e;return(e=n.call(this,t)||this).animationHandler=null,e.animationHandler=t.getComponent(i),e}t(e,n);var a=e.prototype;return a.onEnter=function(){var n;null==(n=this.animationHandler)||n.animateSelection()},a.onExit=function(){var n;null==(n=this.animationHandler)||n.animateDeselection()},a.onUpdate=function(){},a.onPlayerIdle=function(){var n;null==(n=this.animationHandler)||n.animatePlayerIdle()},e}(a));e._RF.pop()}}}));

System.register("chunks:///_virtual/Singleton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,i;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,i=n.Component}],execute:function(){e._RF.push({},"f0d79BgePNIh6MBcfYXaFnz","Singleton",void 0),n("Singleton",function(n){function e(){return n.apply(this,arguments)||this}return t(e,n),e.getInstance=function(){if(!e.instances.has(this)){var n=new this;e.instances.set(this,n),"function"==typeof n.initialize&&n.initialize()}return e.instances.get(this)},e.hasInstance=function(){return e.instances.has(this)},e.destroyInstance=function(){e.instances.delete(this)},e.getAllInstances=function(){return new Map(e.instances)},e.clearAllInstances=function(){e.instances.clear()},e.prototype.initialize=function(){},e.getCurrentInstance=function(){return e.instances.get(this)||null},e}(i)).instances=new Map,e._RF.pop()}}}));

System.register("chunks:///_virtual/SpecialTileConfig.ts",["cc"],(function(e){var o,i;return{setters:[function(e){o=e.cclegacy,i=e.Color}],execute:function(){o._RF.push({},"c1d2e3f4-g5h6-7890-1234-567890abcdef","SpecialTileConfig",void 0);var n=e("SpecialTileType",function(e){return e.NORMAL="normal",e.BOMB="bomb",e.RAINBOW="rainbow",e.STRIPED_HORIZONTAL="striped_horizontal",e.STRIPED_VERTICAL="striped_vertical",e.WRAPPED="wrapped",e}({}));e("SpecialTileConfig",{NORMAL:{type:n.NORMAL,name:"Normal",color:new i(255,255,255,255)},BOMB:{type:n.BOMB,name:"Bomb Candy",color:new i(128,128,128,255),effectRadius:1,activationSound:"bomb_explosion"},RAINBOW:{type:n.RAINBOW,name:"Rainbow Candy",color:new i(255,255,255,255),matchesAllColors:!0,activationSound:"rainbow_burst"},STRIPED_HORIZONTAL:{type:n.STRIPED_HORIZONTAL,name:"Horizontal Striped Candy",color:new i(255,255,255,255),direction:"horizontal",activationSound:"striped_activation"},STRIPED_VERTICAL:{type:n.STRIPED_VERTICAL,name:"Vertical Striped Candy",color:new i(255,255,255,255),direction:"vertical",activationSound:"striped_activation"},WRAPPED:{type:n.WRAPPED,name:"Wrapped Candy",color:new i(255,255,255,255),effectRadius:2,activationSound:"wrapped_explosion"}});o._RF.pop()}}}));

System.register("chunks:///_virtual/SpecialTileManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpecialTileConfig.ts","./GameConfig.ts","./BoardManager.ts","./ParticleEffectManager.ts"],(function(e){var i,r,t,a,n,o,c,l,s,u,f,d;return{setters:[function(e){i=e.inheritsLoose,r=e.asyncToGenerator,t=e.regeneratorRuntime,a=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,o=e._decorator,c=e.Component},function(e){l=e.SpecialTileType,s=e.SpecialTileConfig},function(e){u=e.GameConfig},function(e){f=e.BoardManager},function(e){d=e.ParticleEffectManager}],execute:function(){var p;n._RF.push({},"d2e3f4g5-h6i7-8901-2345-678901bcdefg","SpecialTileManager",void 0);var v=o.ccclass;e("SpecialTileManager",v("SpecialTileManager")(p=function(e){function n(){for(var i,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(i=e.call.apply(e,[this].concat(t))||this).boardManager=null,i.particleEffectManager=null,i}i(n,e);var o=n.prototype;return o.onLoad=function(){this.boardManager=this.node.getComponent(f),this.particleEffectManager=this.node.getComponent(d)},o.determineSpecialTileType=function(e){return 4===e.length?l.BOMB:l.RAINBOW},o.createSpecialTile=function(){var e=r(t().mark((function e(i,r,n,o){var c,l,s,u,f,d,p,v;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&i.node&&i.node.isValid){e.next=2;break}return e.abrupt("return");case 2:i.setSpecialType(r),null==(c=this.particleEffectManager)||c.createTileParticleEffect(i,r),l=Array(),s=n.filter((function(e){return e.node&&e.node.isValid})).length,u=0,f=function(){++u>=s&&(null==o||o())},d=a(n);case 9:if((p=d()).done){e.next=16;break}if((v=p.value)&&v.node&&v.node.isValid){e.next=13;break}return e.abrupt("continue",14);case 13:l.push(v.playCombineEffect(i,(function(){f()})));case 14:e.next=9;break;case 16:return e.next=18,Promise.all(l);case 18:case"end":return e.stop()}}),e,this)})));return function(i,r,t,a){return e.apply(this,arguments)}}(),o.activateSpecialTile=function(e,i,r,t,a){if(void 0===t&&(t=!1),void 0===a&&(a=!1),!e||!e.node||!e.node.isValid)return[];var n=e.getSpecialType(),o=this.boardManager.getTileGrid();if(console.log("Activating special tile:",n,"at coords:",r,"isPlayerSwap:",t),!r)return[];switch(n){case l.BOMB:return this.activateBombTile(r.x,r.y,o,e);case l.RAINBOW:return this.activateRainbowTile(e,i,o,t,a);case l.STRIPED_HORIZONTAL:return this.activateStripedTile(r.x,r.y,o,"horizontal");case l.STRIPED_VERTICAL:return this.activateStripedTile(r.x,r.y,o,"vertical");case l.WRAPPED:return this.activateWrappedTile(r.x,r.y,o,e);default:return[]}},o.activateBombTile=function(e,i,r,t){for(var a=[],n=s.BOMB.effectRadius||1,o=-n;o<=n;o++)for(var c=-n;c<=n;c++){var l=e+c,f=i+o;if(l>=0&&l<u.GridWidth&&f>=0&&f<u.GridHeight){var d=r[f][l];d&&d.node&&d.node.isValid&&!d.isRainbowTile()&&a.push(d)}}return a},o.activateStripedTile=function(e,i,r,t){var a=[];if("horizontal"===t)for(var n=0;n<u.GridWidth;n++){var o=r[i][n];o&&o.node&&o.node.isValid&&a.push(o)}else for(var c=0;c<u.GridHeight;c++){var l=r[c][e];l&&l.node&&l.node.isValid&&a.push(l)}return a},o.activateWrappedTile=function(e,i,a,n){for(var o=this,c=[],l=s.WRAPPED.effectRadius||2,f=-1;f<=1;f++)for(var d=-1;d<=1;d++){var p=e+d,v=i+f;if(p>=0&&p<u.GridWidth&&v>=0&&v<u.GridHeight){var h=a[v][p];h&&h.node&&h.node.isValid&&c.push(h)}}return setTimeout(r(t().mark((function r(){var c,s,f,d,p,v,h,g;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(c=[],s=-l;s<=l;s++)for(f=-l;f<=l;f++)p=i+s,(d=e+f)>=0&&d<u.GridWidth&&p>=0&&p<u.GridHeight&&(v=a[p][d])&&v.node&&v.node.isValid&&c.push(v);if(!(o.particleEffectManager&&n.node&&n.node.parent)){r.next=6;break}return g=c.map((function(e){return e.node.worldPosition})),r.next=6,null==(h=o.particleEffectManager)?void 0:h.playMultipleEffects(g,"explosion",n.node.parent);case 6:case"end":return r.stop()}}),r)}))),300),c},o.activateRainbowTile=function(e,i,r,t,a){void 0===t&&(t=!1),void 0===a&&(a=!1);var n=[];if(a)return this.activateRainbowClick(e,i,r);if(!t)return[];if(i.isRainbowTile())return r.forEach((function(e){e.forEach((function(e){e&&e.node&&e.node.isValid&&n.push(e)}))})),n;for(var o=0;o<u.GridHeight;o++)for(var c=0;c<u.GridWidth;c++){var l=r[o][c];l&&i&&l.getTileType()===i.getTileType()&&!l.isRainbowTile()&&n.push(l)}return n},o.activateRainbowClick=function(e,i,r){var t=[],a=new Set,n=this.boardManager.getTileCoords().get(e);if(!n)return t;var o=n.x,c=n.y,l=this.spiralTraversal(o,c,a,t,5,r,[{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}]);return t.length=0,t.push.apply(t,l),console.log("affectedTiles",t),t},o.spiralTraversal=function(e,i,r,t,a,n,o){var c=this,l=[].concat(t),s=new Set(r);return function e(i,r,t,u,f,d,p){if(!(p>=a*a)){if(c.isInBounds(i,r,n)){var v=n[r][i];v&&v.node&&v.node.isValid&&!s.has(v)&&(l.push(v),s.add(v))}var h=i+o[t].x,g=r+o[t].y,T=f+1,y=p+1;if(T===u){var b=d+1;e(h,g,(t+1)%4,b%2==0?u+1:u,0,b,y)}else e(h,g,t,u,T,d,y)}}(e,i,0,1,0,0,0),l},o.isInBounds=function(e,i,r){return e>=0&&e<u.GridWidth&&i>=0&&i<u.GridHeight&&void 0!==r[i][e]},n}(c))||p);n._RF.pop()}}}));

System.register("chunks:///_virtual/Tile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./SpecialTileConfig.ts","./IdleState.ts","./SelectState.ts","./GameGlobalData.ts","./AnimationManager.ts"],(function(e){var t,n,i,o,a,s,r,l,c,p,u,h,d,f,m,w,b,v,S,g,y,T,C,k,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose,s=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){l=e.cclegacy,c=e._decorator,p=e.Sprite,u=e.Prefab,h=e.resources,d=e.SpriteAtlas,f=e.Color,m=e.UITransform,w=e.Vec3,b=e.Component,v=e.instantiate,S=e.ParticleSystem2D},function(e){g=e.GameConfig},function(e){y=e.SpecialTileType},function(e){T=e.IdleState},function(e){C=e.SelectState},function(e){k=e.GameGlobalData},function(e){M=e.AnimationManager}],execute:function(){var R,D,A,F,P,O,z;l._RF.push({},"df56acXknlGaYhEaXrwyRVa","Tile",void 0);var E=c.ccclass,I=c.property;e("Tile",(R=E("Tile"),D=I(p),A=I(u),R((O=t((P=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,i(t,"sprite",O,o(t)),i(t,"particleEffect",z,o(t)),t.tileType=g.CandyTypes[0],t.specialType=y.NORMAL,t.isRainbow=!1,t.callbacks=[],t.currentState=null,t.states=new Map,t.correspondingFrame=null,t.mouseDownPos=null,t.isMouseDownOnThis=!1,t.clickThreshold=10,t.onRainbowClickCallbacks=[],t}n(t,e);var l=t.prototype;return l.__preload=function(){if(!this.sprite)throw new Error("Sprite is required");if(!this.particleEffect)throw new Error("Particle effect is required")},l.onLoad=function(){this.states.set("idle",new T(this)),this.states.set("select",new C(this)),this.changeState("idle"),this.node.on("mouse-down",this.onMouseDown,this),this.node.on("mouse-enter",this.onMouseEnter,this),this.node.on("mouse-leave",this.onMouseLeave,this),this.node.on("mouse-up",this.onMouseUp,this)},l.addOnClickCallback=function(e){this.callbacks.push(e)},l.removeOnClickCallback=function(e){this.callbacks=e?this.callbacks.filter((function(t){return t!==e})):[]},l.addOnMouseDownCallback=function(e){this.callbacks.push(e)},l.removeOnMouseDownCallback=function(e){e&&(this.callbacks=this.callbacks.filter((function(t){return t!==e})))},l.addOnMouseUpCallback=function(e){this.callbacks.push(e)},l.removeOnMouseUpCallback=function(e){this.callbacks=e?this.callbacks.filter((function(t){return t!==e})):[]},l.addOnRainbowClickCallback=function(e){this.onRainbowClickCallbacks.push(e)},l.removeOnRainbowClickCallback=function(e){this.onRainbowClickCallbacks=e?this.onRainbowClickCallbacks.filter((function(t){return t!==e})):[]},l.emitOnMouseDown=function(){for(var e,t=a(this.callbacks);!(e=t()).done;){(0,e.value)(this)}},l.emitOnMouseUp=function(){for(var e,t=a(this.callbacks);!(e=t()).done;){(0,e.value)(this)}},l.getTileType=function(){return this.tileType},l.setTileType=function(e){this.tileType=e,this.updateTileAppearance()},l.getSpecialType=function(){return this.specialType},l.setSpecialType=function(e){this.specialType=e,this.isRainbow=e===y.RAINBOW,this.updateTileAppearance()},l.isSpecial=function(){return this.specialType!==y.NORMAL},l.setRainbowTile=function(e){this.isRainbow=e,this.updateTileAppearance()},l.isRainbowTile=function(){return this.isRainbow},l.canMatchWith=function(e){return!(!this.isRainbow&&!e.isRainbow)||this.tileType===e.tileType},l.updateTileAppearance=function(){this.isRainbow?this.updateRainbowAppearance():this.specialType===y.BOMB?this.updateBombAppearance():this.specialType===y.STRIPED_HORIZONTAL?this.updateStripedAppearance("horizontal"):this.specialType===y.STRIPED_VERTICAL?this.updateStripedAppearance("vertical"):this.specialType===y.WRAPPED?this.updateWrappedAppearance():this.updateNormalAppearance()},l.updateNormalAppearance=function(){var e=this;h.load("images/atlas/candies",d,(function(t,n){var i;if(t)console.error("Failed to load atlas: "+t);else if(console.log("updateNormalAppearance",null==(i=e.tileType)?void 0:i.name),e.tileType){var o=n.getSpriteFrame(e.tileType.name);if(o)e.sprite.spriteFrame=o,e.sprite.color=new f(255,255,255,255),e.sprite.node.getComponent(m).setContentSize(g.SpriteSize,g.SpriteSize);else console.error("Sprite frame for "+e.tileType.name+" not found in atlas")}else console.error("Tile type is not set")}))},l.updateBombAppearance=function(){var e=this;h.load("images/atlas/candies",d,(function(t,n){if(t)console.error("Failed to load atlas: "+t);else{var i=n.getSpriteFrame(e.tileType.name);i&&(e.sprite.spriteFrame=i),e.sprite.node.getComponent(m).setContentSize(g.SpriteSize,g.SpriteSize),console.log("updateBombAppearance",e.specialType)}}))},l.updateStripedAppearance=function(e){var t=this;h.load("images/atlas/candies",d,(function(e,n){if(e)console.error("Failed to load atlas: "+e);else{var i=n.getSpriteFrame(t.tileType.name);i&&(t.sprite.spriteFrame=i),t.sprite.color=new f(200,200,255,255),t.sprite.node.getComponent(m).setContentSize(g.SpriteSize,g.SpriteSize)}}))},l.updateWrappedAppearance=function(){var e=this;h.load("images/atlas/candies",d,(function(t,n){if(t)console.error("Failed to load atlas: "+t);else{var i=n.getSpriteFrame(e.tileType.name);i&&(e.sprite.spriteFrame=i),e.sprite.color=new f(255,255,200,255),e.sprite.node.getComponent(m).setContentSize(g.SpriteSize,g.SpriteSize)}}))},l.updateRainbowAppearance=function(){var e=this;this.sprite.color=new f(255,255,255,255),h.load("images/atlas/candies",d,(function(t,n){if(t)console.error("Failed to load rainbow sprite: "+t);else{var i=n.getSpriteFrame("Rainbow Candy");i?e.sprite.spriteFrame=i:console.error("Sprite frame for Rainbow Candy not found in atlas"),console.log("updateRainbowAppearance",e.specialType),e.sprite.node.getComponent(m).setContentSize(g.SpriteSize,g.SpriteSize)}}))},l.changeState=function(e){var t;if(this.states){if(this.states.has(e)){var n=this.states.get(e);n?this.currentState!==n&&(null==(t=this.currentState)||t.onExit(),this.currentState=n,this.currentState.onEnter()):console.error("State "+e+" not found")}}else console.warn("Tile states not initialized or tile has been destroyed")},l.getCurrentStateName=function(){for(var e,t=a(this.states.entries());!(e=t()).done;){var n=e.value,i=n[0];if(n[1]===this.currentState)return i}return"unknown"},l.getSprite=function(){return this.sprite},l.setFrame=function(e){this.correspondingFrame=e},l.getFrame=function(){return this.correspondingFrame},l.onPlayerIdle=function(){var e;null==(e=this.currentState)||e.onPlayerIdle()},l.onMouseDown=function(e){this.isMouseDownOnThis=!0,this.mouseDownPos=new w(e.getLocationX(),e.getLocationY(),0),k.getInstance().setIsMouseDown(!0);for(var t,n=a(this.callbacks);!(t=n()).done;){(0,t.value)(this)}},l.onMouseEnter=function(e){if(this.correspondingFrame&&this.correspondingFrame.triggerMouseEnter(),k.getInstance().getIsMouseDown())for(var t,n=a(this.callbacks);!(t=n()).done;){(0,t.value)(this)}},l.onMouseLeave=function(e){this.correspondingFrame&&this.correspondingFrame.triggerMouseLeave()},l.onMouseUp=function(e){var t=this.isMouseDownOnThis;if(this.isMouseDownOnThis=!1,t&&this.mouseDownPos&&this.isRainbowTile()){var n=new w(e.getLocationX(),e.getLocationY(),0);if(w.distance(this.mouseDownPos,n)<=this.clickThreshold){for(var i,o=a(this.onRainbowClickCallbacks);!(i=o()).done;){(0,i.value)(this)}return this.mouseDownPos=null,void k.getInstance().setIsMouseDown(!1)}}this.mouseDownPos=null;for(var s,r=a(this.callbacks);!(s=r()).done;){(0,s.value)(this)}k.getInstance().setIsMouseDown(!1)},l.onDestroy=function(){var e;this.callbacks=[],this.onRainbowClickCallbacks=[],this.node&&this.node.isValid&&(this.node.off("mouse-down",this.onMouseDown,this),this.node.off("mouse-enter",this.onMouseEnter,this),this.node.off("mouse-leave",this.onMouseLeave,this),this.node.off("mouse-up",this.onMouseUp,this)),null==(e=this.currentState)||e.onExit()},l.playParticleEffect=function(){var e=s(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(!n.particleEffect||!n.node||!n.node.isValid)return console.warn("Particle effect prefab is not assigned or node is invalid"),null==t||t(),void e();var i=v(n.particleEffect);n.node.parent.addChild(i),i.setPosition(n.node.getPosition());var o=i.getComponent(S);o&&(o.startColor=n.tileType.color,o.startColorVar=new f(0,0,0,255),o.endColor=n.tileType.color,o.endColorVar=new f(0,0,0,255),o.playOnLoad=!0),null==t||t(),e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l.playDestroyAnimation=function(e){var t=this;return new Promise((function(n){if(!t.node||!t.node.isValid)return console.warn("Cannot play destroy animation: node is null or invalid"),null==e||e(),void n();var i=t.node.getComponent(M);i?i.animateDestroy(e,n):(console.warn("AnimationManager not found on tile node"),null==e||e(),n())}))},l.playCombineEffect=function(e,t){var n=this;return new Promise((function(i){if(!(n.node&&n.node.isValid&&e.node&&e.node.isValid))return console.warn("Cannot play combine effect: node is null or invalid"),null==t||t(),void i();var o=n.node.getComponent(M);o?o.animateCombine(n,e,t,i):(console.warn("AnimationManager not found on tile node"),null==t||t(),i())}))},t}(b)).prototype,"sprite",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(P.prototype,"particleEffect",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=P))||F));l._RF.pop()}}}));

System.register("chunks:///_virtual/TileState.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"ea6eexfy39MQLyAmofkj/wD","TileState",void 0);t("TileState",(function(t){this.tile=void 0,this.tile=t}));e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});