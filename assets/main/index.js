System.register("chunks:///_virtual/AnimationConfig.ts",["cc"],(function(i){var n;return{setters:[function(i){n=i.cclegacy}],execute:function(){n._RF.push({},"48ef7wzMFJKFrBHyPhWcPlB","AnimationConfig",void 0);i("CONFIG",{SELECTION_CONFIG:{duration:.3,glowDuration:.18,settleDuration:.12,easing:"sineOut"},DRAG_CONFIG:{duration:.2,easing:"backOut",scaleMultiplier:1.3},DESTRUCTION_CONFIG:{duration:.35,easing:"backIn",bounceMultiplier:1.4},SPAWN_CONFIG:{duration:.5,easing:"backOut",scaleMultiplier:1},BOUNCE_CONFIG:{duration:.08,easing:"quadOut",scaleMultiplier:1.25},MOVEMENT_CONFIG:{duration:.25,easing:"quadOut"},PULSE_CONFIG:{duration:.15,easing:"sineInOut",scaleMultiplier:1.08},DESELECTION_CONFIG:{duration:.2,easing:"sineIn"}}),i("COLOR_PRESETS",{SELECTION_GLOW:{r:255,g:255,b:150,a:255},SELECTION_ACTIVE:{r:255,g:255,b:200,a:255},DRAG_TINT:{r:180,g:180,b:255,a:160},ORIGINAL:{r:255,g:255,b:255,a:255},TRANSPARENT:{r:255,g:255,b:255,a:0}});n._RF.pop()}}}));

System.register("chunks:///_virtual/AnimationManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Tile.ts","./GameConfig.ts","./BoardManager.ts","./AnimationConfig.ts","./ParticleEffectManager.ts"],(function(n){var e,t,i,o,a,r,s,l,c,u,d,p,f,g,h,m,w,P,v,b,x;return{setters:[function(n){e=n.applyDecoratedDescriptor,t=n.inheritsLoose,i=n.initializerDefineProperty,o=n.assertThisInitialized,a=n.asyncToGenerator,r=n.regeneratorRuntime},function(n){s=n.cclegacy,l=n._decorator,c=n.Node,u=n.Vec3,d=n.Color,p=n.tween,f=n.Component,g=n.instantiate,h=n.Sprite,m=n.UITransform},function(n){w=n.Tile},function(n){P=n.GameConfig},function(n){v=n.BoardManager},function(n){b=n.CONFIG},function(n){x=n.ParticleEffectManager}],execute:function(){var C,y,S,I,O;s._RF.push({},"4f953lsZIFErKJ3FieNEEoj","AnimationManager",void 0);var M=l.ccclass,k=l.property;n("AnimationManager",(C=M("AnimationManager"),y=k(c),C((O=e((I=function(n){function e(){for(var e,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=n.call.apply(n,[this].concat(a))||this,i(e,"rotationContainer",O,o(e)),e.boardManager=null,e.tile=null,e.originalScale=new u(1,1,1),e.originalColor=d.WHITE.clone(),e.isAnimating=!1,e.selectionTween=null,e}t(e,n);var s=e.prototype;return s.onLoad=function(){this.boardManager=this.node.getComponent(v),this.tile=this.getComponent(w),this.tile?(this.originalScale.set(this.node.scale),this.tile.getSprite()&&this.originalColor.set(this.tile.getSprite().color)):console.error("AnimationManager requires a Tile component")},s.animateSwap=function(n,e,t){if(!(n.node&&e.node&&n.node.isValid&&e.node.isValid))throw new Error("Invalid tiles for swap animation");n.node.setSiblingIndex(e.node.parent.children.length),p(n.node).to(.15,{position:new u(e.node.x,e.node.y,n.node.position.z),scale:new u(1.85,1.85,1)},{easing:"linear"}).to(.15,{scale:new u(1,1,1)},{easing:"linear"}).start(),p(e.node).to(.3,{position:new u(n.node.x,n.node.y,e.node.position.z)},{easing:"linear"}).call((function(){t()})).start()},s.animateFall=function(){var n=a(r().mark((function n(e){var t,i=this;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.boardManager){n.next=2;break}throw new Error("BoardManager not set");case 2:return e.forEach((function(n){var e=n.tile,t=n.fromY,o=n.toY,a=n.x,r=n.isNewTile;i.boardManager.getWorldPosition({x:a,y:o});if(r)e.node.setScale(.8,.8,1);else{var s=i.boardManager.getWorldPosition({x:a,y:t});e.node.setPosition(s.x,s.y,0)}})),.3,t=[],e.forEach((function(n,e){var o=n.tile,a=n.toY,r=n.x,s=n.isNewTile,l=n.fromY,c=i.boardManager.getWorldPosition({x:r,y:a}),d=new Promise((function(n){var e=s?.05*Math.abs(l):0,t=.3+.02*Math.abs(l-a),i=p(o.node);e>0&&(i=i.delay(e)),s&&(i=i.to(.1,{scale:new u(1,1,1)},{easing:"backOut"})),i.to(t,{position:new u(c.x,c.y,0)},{easing:"quartIn"}).to(.1,{scale:new u(1.05,.95,1)},{easing:"quadOut"}).to(.1,{scale:new u(1,1,1)},{easing:"backOut"}).call((function(){return n()})).start()}));t.push(d)})),n.next=8,Promise.all(t);case 8:case"end":return n.stop()}}),n,this)})));return function(e){return n.apply(this,arguments)}}(),s.animateIdleTiles=function(){var n=a(r().mark((function n(e){var t,i,o,a,s,l,c,u;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=0;case 1:if(!(t<P.GridHeight)){n.next=8;break}for(i=0,o=t;i<=t&&o>=0;i++,o--)(a=e[o][i])&&a.onPlayerIdle();return n.next=5,new Promise((function(n){return setTimeout(n,50)}));case 5:t++,n.next=1;break;case 8:s=1;case 9:if(!(s<P.GridWidth)){n.next=16;break}for(l=s,c=P.GridHeight-1;l<P.GridWidth&&c>=0;l++,c--)(u=e[c][l])&&u.onPlayerIdle();return n.next=13,new Promise((function(n){return setTimeout(n,50)}));case 13:s++,n.next=9;break;case 16:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),s.animateMatchedTiles=function(n){},s.animateSelection=function(){if(!this.isAnimating){this.stopAllAnimations(),this.isAnimating=!0;var n=this.originalScale.clone().multiplyScalar(1.2);this.selectionTween=p(this.node).to(b.SELECTION_CONFIG.duration,{scale:n},{easing:"sineOut"}).to(b.SELECTION_CONFIG.duration,{scale:this.originalScale},{easing:"sineIn"}).union().repeatForever().start()}},s.animateDeselection=function(){this.isAnimating=!1,this.selectionTween&&(this.selectionTween.stop(),this.selectionTween=null),this.node.scale=this.originalScale},s.animateBounce=function(){var n=this;return new Promise((function(e){if(n.isAnimating)e();else{n.isAnimating=!0;var t=n.originalScale.clone().multiplyScalar(b.BOUNCE_CONFIG.scaleMultiplier);p(n.node).to(b.BOUNCE_CONFIG.duration,{scale:t},{easing:b.BOUNCE_CONFIG.easing}).to(b.BOUNCE_CONFIG.duration,{scale:n.originalScale},{easing:b.BOUNCE_CONFIG.easing}).call((function(){n.isAnimating=!1,e()})).start()}}))},s.animateMoveTo=function(n,e){var t=this,i=e||b.MOVEMENT_CONFIG.duration;return new Promise((function(e){p(t.node).to(i,{position:n},{easing:b.MOVEMENT_CONFIG.easing}).call((function(){e()})).start()}))},s.animatePulse=function(n){var e=this;return void 0===n&&(n=2),new Promise((function(t){if(e.isAnimating)t();else{e.isAnimating=!0;var i=e.originalScale.clone().multiplyScalar(b.PULSE_CONFIG.scaleMultiplier),o=0;!function a(){if(o>=n)return e.isAnimating=!1,void t();o++,p(e.node).to(b.PULSE_CONFIG.duration,{scale:i},{easing:b.PULSE_CONFIG.easing}).to(b.PULSE_CONFIG.duration,{scale:e.originalScale},{easing:b.PULSE_CONFIG.easing}).call((function(){a()})).start()}()}}))},s.stopAllAnimations=function(){var n,e;this.isAnimating&&(p(this.node).stop(),null!=(n=this.tile)&&n.getSprite()&&p(this.tile.getSprite()).stop(),this.selectionTween&&(this.selectionTween.stop(),this.selectionTween=null),this.node.scale=this.originalScale,null!=(e=this.tile)&&e.getSprite()&&(this.tile.getSprite().color=this.originalColor),this.isAnimating=!1)},s.getIsAnimating=function(){return this.isAnimating},s.updateOriginalValues=function(){var n;this.originalScale.set(this.node.scale),null!=(n=this.tile)&&n.getSprite()&&this.originalColor.set(this.tile.getSprite().color)},s.animatePlayerIdle=function(){var n=this;this.isAnimating||(this.isAnimating=!0,p(this.node).to(.4,{scale:new u(1.15,1.15,1.15)},{easing:"sineOut"}).to(.4,{scale:new u(1,1,1)},{easing:"sineIn"}).union().call((function(){n.isAnimating=!1})).start())},s.animateDestroy=function(n,e){p(this.node).to(.1,{scale:new u(1.1,1.1,1.1)},{easing:"quadOut"}).to(.15,{scale:new u(0,0,0)},{easing:"quadIn"}).call((function(){null==n||n(),null==e||e()})).start()},s.animateMilestoneCelebration=function(){var n=a(r().mark((function n(e,t){var i,o,a,s,l,c,d,f,h,m,w,v,b,x,C,y,S;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.boardManager){n.next=2;break}throw new Error("BoardManager not set");case 2:for(o=[],a=0;a<P.GridHeight;a++)for(s=0;s<P.GridWidth;s++)(l=e[a][s])&&l.node&&l.node.isValid&&o.push({tile:l,originalPos:l.node.position.clone(),originalParent:l.node.parent});if(0!==o.length){n.next=6;break}return n.abrupt("return");case 6:return c=o.length,d=P.MilestoneSystem.celebrationAnimationDuration,f=.1*d,h=.7*d,m=.2*d,w=t.position.clone(),v=P.GridWidth*P.TileWidth/2-P.TileWidth,b=P.GridHeight*P.TileHeight/2-P.TileHeight,x=1.1*Math.min(v,b),C=o.map((function(n,e){return new Promise((function(t){var i=e/c*Math.PI*2,o=w.x+Math.cos(i)*x,a=w.y+Math.sin(i)*x,r=e/c*.05;p(n.tile.node).delay(r).parallel(p().to(f,{position:new u(o,a,0)},{easing:"quadOut"}),p().to(.5*f,{scale:new u(.85,.85,1)},{easing:"quadOut"}).to(.5*f,{scale:new u(1,1,1)},{easing:"quadOut"})).call((function(){return t()})).start()}))})),n.next=18,Promise.all(C);case 18:return y=g(this.rotationContainer),null==(i=t.parent)||i.addChild(y),y.setPosition(w),y.setSiblingIndex(this.rotationContainer.getSiblingIndex()),o.forEach((function(n){var e=n.tile.node.getWorldPosition();n.tile.node.setParent(y),n.tile.node.setWorldPosition(e)})),n.next=25,new Promise((function(n){p(y).to(h,{angle:-720},{easing:"sineInOut"}).call((function(){return n()})).start()}));case 25:return o.forEach((function(n){var e=n.tile.node.getWorldPosition();n.tile.node.setParent(n.originalParent),n.tile.node.setWorldPosition(e)})),y.destroy(),S=o.map((function(n,e){return new Promise((function(t){var i=e/c*.1;p(n.tile.node).delay(i).parallel(p().to(m,{position:n.originalPos},{easing:"backOut"}),p().to(.2*m,{scale:new u(1.1,1.1,1)},{easing:"quadOut"}).to(.8*m,{scale:new u(1,1,1)},{easing:"bounceOut"})).call((function(){return t()})).start()}))})),n.next=30,Promise.all(S);case 30:case"end":return n.stop()}}),n,this)})));return function(e,t){return n.apply(this,arguments)}}(),s.animateDoubleRainbow=function(){var n=a(r().mark((function n(e,t,i){var o,a,s,l,c,d,f,g;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=e.node)&&o.isValid&&null!=(a=t.node)&&a.isValid){n.next=2;break}return n.abrupt("return");case 2:if(this.node.getComponent(x),e.node.parent){n.next=6;break}return n.abrupt("return");case 6:return e.node.setSiblingIndex(t.node.parent.children.length),t.node.setSiblingIndex(e.node.parent.children.length),s=e.node.position.clone(),l=t.node.position.clone(),(c=s.clone().add(l).multiplyScalar(.5)).y+=120,d=function(n){return new Promise((function(e){p(n.node).to(.25,{position:new u(n.node.position.x,n.node.position.y+120,0),scale:new u(1.2,1.2,1)},{easing:"quadOut"}).to(.25,{position:c},{easing:"quadIn"}).call((function(){return e()})).start()}))},n.next=15,Promise.all([d(e),d(t)]);case 15:return n.next=17,new Promise((function(n){p(t.node).to(.2,{scale:new u(0,0,0)}).call((function(){return n()})).start()}));case 17:return n.next=19,new Promise((function(n){p(e.node).to(.2,{scale:new u(2.5,2.5,1)},{easing:"sineOut"}).call((function(){n()})).start()}));case 19:return f=function(n){return new Promise((function(e){p(n.node).to(.25,{position:new u(n.node.position.x,n.node.position.y+120,0)},{easing:"quadOut"}).call((function(){return e()})).start()}))},n.next=22,Promise.all([f(e),f(t)]);case 22:return g=function(n){return new Promise((function(e){p(n.node).to(.25,{position:new u(l.x,l.y,0)},{easing:"quadOut"}).call((function(){return e()})).start()}))},n.next=25,Promise.all([g(e),g(t)]);case 25:case"end":return n.stop()}}),n,this)})));return function(e,t,i){return n.apply(this,arguments)}}(),s.animateRainbowClickEffect=function(){var n=a(r().mark((function n(e,t){var i,o,a,s,l,d,f,g,w,P,v,b;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(i=e.node)&&i.isValid&&e.node.parent){n.next=2;break}return n.abrupt("return");case 2:for(o=t.length,a=[],s=e.node.position.clone(),l=0;l<o;l++)(d=new c("RainbowPiece_"+l)).addComponent(h),f=d.getComponent(h),(g=d.addComponent(m))&&g.setContentSize(55,55),(w=e.getSprite())&&w.spriteFrame&&(f.spriteFrame=w.spriteFrame),d.setParent(e.node.parent),d.setPosition(s),d.setScale(.5,.5,1),a.push(d);return P=a.map((function(n,e){var t=e/o*360+60*Math.random()-30,i=80+40*Math.random(),a=Math.cos(t*Math.PI/180)*i,r=Math.sin(t*Math.PI/180)*i;return new Promise((function(e){p(n).to(.3,{position:new u(s.x+a,s.y+r,0),scale:new u(.6,.6,1)},{easing:"backOut"}).call((function(){return e()})).start()}))})),p(e.node).to(.2,{scale:new u(0,0,1)},{easing:"backIn"}).start(),n.next=10,Promise.all(P);case 10:return n.next=12,new Promise((function(n){return setTimeout(n,200)}));case 12:return v=a.map((function(n,e){var i;if(e>=t.length)return Promise.resolve();var o=t[e];if(null==(i=o.node)||!i.isValid)return Promise.resolve();var a=o.node.position.clone(),r=.1*e;return new Promise((function(e){p(n).delay(r).to(.6,{position:a,scale:new u(.2,.2,1)},{easing:"quadInOut"}).call((function(){var t;null!=(t=o.node)&&t.isValid&&p(o.node).to(.1,{scale:new u(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new u(0,0,1)},{easing:"backIn"}).start(),n.destroy(),e()})).start()}))})),n.next=15,Promise.all(v);case 15:(b=this.node.getComponent(x))&&e.node.parent&&b.playSparkleEffect(s,e.node.parent);case 17:case"end":return n.stop()}}),n,this)})));return function(e,t){return n.apply(this,arguments)}}(),s.animateRainbowSwapToType=function(){var n=a(r().mark((function n(e,t,i){var o,a,s,l,d,f,g,w,P,v,b,C;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=e.node)&&o.isValid&&e.node.parent){n.next=2;break}return n.abrupt("return");case 2:if(i.length){n.next=4;break}return n.abrupt("return");case 4:for(a=i.length,s=[],l=e.node.position.clone(),d=0;d<a;d++)(f=new c("RainbowPiece_"+d)).addComponent(h),g=f.getComponent(h),(w=f.addComponent(m))&&w.setContentSize(55,55),(P=e.getSprite())&&P.spriteFrame&&(g.spriteFrame=P.spriteFrame),f.setParent(e.node.parent),f.setPosition(l),f.setScale(.5,.5,1),s.push(f);return p(e.node).to(.2,{scale:new u(0,0,1)},{easing:"backIn"}).start(),v=s.map((function(n,e){var t=e/a*360+60*Math.random()-30,i=80+40*Math.random(),o=Math.cos(t*Math.PI/180)*i,r=Math.sin(t*Math.PI/180)*i;return new Promise((function(e){p(n).to(.3,{position:new u(l.x+o,l.y+r,0),scale:new u(.6,.6,1)},{easing:"backOut"}).call((function(){return e()})).start()}))})),n.next=12,Promise.all(v);case 12:return n.next=14,new Promise((function(n){return setTimeout(n,200)}));case 14:return b=s.map((function(n,e){var t,o=i[e];if(null==(t=o.node)||!t.isValid)return Promise.resolve();var a=o.node.position.clone(),r=.07*e;return new Promise((function(e){p(n).delay(r).to(.5,{position:a,scale:new u(.2,.2,1)},{easing:"quadInOut"}).call((function(){var t;null!=(t=o.node)&&t.isValid&&p(o.node).to(.1,{scale:new u(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new u(0,0,1)},{easing:"backIn"}).start(),n.destroy(),e()})).start()}))})),n.next=17,Promise.all(b);case 17:(C=this.node.getComponent(x))&&e.node.parent&&C.playSparkleEffect(l,e.node.parent);case 19:case"end":return n.stop()}}),n,this)})));return function(e,t,i){return n.apply(this,arguments)}}(),s.animateCombine=function(){var n=a(r().mark((function n(e,t,i,o){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:p(e.node).to(.15,{position:t.node.getPosition()},{easing:"quadOut"}).call((function(){null==i||i(),null==o||o()})).start();case 1:case"end":return n.stop()}}),n)})));return function(e,t,i,o){return n.apply(this,arguments)}}(),e}(f)).prototype,"rotationContainer",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=I))||S));s._RF.pop()}}}));

System.register("chunks:///_virtual/AssetLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,o,t,s,a,i,n,c,p,u,l;return{setters:[function(r){e=r.applyDecoratedDescriptor,o=r.inheritsLoose,t=r.initializerDefineProperty,s=r.assertThisInitialized},function(r){a=r.cclegacy,i=r._decorator,n=r.ProgressBar,c=r.director,p=r.resources,u=r.SpriteFrame,l=r.Component}],execute:function(){var d,f,g,h,B;a._RF.push({},"ff792SUt8BAQoHTgLc+DQEW","AssetLoader",void 0);var m=i.ccclass,y=i.property;r("AssetLoader",(d=m("AssetLoader"),f=y(n),d((B=e((h=function(r){function e(){for(var e,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=r.call.apply(r,[this].concat(a))||this,t(e,"progressBar",B,s(e)),e}o(e,r);var a=e.prototype;return a.__preload=function(){if(!this.progressBar)throw new Error("ProgressBar is required");c.preloadScene("GameScene"),p.preloadDir("images")},a.start=function(){var r=this;p.loadDir("images",u,(function(e,o){r.updateProgressBar(e/o)}),(function(e){e?console.error(e):(r.updateProgressBar(1),r.switchToGameScene())}))},a.updateProgressBar=function(r){this.progressBar.progress=r},a.switchToGameScene=function(){c.loadScene("GameScene")},e}(l)).prototype,"progressBar",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=h))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/BoardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Tile.ts","./Frame.ts"],(function(i){var t,e,r,n,l,a,o,s,h,d,u,f;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,r=i.initializerDefineProperty,n=i.assertThisInitialized},function(i){l=i.cclegacy,a=i._decorator,o=i.Prefab,s=i.instantiate,h=i.Component},function(i){d=i.GameConfig},function(i){u=i.Tile},function(i){f=i.Frame}],execute:function(){var c,T,g,G,v,m,p;l._RF.push({},"76c733eZfpJ+bMWRYNX9PiB","BoardManager",void 0);var y=a.ccclass,A=a.property;i("BoardManager",(c=y("BoardManager"),T=A(o),g=A(o),c((m=t((v=function(i){function t(){for(var t,e=arguments.length,l=new Array(e),a=0;a<e;a++)l[a]=arguments[a];return t=i.call.apply(i,[this].concat(l))||this,r(t,"tilePrefab",m,n(t)),r(t,"framePrefab",p,n(t)),t.tileGrid=[],t.frameGrid=[],t.virtualGrid=[],t.tileCoords=new Map,t.maxDifference=2,t.VIRTUAL_GRID_HEIGHT=d.GridHeight,t}e(t,i);var l=t.prototype;return l.__preload=function(){if(null===this.tilePrefab)throw new Error("Tile prefab is not set");if(null===this.framePrefab)throw new Error("Frame prefab is not set")},l.setTilePrefab=function(i){this.tilePrefab=i},l.setFramePrefab=function(i){this.framePrefab=i},l.createFrames=function(){this.frameGrid=[];for(var i=0;i<d.GridHeight;i++){this.frameGrid[i]=[];for(var t=0;t<d.GridWidth;t++)this.frameGrid[i][t]=this.createFrame(t,i)}},l.initializeBoard=function(){this.createTiles(),this.initializeVirtualGrid()},l.getTileGrid=function(){return this.tileGrid},l.getFrameGrid=function(){return this.frameGrid},l.getVirtualGrid=function(){return this.virtualGrid},l.getVirtualGridHeight=function(){return this.VIRTUAL_GRID_HEIGHT},l.getTileCoords=function(){return this.tileCoords},l.getTileAt=function(i,t){if(t>=0&&t<this.tileGrid.length&&i>=0&&i<this.tileGrid[t].length)return this.tileGrid[t][i]},l.getVirtualTileAt=function(i,t){if(t>=0&&t<this.virtualGrid.length&&i>=0&&i<this.virtualGrid[t].length)return this.virtualGrid[t][i]},l.setTileAt=function(i,t,e){t>=0&&t<this.tileGrid.length&&i>=0&&i<this.tileGrid[t].length&&(this.tileGrid[t][i]=e,e&&this.tileCoords.set(e,{x:i,y:t}))},l.setVirtualTileAt=function(i,t,e){t>=0&&t<this.virtualGrid.length&&i>=0&&i<this.virtualGrid[t].length&&(this.virtualGrid[t][i]=e,e&&this.tileCoords.set(e,{x:i,y:-(t+1)}))},l.getWorldPosition=function(i){return{x:-d.GridWidth*d.TileWidth/2+d.TileWidth/2+i.x*d.TileWidth+d.OffsetX,y:-(-d.GridHeight*d.TileHeight/2+d.TileHeight/2+i.y*d.TileHeight+d.OffsetY)}},l.getVirtualWorldPosition=function(i){return{x:-d.GridWidth*d.TileWidth/2+d.TileWidth/2+i.x*d.TileWidth,y:-(-d.GridHeight*d.TileHeight/2+d.TileHeight/2+(-i.y-this.VIRTUAL_GRID_HEIGHT)*d.TileHeight)}},l.getNeighbors=function(i){var t=[],e=i.x,r=i.y;return e>0&&this.getTileAt(e-1,r)&&t.push(this.getTileAt(e-1,r)),e<d.GridWidth-1&&this.getTileAt(e+1,r)&&t.push(this.getTileAt(e+1,r)),r>0&&this.getTileAt(e,r-1)&&t.push(this.getTileAt(e,r-1)),r<d.GridHeight-1&&this.getTileAt(e,r+1)&&t.push(this.getTileAt(e,r+1)),t},l.createTileAt=function(i,t){var e,r=d.CandyTypes[Math.floor(Math.random()*Math.min(this.maxDifference,d.CandyTypes.length))],n=s(this.tilePrefab);if(null===n)throw new Error("Failed to instantiate tile prefab");var l=n.getComponent(u);if(null===l)throw new Error("Failed to get tile component");null==(e=this.node)||e.addChild(n),l.setTileType(r);var a=this.getWorldPosition({x:i,y:t}),o=a.x,h=a.y;n.setPosition(o,h);var f=this.frameGrid[t][i];return f&&l.setFrame(f),this.tileCoords.set(l,{x:i,y:t}),this.tileGrid[t][i]=l,l},l.createVirtualTileAt=function(i,t){var e,r=d.CandyTypes[Math.floor(Math.random()*Math.min(this.maxDifference,d.CandyTypes.length))],n=s(this.tilePrefab);if(null===n)throw new Error("Failed to instantiate tile prefab");var l=n.getComponent(u);if(null===l)throw new Error("Failed to get tile component");null==(e=this.node)||e.addChild(n),l.setTileType(r);var a=this.getVirtualWorldPosition({x:i,y:t}),o=a.x,h=a.y;return n.setPosition(o,h),n.active=!1,this.tileCoords.set(l,{x:i,y:-(t+1)}),this.virtualGrid[t][i]=l,l},l.moveVirtualTileToMainGrid=function(i,t,e,r){var n=this.getVirtualTileAt(i,t);if(!n)return null;this.setVirtualTileAt(i,t,void 0),this.setTileAt(e,r,n);var l=this.frameGrid[r][e];return l&&n.setFrame(l),n},l.getVirtualTilesForColumn=function(i,t){for(var e=[],r=0,n=this.VIRTUAL_GRID_HEIGHT-1;n>=0&&r<t;n--){var l=this.getVirtualTileAt(i,n);if(l){l.node.active=!0;var a=-(r+1),o=this.getWorldPosition({x:i,y:a});l.node.setPosition(o.x,o.y,0),e.push(l),this.setVirtualTileAt(i,n,void 0),r++}}return e},l.refillVirtualGrid=function(){for(var i=0;i<d.GridWidth;i++)for(var t=0;t<this.VIRTUAL_GRID_HEIGHT;t++){if(!this.getVirtualTileAt(i,t))this.createVirtualTileAt(i,t).node.active=!1}},l.clearTileAt=function(i,t){var e=this.tileGrid[t][i];e&&(this.tileCoords.delete(e),this.tileGrid[t][i]=void 0)},l.initializeVirtualGrid=function(){this.virtualGrid=[];for(var i=0;i<this.VIRTUAL_GRID_HEIGHT;i++){this.virtualGrid[i]=[];for(var t=0;t<d.GridWidth;t++)this.virtualGrid[i][t]=this.createVirtualTileAt(t,i)}},l.createTiles=function(){this.tileGrid=[];for(var i=0;i<d.GridHeight;i++){this.tileGrid[i]=[];for(var t=0;t<d.GridWidth;t++)this.tileGrid[i][t]=this.createTileAt(t,i)}},l.createFrame=function(i,t){var e,r=s(this.framePrefab);if(null===r)throw new Error("Failed to instantiate frame prefab");var n=r.getComponent(f);if(null===n)throw new Error("Failed to get Frame component");var l=this.getWorldPosition({x:i,y:t}),a=l.x,o=l.y;return r.setPosition(a,o),n.setSpriteFrame((i+t)%2),null==(e=this.node)||e.addChild(r),n.setTweenDuration(.15),n},t}(h)).prototype,"tilePrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=t(v.prototype,"framePrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=v))||G));l._RF.pop()}}}));

System.register("chunks:///_virtual/Frame.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,r,e,s,o,n,a,p,h,l;return{setters:[function(i){t=i.applyDecoratedDescriptor,r=i.inheritsLoose,e=i.initializerDefineProperty,s=i.assertThisInitialized},function(i){o=i.cclegacy,n=i._decorator,a=i.Sprite,p=i.SpriteFrame,h=i.tween,l=i.Component}],execute:function(){var c,u,g,f,m,v,F;o._RF.push({},"6a8c2mjIgVAtJADtmbpcPpA","Frame",void 0);var A=n.ccclass,b=n.property;i("Frame",(c=A("Frame"),u=b(a),g=b([p]),c((v=t((m=function(i){function t(){for(var t,r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return t=i.call.apply(i,[this].concat(o))||this,e(t,"sprite",v,s(t)),e(t,"spriteFrames",F,s(t)),t.originalAlpha=.6,t.hoverAlpha=.7,t.isHovering=!1,t.tweenDuration=.15,t}r(t,i);var o=t.prototype;return o.__preload=function(){if(!this.sprite)throw new Error("Sprite is required for Frame")},o.onLoad=function(){if(!this.sprite)throw new Error("Sprite is required for Frame");var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.originalAlpha)},o.setSpriteFrame=function(i){!this.sprite||!this.spriteFrames||i<0||i>=this.spriteFrames.length||(this.sprite.spriteFrame=this.spriteFrames[i])},o.triggerMouseEnter=function(){if(!this.isHovering&&this.sprite){this.isHovering=!0;var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.hoverAlpha)}},o.triggerMouseLeave=function(){if(this.isHovering&&this.sprite){this.isHovering=!1;var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.originalAlpha)}},o.setHoverState=function(i){i?this.triggerMouseEnter():this.triggerMouseLeave()},o.setHoverAlpha=function(i){this.hoverAlpha=Math.max(0,Math.min(1,i))},o.setOriginalAlpha=function(i){this.originalAlpha=Math.max(0,Math.min(1,i))},o.setTweenDuration=function(i){this.tweenDuration=Math.max(.05,i)},o.getIsHovering=function(){return this.isHovering},o.resetFrame=function(){if(this.sprite){h(this.sprite).stop();var i=this.sprite.color.clone();this.sprite.color=i.set(i.r,i.g,i.b,255*this.originalAlpha),this.isHovering=!1}},o.onDestroy=function(){this.sprite&&h(this.sprite).stop()},t}(l)).prototype,"sprite",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(m.prototype,"spriteFrames",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f=m))||f));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameConfig.ts",["cc"],(function(e){var n,w,a;return{setters:[function(e){n=e.cclegacy,w=e.Vec3,a=e.Color}],execute:function(){n._RF.push({},"066a2a7XoVHzJHXDKi1vGjH","GameConfig",void 0);e("PatternShape",[{name:"HorizontalLine5",shape:[new w(0,0),new w(1,0),new w(2,0),new w(3,0),new w(4,0)]},{name:"VerticalLine5",shape:[new w(0,0),new w(0,1),new w(0,2),new w(0,3),new w(0,4)]},{name:"PlusShape",shape:[new w(0,0),new w(1,0),new w(0,1),new w(0,-1),new w(-1,0)]},{name:"LShapeLeft",shape:[new w(0,0),new w(0,1),new w(0,2),new w(-1,0),new w(-2,0)]},{name:"LShapeRight",shape:[new w(0,0),new w(0,1),new w(0,2),new w(1,0),new w(2,0)]},{name:"LShapeUp",shape:[new w(0,0),new w(0,-1),new w(0,-2),new w(1,0),new w(2,0)]},{name:"LShapeDown",shape:[new w(0,0),new w(0,-1),new w(0,-2),new w(-1,0),new w(-2,0)]},{name:"TShapeUp",shape:[new w(0,0),new w(-1,0),new w(1,0),new w(0,1),new w(0,2)]},{name:"TShapeDown",shape:[new w(0,0),new w(-1,0),new w(1,0),new w(0,-1),new w(0,-2)]},{name:"TShapeLeft",shape:[new w(0,0),new w(0,1),new w(0,-1),new w(-1,0),new w(-2,0)]},{name:"TShapeRight",shape:[new w(0,0),new w(0,1),new w(0,-1),new w(1,0),new w(2,0)]},{name:"HorizontalLine4",shape:[new w(0,0),new w(1,0),new w(2,0),new w(3,0)]},{name:"VerticalLine4",shape:[new w(0,0),new w(0,1),new w(0,2),new w(0,3)]},{name:"HorizontalLine3",shape:[new w(0,0),new w(1,0),new w(2,0)]},{name:"VerticalLine3",shape:[new w(0,0),new w(0,1),new w(0,2)]}]),e("GameConfig",{GridWidth:8,GridHeight:8,TileWidth:64,TileHeight:64,OffsetX:0,OffsetY:0,MaxIdleTime:10,HintTime:5,MilestoneSystem:{milestoneThresholds:[1e4,2500,5e3,1e4,2e4,4e4,8e4,16e4,32e4,64e4,128e4,256e4],movePerMilestone:[10,20,30,40,50,60,70,80,90,100,110,120],pointsPerTile:10,bonusPoints:{match4:50,match5Plus:100},celebrationAnimationDuration:6},RainbowClick:{minDestroyCount:6,maxDestroyCount:20},CandyTypes:[{name:"Blue Candy",color:new a(55,78,252,255)},{name:"Green Candy",color:new a(0,128,0,255)},{name:"Orange Candy",color:new a(255,126,25,255)},{name:"Red Candy",color:new a(255,0,0,255)},{name:"Yellow Candy",color:new a(255,255,0,255)},{name:"Purple Candy",color:new a(128,0,128,255)}]});n._RF.pop()}}}));

System.register("chunks:///_virtual/GameGlobalData.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton2.ts"],(function(t){var n,o,e;return{setters:[function(t){n=t.inheritsLoose},function(t){o=t.cclegacy},function(t){e=t.Singleton}],execute:function(){o._RF.push({},"65b77HWEHtHDpqHoObcPmcf","GameGlobalData",void 0);t("GameGlobalData",function(t){function o(){for(var n,o=arguments.length,e=new Array(o),s=0;s<o;s++)e[s]=arguments[s];return(n=t.call.apply(t,[this].concat(e))||this).isMouseDown=!1,n}n(o,t);var e=o.prototype;return e.getIsMouseDown=function(){return this.isMouseDown},e.setIsMouseDown=function(t){this.isMouseDown=t},o}(e));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./GameGlobalData.ts","./BoardManager.ts","./MatchManager.ts","./AnimationManager.ts","./InputManager.ts","./ProgressManager.ts","./SpecialTileManager.ts","./ParticleEffectManager.ts","./Singleton2.ts","./SpecialTileConfig.ts","./MilestoneAchievementUI.ts","./PausePopup.ts","./GameOverPopup.ts"],(function(e){var t,n,i,a,r,s,o,c,l,u,d,h,p,f,g,m,b,v,M,T,w,x,G,y,k,S,P,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized,r=e.asyncToGenerator,s=e.regeneratorRuntime,o=e.createForOfIteratorHelperLoose},function(e){c=e.cclegacy,l=e._decorator,u=e.Camera,d=e.Node,h=e.Button,p=e.tween,f=e.Vec3},function(e){g=e.GameConfig},function(e){m=e.GameGlobalData},function(e){b=e.BoardManager},function(e){v=e.MatchManager},function(e){M=e.AnimationManager},function(e){T=e.InputManager},function(e){w=e.ProgressManager},function(e){x=e.SpecialTileManager},function(e){G=e.ParticleEffectManager},function(e){y=e.Singleton},function(e){k=e.SpecialTileType},function(e){S=e.MilestoneAchievementUI},function(e){P=e.PausePopup},function(e){C=e.GameOverPopup}],execute:function(){var I,E,O,A,B,D,R,H,U,N,W,V,F,_,z;c._RF.push({},"cb6b24lA09FMol6Lsdq977r","GameManager",void 0);var q=l.ccclass,Y=l.property;e("default",(I=q("GameManager"),E=Y(u),O=Y(d),A=Y(d),B=Y(P),D=Y(C),R=Y(h),I((N=t((U=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t=e.call.apply(e,[this].concat(r))||this,i(t,"camera",N,a(t)),i(t,"celebrationNode",W,a(t)),i(t,"milestoneUINode",V,a(t)),i(t,"pausePopup",F,a(t)),i(t,"gameOverPopup",_,a(t)),i(t,"pauseButton",z,a(t)),t.boardManager=null,t.matchManager=null,t.animationManager=null,t.inputManager=null,t.specialTileManager=null,t.particleEffectManager=null,t.milestoneAchievementUI=null,t.playerIdleTime=0,t.canMove=!1,t.firstSelectedTile=void 0,t.secondSelectedTile=void 0,t.swappedTiles=[],t.isGamePaused=!1,t.isGameOver=!1,t.movesRemaining=30,t.hintActive=!1,t}n(t,e);var c=t.prototype;return c.__preload=function(){var e;if(this.assignManagers(),!this.boardManager)throw new Error("BoardManager is required");if(!this.matchManager)throw new Error("MatchManager is required");if(!this.animationManager)throw new Error("AnimationManager is required");if(!this.inputManager)throw new Error("InputManager is required");if(!this.specialTileManager)throw new Error("SpecialTileManager is required");if(!this.particleEffectManager)throw new Error("ParticleEffectManager is required");this.milestoneAchievementUI=null==(e=this.milestoneUINode)?void 0:e.getComponent(S)},c.start=function(){this.setupProgressManager(),this.createBoard(),this.setupPopups()},c.update=function(e){this.checkIdleTime(e)},c.assignManagers=function(){this.boardManager=this.node.getComponent(b),this.matchManager=this.node.getComponent(v),this.animationManager=this.node.getComponent(M),this.inputManager=this.node.getComponent(T),this.specialTileManager=this.node.getComponent(x),this.particleEffectManager=this.node.getComponent(G)},c.setupProgressManager=function(){w.getInstance().onMilestoneCompleted(this.handleMilestoneCompleted.bind(this))},c.handleMilestoneCompleted=function(){var e=r(s().mark((function e(){var t,n,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Milestone completed! Starting celebration sequence..."),this.canMove=!1,m.getInstance().setIsMouseDown(!0),t=w.getInstance().getMilestoneData(),this.milestoneAchievementUI&&this.milestoneAchievementUI.showMilestoneAchievement(t),this.clearBoard(),this.boardManager.initializeBoard(),this.resetFrames(),n=this.boardManager.getTileGrid(),i=this.animationManager.animateMilestoneCelebration(n,this.celebrationNode),e.next=12,Promise.all([i]);case 12:this.setupTileCallbacks(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.checkMatches().then((function(){a.resetTile()}));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.clearBoard=function(){for(var e=this.boardManager.getTileGrid(),t=0;t<g.GridHeight;t++)for(var n=0;n<g.GridWidth;n++){var i=e[t][n];i&&i.node&&i.node.isValid&&i.node.destroy(),this.boardManager.setTileAt(n,t,void 0)}},c.createBoard=function(e){var t=this;void 0===e&&(e=!1),this.canMove=!1,e||this.boardManager.createFrames(),m.getInstance().setIsMouseDown(!0),this.boardManager.initializeBoard(),this.setupTileCallbacks(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.checkMatches().then((function(){t.resetTile()}))},c.setupTileCallbacks=function(){for(var e=this.boardManager.getTileGrid(),t=0;t<g.GridHeight;t++)for(var n=0;n<g.GridWidth;n++){var i=e[t][n];i&&(i.addOnMouseDownCallback(this.tileDown.bind(this)),i.addOnMouseUpCallback(this.tileDown.bind(this)),i.addOnRainbowClickCallback(this.handleRainbowClick.bind(this)))}},c.checkIdleTime=function(e){this.playerIdleTime+=e,this.playerIdleTime>g.HintTime&&(this.showHint(),this.playerIdleTime=0)},c.tileDown=function(e){if(!this.isGamePaused&&!this.isGameOver&&this.canMove)if(this.playerIdleTime=0,this.firstSelectedTile&&this.firstSelectedTile!==e){this.secondSelectedTile=e;var t=this.boardManager.getTileCoords(),n=t.get(this.firstSelectedTile),i=t.get(this.secondSelectedTile),a=Math.abs(n.x-i.x),r=Math.abs(n.y-i.y);1===a&&0===r||0===a&&1===r?(this.canMove=!1,this.swapTiles(),this.processMoveAndCheckGameState()):(this.firstSelectedTile.changeState("idle"),this.firstSelectedTile=e,e.changeState("select"),this.secondSelectedTile=void 0)}else this.firstSelectedTile=e,e.changeState("select")},c.swapTiles=function(){var e=this;if(!this.firstSelectedTile||!this.secondSelectedTile)return this.canMove=!0,void m.getInstance().setIsMouseDown(!1);var t=this.boardManager.getTileCoords(),n=this.boardManager.getTileGrid(),i=t.get(this.firstSelectedTile),a=t.get(this.secondSelectedTile);return i&&a?i.y<0||i.y>=g.GridHeight||i.x<0||i.x>=g.GridWidth||a.y<0||a.y>=g.GridHeight||a.x<0||a.x>=g.GridWidth?(console.error("Selected tile coordinates are out of bounds"),this.tileUp(),this.canMove=!0,void m.getInstance().setIsMouseDown(!1)):(this.swappedTiles=[this.firstSelectedTile,this.secondSelectedTile],n[i.y][i.x]=this.secondSelectedTile,n[a.y][a.x]=this.firstSelectedTile,t.set(this.secondSelectedTile,{x:i.x,y:i.y}),t.set(this.firstSelectedTile,{x:a.x,y:a.y}),this.animationManager.animateSwap(this.firstSelectedTile,this.secondSelectedTile,(function(){return e.checkMatches(!0)})),this.firstSelectedTile=n[i.y][i.x],this.secondSelectedTile=n[a.y][a.x],void(this.firstSelectedTile&&this.secondSelectedTile&&(t.set(this.firstSelectedTile,{x:i.x,y:i.y}),t.set(this.secondSelectedTile,{x:a.x,y:a.y})))):(console.error("Selected tile coordinates not found - tiles may have been destroyed"),this.tileUp(),this.canMove=!0,void m.getInstance().setIsMouseDown(!1))},c.checkMatches=function(){var e=r(s().mark((function e(t){var n,i,a,o,c,l,u,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),n=this.boardManager.getTileGrid(),i=this.matchManager.findMatches(n),t&&this.swappedTiles.some((function(e){return e.isRainbowTile()}))&&i.push(this.swappedTiles),!(i.length>0)){e.next=8;break}this.removeTileGroup(i).then(r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.tileUp(),e.next=3,d.resetTile();case 3:case"end":return e.stop()}}),e)})))),e.next=24;break;case 8:if(!w.getInstance().processPendingScores()){e.next=22;break}for(a=this.boardManager.getTileGrid(),o=!1,c=0;c<g.GridHeight&&!o;c++)for(l=0;l<g.GridWidth&&!o;l++)(u=a[c][l])&&u.node&&u.node.isValid&&(o=!0);if(!o){e.next=18;break}return e.next=16,this.handleMilestoneCompleted();case 16:e.next=21;break;case 18:console.warn("No valid tiles found for milestone animation, creating new board directly"),this.clearBoard(),this.createBoard();case 21:return e.abrupt("return");case 22:t?this.swapTiles():(this.canMove=!0,m.getInstance().setIsMouseDown(!1),this.resetFrames()),this.tileUp();case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.resetFrames=function(){for(var e=this.boardManager.getTileGrid(),t=this.boardManager.getFrameGrid(),n=0;n<g.GridHeight;n++)for(var i=0;i<g.GridWidth;i++)e[n][i]&&t[n][i]&&e[n][i].setFrame(t[n][i])},c.resetTile=function(){var e=r(s().mark((function e(){var t,n,i,a,r,o,c,l,u,d,h,p,f,m,b,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=this.boardManager.getTileGrid(),i=this.boardManager.getFrameGrid(),this.boardManager.getTileCoords(),a=0;case 5:if(!(a<g.GridWidth)){e.next=26;break}for(r=[],o=g.GridHeight-1;o>=0;o--)void 0!==n[o][a]&&r.push({tile:n[o][a],currentY:o});for(c=0;c<g.GridHeight;c++)this.boardManager.setTileAt(a,c,void 0);l=0;case 10:if(!(l<r.length)){e.next=21;break}if(u=r[l],d=g.GridHeight-1-l,this.boardManager.setTileAt(a,d,u.tile),u.tile.setFrame(i[d][a]),u.currentY!==d){e.next=17;break}return e.abrupt("continue",18);case 17:t.push({tile:u.tile,fromY:u.currentY,toY:d,x:a,isNewTile:!1});case 18:l++,e.next=10;break;case 21:if((h=g.GridHeight-r.length)>0)for(p=this.boardManager.getVirtualTilesForColumn(a,h),f=0;f<p.length;f++)m=g.GridHeight-r.length-1-f,b=p[f],this.boardManager.setTileAt(a,m,b),b.addOnMouseDownCallback(this.tileDown.bind(this)),b.addOnMouseUpCallback(this.tileDown.bind(this)),b.addOnRainbowClickCallback(this.handleRainbowClick.bind(this)),b.setFrame(i[m][a]),v=-(f+1),t.push({tile:b,fromY:v,toY:m,x:a,isNewTile:!1});case 23:a++,e.next=5;break;case 26:if(this.boardManager.refillVirtualGrid(),0!==t.length){e.next=30;break}return this.checkMatches(),e.abrupt("return");case 30:return e.next=32,this.animationManager.animateFall(t);case 32:if(this.hasSwappablePair()){e.next=35;break}return e.next=35,this.shuffleBoard();case 35:this.checkMatches();case 36:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.tileUp=function(){var e,t;null==(e=this.firstSelectedTile)||e.changeState("idle"),null==(t=this.secondSelectedTile)||t.changeState("idle"),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0},c.removeTileGroup=function(e){var t=this;return new Promise(r(s().mark((function n(i){var a,c,l,u,d,h,p,f,g,m,b,v,M;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=t.boardManager.getTileCoords(),c=new Set,l=0,u=[],d=s().mark((function e(){var n,i,l,d,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=p.value).length>=4&&n.every((function(e){return!e.isRainbowTile()})))){e.next=18;break}i=n[0],console.log("match special tile",4===n.length?k.BOMB:k.RAINBOW),u.push(r(s().mark((function e(){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.filter((function(e){return e!==i})),e.next=3,t.specialTileManager.createSpecialTile(i,4===n.length?k.BOMB:k.RAINBOW,a,(function(){a.forEach((function(e){e.node&&e.node.isValid&&e.node.destroy()}))}));case 3:case"end":return e.stop()}}),e)})))),l=o(n);case 6:if((d=l()).done){e.next=15;break}if((h=d.value)!==i){e.next=10;break}return e.abrupt("continue",13);case 10:if(a.has(h)){e.next=12;break}return e.abrupt("continue",13);case 12:t.boardManager.clearTileAt(a.get(h).x,a.get(h).y);case 13:e.next=6;break;case 15:w.getInstance().addPendingScore(n.length,n.length),e.next=20;break;case 18:n.forEach((function(e){return c.add(e)})),w.getInstance().addPendingScore(n.length,n.length);case 20:case"end":return e.stop()}}),e)})),h=o(e);case 7:if((p=h()).done){n.next=11;break}return n.delegateYield(d(),"t0",9);case 9:n.next=7;break;case 11:if(0===u.length){n.next=16;break}return n.next=14,Promise.all(u.map((function(e){return e()})));case 14:return i(),n.abrupt("return");case 16:if(f=[],0!==c.size){n.next=20;break}return i(),n.abrupt("return");case 20:g=function(){++l>=c.size&&i()},m=s().mark((function e(){var n,o,l,u,d,h,p,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=M.value,a.has(l)){e.next=4;break}return g(),e.abrupt("return",0);case 4:if(-1!==(u=a.get(l)).x||-1!==u.y){e.next=8;break}return g(),e.abrupt("return",0);case 8:if(d=l===t.firstSelectedTile?null!=(n=t.secondSelectedTile)?n:l:null!=(o=t.firstSelectedTile)?o:l,!l.isSpecial()){e.next=25;break}if(h=t.swappedTiles&&-1!==t.swappedTiles.indexOf(l),(p=t.specialTileManager.activateSpecialTile(l,d,u,h)).length>0&&p.forEach((function(e){return c.add(e)})),m=t.swappedTiles.filter((function(e){return e.isRainbowTile()})).length,!h||2!=m){e.next=21;break}return e.next=17,t.animationManager.animateDoubleRainbow(t.swappedTiles[0],t.swappedTiles[1],t.swappedTiles);case 17:return e.next=19,t.resolveDestroyAllForRainbow(t.swappedTiles);case 19:return i(),e.abrupt("return",{v:void 0});case 21:if(l.isRainbowTile()&&(console.log("is player swap",h),console.log("affectedTiles",p)),h||!l.isRainbowTile()){e.next=25;break}return g(),e.abrupt("return",0);case 25:f.push(r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&l.node&&l.node.isValid){e.next=3;break}return g(),e.abrupt("return");case 3:return l.isSpecial()&&t.particleEffectManager.playSpecialTileDestroyEffect(l.node.getWorldPosition(),l.node.parent,l.getSpecialType()),e.next=6,l.playDestroyAnimation();case 6:if(l.isSpecial()){e.next=9;break}return e.next=9,l.playParticleEffect();case 9:l.node&&l.node.isValid&&l.node.destroy(),g();case 11:case"end":return e.stop()}}),e)})))),t.boardManager.clearTileAt(u.x,u.y);case 27:case"end":return e.stop()}}),e)})),v=o(c);case 23:if((M=v()).done){n.next=32;break}return n.delegateYield(m(),"t1",25);case 25:if(0!==(b=n.t1)){n.next=28;break}return n.abrupt("continue",30);case 28:if(!b){n.next=30;break}return n.abrupt("return",b.v);case 30:n.next=23;break;case 32:return n.next=34,Promise.all(f.map((function(e){return e()})));case 34:t.swappedTiles=[];case 35:case"end":return n.stop()}}),n)}))))},c.resolveDestroyAllForRainbow=function(){var e=r(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(r(s().mark((function e(i){var a,c,l,u,d,h,p,f,m,b,v,M,T,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Map,c=n.boardManager.getTileCoords(),l=n.boardManager.getTileGrid(),u=t.map((function(e){return c.get(e)})),d=o(l);case 5:if((h=d()).done){e.next=15;break}p=h.value,f=s().mark((function e(){var t,i,o,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=b.value)&&(o=c.get(t),l=Math.max(Math.min(Math.abs(o.x-u[0].x),Math.abs(o.x-u[1].x)),Math.min(Math.abs(o.y-u[0].y),Math.abs(o.y-u[1].y))),a.set(l,[].concat(null!=(i=a.get(l))?i:[],[r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.playDestroyAnimation();case 2:return e.next=4,t.playParticleEffect();case 4:t.node&&t.node.isValid&&t.node.destroy(),M();case 6:case"end":return e.stop()}}),e)})))])),n.boardManager.clearTileAt(o.x,o.y));case 2:case"end":return e.stop()}}),e)})),m=o(p);case 9:if((b=m()).done){e.next=13;break}return e.delegateYield(f(),"t0",11);case 11:e.next=9;break;case 13:e.next=5;break;case 15:v=0,M=function(){++v>=g.GridWidth*g.GridHeight&&i()},T=0;case 18:if(!(T<=Math.max(g.GridWidth,g.GridHeight))){e.next=26;break}if(!(w=a.get(T))){e.next=23;break}return e.next=23,Promise.all(w.map((function(e){return e()})));case 23:T++,e.next=18;break;case 26:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.onDestroy=function(){},c.setupPopups=function(){var e=this;this.pausePopup&&this.pausePopup.setCallbacks((function(){return e.resumeGame()}),(function(){return e.startNewGame()})),this.gameOverPopup&&this.gameOverPopup.setCallback((function(){return e.startNewGame()})),this.pauseButton&&this.pauseButton.node&&(this.pauseButton.node.off(h.EventType.CLICK),this.pauseButton.node.on(h.EventType.CLICK,this.togglePause,this),this.setupPauseButtonAnimation())},c.setupPauseButtonAnimation=function(){if(this.pauseButton&&this.pauseButton.node&&this.pauseButton.node.isValid){var e=this.pauseButton.node,t=e.scale.clone();e.off(d.EventType.MOUSE_ENTER),e.off(d.EventType.MOUSE_LEAVE),e.off(d.EventType.TOUCH_START),e.off(d.EventType.TOUCH_END),e.on(d.EventType.MOUSE_ENTER,(function(){e.isValid&&p(e).to(.1,{scale:new f(1.1,1.1,1)},{easing:"quadOut"}).start()})),e.on(d.EventType.MOUSE_LEAVE,(function(){e.isValid&&p(e).to(.1,{scale:t},{easing:"quadOut"}).start()})),e.on(d.EventType.TOUCH_START,(function(){e.isValid&&p(e).to(.05,{scale:new f(.95,.95,1)},{easing:"quadOut"}).start()})),e.on(d.EventType.TOUCH_END,(function(){e.isValid&&p(e).to(.1,{scale:t},{easing:"backOut"}).start()}))}},c.togglePause=function(){this.isGameOver||(this.isGamePaused?this.resumeGame():this.pauseGame())},c.pauseGame=function(){this.isGamePaused||this.isGameOver||(this.isGamePaused=!0,this.setGameInteractionEnabled(!1),console.log("Game paused"),this.pausePopup&&(console.log("show pause popup"),this.pausePopup.show()))},c.resumeGame=function(){this.isGamePaused&&(this.isGamePaused=!1,this.setGameInteractionEnabled(!0),console.log("Game resumed"))},c.setGameInteractionEnabled=function(e){if(this.boardManager)for(var t=this.boardManager.getTileGrid(),n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var a=t[n][i];if(a){var r=a.getComponent(h);r&&(r.interactable=e)}}},c.startNewGame=function(){console.log("Starting new game..."),this.isGamePaused=!1,this.isGameOver=!1,this.clearBoard(),this.createBoard(!0),this.setGameInteractionEnabled(!0),console.log("New game started!")},c.checkGameOverConditions=function(){!this.isGameOver&&this.isGamePaused},c.triggerGameOver=function(e){var t=this;if(!this.isGameOver){console.log("Game Over:",e),this.isGameOver=!0,this.setGameInteractionEnabled(!1);var n=w.getInstance().getCurrentScore();this.gameOverPopup&&setTimeout((function(){t.gameOverPopup.show(n)}),1e3)}},c.processMoveAndCheckGameState=function(){this.movesRemaining--,this.updateMovesDisplay(),this.checkGameOverConditions()},c.updateMovesDisplay=function(){console.log("Moves remaining: "+this.movesRemaining)},c.handleRainbowClick=function(){var e=r(s().mark((function e(t){var n,i,a,r,o,c,l,u,d,h,p,f,m,b,v=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isGamePaused&&!this.isGameOver&&this.canMove){e.next=2;break}return e.abrupt("return");case 2:for(this.canMove=!1,this.playerIdleTime=0,n=this.boardManager.getTileGrid(),i=[],a=0;a<g.GridHeight;a++)for(r=0;r<g.GridWidth;r++)(o=n[a][r])&&o!==t&&o.node&&o.node.isValid&&i.push(o);if(0!==i.length){e.next=10;break}return this.canMove=!0,e.abrupt("return");case 10:for(c=Math.floor(Math.random()*(g.RainbowClick.maxDestroyCount-g.RainbowClick.minDestroyCount))+g.RainbowClick.minDestroyCount,l=Math.min(i.length,c),u=[],d=[].concat(i),h=d.length-1;h>0;h--)p=Math.floor(Math.random()*(h+1)),f=[d[p],d[h]],d[h]=f[0],d[p]=f[1];return u.push.apply(u,d.slice(0,l)),e.next=18,this.animationManager.animateRainbowClickEffect(t,u);case 18:return m=this.boardManager.getTileCoords(),(b=m.get(t))&&this.boardManager.clearTileAt(b.x,b.y),u.forEach((function(e){var t=m.get(e);t&&(e.node&&e.node.isValid&&e.node.destroy(),v.boardManager.clearTileAt(t.x,t.y))})),w.getInstance().addPendingScore(l+1,l+1),e.next=25,t.playDestroyAnimation();case 25:return t.node&&t.node.isValid&&t.node.destroy(),e.next=28,this.resetTile();case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.findSwappablePair=function(){for(var e=this.boardManager.getTileGrid(),t=0;t<g.GridHeight;t++)for(var n=0;n<g.GridWidth;n++){var i=e[t][n];if(i){if(n<g.GridWidth-1){var a=e[t][n+1];if(a&&this.wouldSwapResultInMatch(i,a,e))return[i,a]}if(t<g.GridHeight-1){var r=e[t+1][n];if(r&&this.wouldSwapResultInMatch(i,r,e))return[i,r]}}}return null},c.wouldSwapResultInMatch=function(e,t,n){for(var i=-1,a=-1,r=-1,s=-1,o=0;o<g.GridHeight;o++)for(var c=0;c<g.GridWidth;c++)n[o][c]===e&&(a=o,i=c),n[o][c]===t&&(s=o,r=c);if(-1===i||-1===a||-1===r||-1===s)return!1;n[a][i]=t,n[s][r]=e;var l=this.matchManager.findMatches(n);return n[a][i]=e,n[s][r]=t,l.length>0},c.showHint=function(){var e=r(s().mark((function e(){var t,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hintActive){e.next=2;break}return e.abrupt("return");case 2:if(i=this.findSwappablePair()){e.next=5;break}return e.abrupt("return");case 5:return this.hintActive=!0,e.next=8,Promise.all([null==(t=i[0].getComponent(M))?void 0:t.animatePulse(10),null==(n=i[1].getComponent(M))?void 0:n.animatePulse(10)]);case 8:this.hintActive=!1;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.hasSwappablePair=function(){return null!==this.findSwappablePair()},c.shuffleBoard=function(){var e=r(s().mark((function e(){var t,n,i,a,r,o,c,l,u,d,h,p,f,m,b,v,M;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.boardManager.getTileGrid(),n=[],i=0;i<g.GridHeight;i++)for(a=0;a<g.GridWidth;a++)(r=t[i][a])&&n.push(r);o=0;case 4:for(c=n.length-1;c>0;c--)l=Math.floor(Math.random()*(c+1)),u=[n[l],n[c]],n[c]=u[0],n[l]=u[1];for(d=0,h=0;h<g.GridHeight;h++)for(p=0;p<g.GridWidth;p++)t[h][p]&&(t[h][p]=n[d++],f=this.boardManager.getWorldPosition({x:p,y:h}),t[h][p].node.setPosition(f.x,f.y,0));for((m=this.boardManager.getTileCoords()).clear(),b=0;b<g.GridHeight;b++)for(v=0;v<g.GridWidth;v++)(M=t[b][v])&&m.set(M,{x:v,y:b});if(!(++o>20)){e.next=13;break}return e.abrupt("break",14);case 13:if(!this.hasSwappablePair()){e.next=4;break}case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(y)).prototype,"camera",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(U.prototype,"celebrationNode",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(U.prototype,"milestoneUINode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(U.prototype,"pausePopup",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(U.prototype,"gameOverPopup",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(U.prototype,"pauseButton",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=U))||H));c._RF.pop()}}}));

System.register("chunks:///_virtual/GameOverPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,n,i,a,r,s,l,c,h,u,p,d,g,b,S,C,f,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,s=e.Node,l=e.Label,c=e.Button,h=e.sys,u=e.UITransform,p=e.Sprite,d=e.Color,g=e.Vec2,b=e.EventHandler,S=e.tween,C=e.Vec3,f=e.UIOpacity,w=e.Component}],execute:function(){var v,m,y,L,O,P,k,z,T,B,H,E,G,M,I;a._RF.push({},"b2c3dTl9qeJAbzeI0VniQEj","GameOverPopup",void 0);var U=r.ccclass,D=r.property;e("GameOverPopup",(v=U("GameOverPopup"),m=D(s),y=D(s),L=D(l),O=D(l),P=D(l),k=D(c),v((B=t((T=function(e){function t(){for(var t,o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,n(t,"popupPanel",B,i(t)),n(t,"backgroundOverlay",H,i(t)),n(t,"titleLabel",E,i(t)),n(t,"scoreLabel",G,i(t)),n(t,"highScoreLabel",M,i(t)),n(t,"newGameButton",I,i(t)),t.isVisible=!1,t.onNewGameCallback=null,t.currentScore=0,t.highScore=0,t}o(t,e);var a=t.prototype;return a.start=function(){this.loadHighScore(),this.createUI(),this.setupButtons(),this.hide(!1)},a.loadHighScore=function(){var e=h.localStorage.getItem("candyCrushHighScore");this.highScore=e?parseInt(e):0},a.saveHighScore=function(){h.localStorage.setItem("candyCrushHighScore",this.highScore.toString())},a.createUI=function(){this.popupPanel||this.createPopupPanel(),this.backgroundOverlay||this.createBackgroundOverlay(),this.enhanceVisualStyling()},a.createPopupPanel=function(){this.popupPanel=new s("PopupPanel"),this.node.addChild(this.popupPanel),this.popupPanel.addComponent(u).setContentSize(450,350);var e=this.popupPanel.addComponent(p);e.type=p.Type.SLICED,e.sizeMode=p.SizeMode.CUSTOM,e.color=new d(50,20,20,240);var t=new s("Border");this.popupPanel.addChild(t),t.addComponent(u).setContentSize(460,360);var o=t.addComponent(p);o.type=p.Type.SLICED,o.sizeMode=p.SizeMode.CUSTOM,o.color=new d(220,20,60,200),t.setSiblingIndex(0),this.createPanelContent()},a.createPanelContent=function(){if(this.popupPanel){var e=new s("Title");this.popupPanel.addChild(e),e.setPosition(0,130,0),e.addComponent(u).setContentSize(400,60),this.titleLabel=e.addComponent(l),this.titleLabel.string="GAME OVER",this.titleLabel.fontSize=38,this.titleLabel.isBold=!0,this.titleLabel.color=new d(220,20,60,255),this.titleLabel.enableOutline=!0,this.titleLabel.outlineColor=new d(139,0,0,255),this.titleLabel.outlineWidth=4,this.titleLabel.enableShadow=!0,this.titleLabel.shadowColor=new d(0,0,0,180),this.titleLabel.shadowOffset=new g(3,-3),this.titleLabel.shadowBlur=5,this.createScoreDisplay(),this.createHighScoreDisplay(),this.newGameButton=this.createButton("New Game",0,-100,new d(255,140,0,255))}},a.createScoreDisplay=function(){if(this.popupPanel){var e=new s("ScoreContainer");this.popupPanel.addChild(e),e.setPosition(0,40,0);var t=new s("ScoreTitle");e.addChild(t),t.setPosition(0,20,0),t.addComponent(u).setContentSize(300,30);var o=t.addComponent(l);o.string="Final Score",o.fontSize=22,o.isBold=!0,o.color=new d(255,255,255,255),o.enableOutline=!0,o.outlineColor=new d(0,0,0,200),o.outlineWidth=2;var n=new s("ScoreValue");e.addChild(n),n.setPosition(0,-15,0),n.addComponent(u).setContentSize(350,40),this.scoreLabel=n.addComponent(l),this.scoreLabel.string="0",this.scoreLabel.fontSize=32,this.scoreLabel.isBold=!0,this.scoreLabel.color=new d(255,215,0,255),this.scoreLabel.enableOutline=!0,this.scoreLabel.outlineColor=new d(139,69,19,255),this.scoreLabel.outlineWidth=3,this.scoreLabel.enableShadow=!0,this.scoreLabel.shadowColor=new d(255,165,0,150),this.scoreLabel.shadowOffset=new g(0,0),this.scoreLabel.shadowBlur=8}},a.createHighScoreDisplay=function(){if(this.popupPanel){var e=new s("HighScoreContainer");this.popupPanel.addChild(e),e.setPosition(0,-25,0);var t=new s("HighScoreTitle");e.addChild(t),t.setPosition(0,20,0),t.addComponent(u).setContentSize(300,30);var o=t.addComponent(l);o.string="High Score",o.fontSize=20,o.isBold=!0,o.color=new d(255,255,255,255),o.enableOutline=!0,o.outlineColor=new d(0,0,0,200),o.outlineWidth=2;var n=new s("HighScoreValue");e.addChild(n),n.setPosition(0,-15,0),n.addComponent(u).setContentSize(350,35),this.highScoreLabel=n.addComponent(l),this.highScoreLabel.string=this.highScore.toLocaleString(),this.highScoreLabel.fontSize=28,this.highScoreLabel.isBold=!0,this.highScoreLabel.color=new d(138,43,226,255),this.highScoreLabel.enableOutline=!0,this.highScoreLabel.outlineColor=new d(72,61,139,255),this.highScoreLabel.outlineWidth=3}},a.createButton=function(e,t,o,n){var i=new s(e+"Button");this.popupPanel.addChild(i),i.setPosition(t,o,0),i.addComponent(u).setContentSize(220,55);var a=i.addComponent(p);a.type=p.Type.SLICED,a.sizeMode=p.SizeMode.CUSTOM,a.color=n;var r=i.addComponent(c),h=new s("Label");i.addChild(h),h.addComponent(u).setContentSize(200,45);var g=h.addComponent(l);return g.string=e,g.fontSize=26,g.isBold=!0,g.color=new d(255,255,255,255),g.enableOutline=!0,g.outlineColor=new d(0,0,0,200),g.outlineWidth=2,r.backgroundSprite=a,r},a.createBackgroundOverlay=function(){this.backgroundOverlay=new s("BackgroundOverlay"),this.node.addChild(this.backgroundOverlay),this.backgroundOverlay.setSiblingIndex(0),this.backgroundOverlay.addComponent(u).setContentSize(2e3,2e3);var e=this.backgroundOverlay.addComponent(p);e.type=p.Type.SIMPLE,e.sizeMode=p.SizeMode.CUSTOM,e.color=new d(0,0,0,150)},a.setupButtons=function(){if(this.newGameButton){this.setupButtonAnimations(this.newGameButton);var e=new b;e.target=this.node,e.component="GameOverPopup",e.handler="onNewGameClicked",this.newGameButton.clickEvents.push(e)}},a.setupButtonAnimations=function(e){var t=e.node,o=t.scale.clone(),n=e.backgroundSprite,i=n.color.clone();t.on(s.EventType.MOUSE_ENTER,(function(){S(t).to(.1,{scale:new C(1.1,1.1,1)},{easing:"quadOut"}).start(),S(n).to(.1,{color:new d(i.r+40,i.g+40,i.b+40,i.a)}).start()})),t.on(s.EventType.MOUSE_LEAVE,(function(){S(t).to(.1,{scale:o},{easing:"quadOut"}).start(),S(n).to(.1,{color:i}).start()})),t.on(s.EventType.TOUCH_START,(function(){S(t).to(.05,{scale:new C(.95,.95,1)},{easing:"quadOut"}).start()})),t.on(s.EventType.TOUCH_END,(function(){S(t).to(.15,{scale:new C(1.15,1.15,1)},{easing:"backOut"}).to(.1,{scale:o},{easing:"quadOut"}).start()})),t.on(s.EventType.TOUCH_CANCEL,(function(){S(t).to(.1,{scale:o},{easing:"quadOut"}).start()}))},a.enhanceVisualStyling=function(){this.popupPanel&&S(this.popupPanel.getComponent(p)).to(1.5,{color:new d(255,255,255,255)}).to(1.5,{color:new d(255,200,200,255)}).union().repeatForever().start()},a.show=function(e){if(!this.isVisible){if(this.currentScore=e,this.checkAndUpdateHighScore(),this.updateScoreDisplays(),this.isVisible=!0,this.node.active=!0,this.popupPanel)this.popupPanel.setScale(0,0,1),(this.popupPanel.getComponent(f)||this.popupPanel.addComponent(f)).opacity=0;if(this.backgroundOverlay)(this.backgroundOverlay.getComponent(f)||this.backgroundOverlay.addComponent(f)).opacity=0;if(this.backgroundOverlay){var t=this.backgroundOverlay.getComponent(f);S(t).to(.4,{opacity:255},{easing:"quadOut"}).start()}if(this.popupPanel){var o=this.popupPanel.getComponent(f);S(o).to(.5,{opacity:255},{easing:"quadOut"}).start(),S(this.popupPanel).to(.2,{scale:new C(.3,.3,1)},{easing:"quadOut"}).to(.4,{scale:new C(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new C(1,1,1)},{easing:"quadOut"}).start()}this.animateScoreCounting()}},a.animateScoreCounting=function(){var e=this;if(this.scoreLabel){var t=0,o=this.currentScore,n=o/60;setTimeout((function i(){t=Math.min(t+n,o),e.scoreLabel.string=Math.floor(t).toLocaleString(),t<o&&setTimeout(i,25)}),800)}},a.checkAndUpdateHighScore=function(){this.currentScore>this.highScore&&(this.highScore=this.currentScore,this.saveHighScore(),this.celebrateNewHighScore())},a.celebrateNewHighScore=function(){if(this.highScoreLabel){var e=this.highScoreLabel.color.clone();S(this.highScoreLabel).to(.2,{color:new d(255,215,0,255)}).to(.2,{color:new d(255,255,255,255)}).to(.2,{color:new d(255,215,0,255)}).to(.2,{color:e}).start(),S(this.highScoreLabel.node).to(.3,{scale:new C(1.3,1.3,1)},{easing:"backOut"}).to(.2,{scale:new C(1,1,1)},{easing:"quadOut"}).start()}},a.updateScoreDisplays=function(){this.scoreLabel&&(this.scoreLabel.string="0"),this.highScoreLabel&&(this.highScoreLabel.string=this.highScore.toLocaleString())},a.hide=function(e){var t=this;if(void 0===e&&(e=!0),this.isVisible||!e)if(this.isVisible=!1,e){if(this.popupPanel){var o=this.popupPanel.getComponent(f)||this.popupPanel.addComponent(f);S(this.popupPanel).to(.3,{scale:new C(.6,.6,1)},{easing:"backIn"}).start(),S(o).to(.3,{opacity:0},{easing:"quadIn"}).start()}if(this.backgroundOverlay){var n=this.backgroundOverlay.getComponent(f)||this.backgroundOverlay.addComponent(f);S(n).to(.25,{opacity:0},{easing:"quadIn"}).call((function(){t.node.active=!1})).start()}else setTimeout((function(){t.node.active=!1}),300)}else this.node.active=!1},a.setCallback=function(e){this.onNewGameCallback=e},a.onNewGameClicked=function(){var e=this;this.hide(),this.onNewGameCallback&&setTimeout((function(){return e.onNewGameCallback()}),300)},a.getHighScore=function(){return this.highScore},a.resetHighScore=function(){this.highScore=0,this.saveHighScore(),this.highScoreLabel&&(this.highScoreLabel.string="0")},a.onDestroy=function(){},t}(w)).prototype,"popupPanel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(T.prototype,"backgroundOverlay",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(T.prototype,"titleLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(T.prototype,"scoreLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(T.prototype,"highScoreLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(T.prototype,"newGameButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=T))||z));a._RF.pop()}}}));

System.register("chunks:///_virtual/IdleState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileState.ts","./AnimationManager.ts"],(function(n){var t,e,i,a;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy},function(n){i=n.TileState},function(n){a=n.AnimationManager}],execute:function(){e._RF.push({},"22289Nm7F9CA4w+U3Kkqxb/","IdleState",void 0);n("IdleState",function(n){function e(t){var e;return(e=n.call(this,t)||this).animationHandler=null,e.animationHandler=t.getComponent(a),e}t(e,n);var i=e.prototype;return i.onEnter=function(){var n,t;null==(n=this.animationHandler)||n.updateOriginalValues(),null==(t=this.animationHandler)||t.stopAllAnimations()},i.onExit=function(){},i.onUpdate=function(){},i.onPlayerIdle=function(){var n;null==(n=this.animationHandler)||n.animatePlayerIdle()},e}(i));e._RF.pop()}}}));

System.register("chunks:///_virtual/InputManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,s,n;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,s=e._decorator,n=e.Component}],execute:function(){var l;i._RF.push({},"27ed9f/giNFtYZoHrSdQky5","InputManager",void 0);var r=s.ccclass;e("InputManager",r("InputManager")(l=function(e){function i(){for(var t,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(t=e.call.apply(e,[this].concat(s))||this).firstSelectedTile=void 0,t.secondSelectedTile=void 0,t.boardManager=null,t.canMove=!0,t}t(i,e);var s=i.prototype;return s.setBoardManager=function(e){this.boardManager=e},s.setCanMove=function(e){this.canMove=e},s.getCanMove=function(){return this.canMove},s.handleTileClick=function(e){if(!this.canMove||!this.boardManager)return{isValid:!1,shouldSwap:!1,firstTile:e};if(!this.firstSelectedTile||this.firstSelectedTile===e)return this.selectFirstTile(e),{isValid:!0,shouldSwap:!1,firstTile:e};if(this.secondSelectedTile=e,this.areAdjacent(this.firstSelectedTile,this.secondSelectedTile)){var t={isValid:!0,shouldSwap:!0,firstTile:this.firstSelectedTile,secondTile:this.secondSelectedTile};return this.canMove=!1,t}return this.deselectAll(),this.selectFirstTile(e),{isValid:!0,shouldSwap:!1,firstTile:e}},s.swapCompleted=function(){this.canMove=!0,this.deselectAll()},s.swapFailed=function(){this.canMove=!0},s.getSelectedTiles=function(){return{first:this.firstSelectedTile,second:this.secondSelectedTile}},s.deselectAll=function(){var e,t;null==(e=this.firstSelectedTile)||e.changeState("idle"),null==(t=this.secondSelectedTile)||t.changeState("idle"),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0},s.selectFirstTile=function(e){this.deselectAll(),this.firstSelectedTile=e,e.changeState("select")},s.areAdjacent=function(e,t){if(!this.boardManager)return!1;var i=this.boardManager.getTileCoords().get(e),s=this.boardManager.getTileCoords().get(t);if(!i||!s)return!1;var n=Math.abs(i.x-s.x),l=Math.abs(i.y-s.y);return 1===n&&0===l||0===n&&1===l},s.reset=function(){this.deselectAll(),this.canMove=!0},i}(n))||l);i._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AssetLoader.ts","./Frame.ts","./GameGlobalData.ts","./GameManager.ts","./ProgressUI.ts","./Tile.ts","./AnimationManager.ts","./BoardManager.ts","./InputManager.ts","./MatchManager.ts","./ParticleEffectManager.ts","./ProgressManager.ts","./SpecialTileManager.ts","./singleton.ts","./IdleState.ts","./SelectState.ts","./TileState.ts","./GameOverPopup.ts","./MilestoneAchievementUI.ts","./PausePopup.ts","./AnimationConfig.ts","./GameConfig.ts","./SpecialTileConfig.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MatchManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./SpecialTileConfig.ts"],(function(e){var t,n,a,r,i,o,c,h;return{setters:[function(e){t=e.inheritsLoose,n=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,r=e._decorator,i=e.Component},function(e){o=e.GameConfig,c=e.PatternShape},function(e){h=e.SpecialTileType}],execute:function(){var s;a._RF.push({},"32a97mjyCxIAaOfDGLjqzvl","MatchManager",void 0);var u=r.ccclass;e("MatchManager",u("MatchManager")(s=function(e){function a(){return e.apply(this,arguments)||this}t(a,e);var r=a.prototype;return r.findMatches=function(e){var t=[],n=new Set;return this.findShapeMatches(e,t,n),console.log("matches",t),t},r.findShapeMatches=function(e,t,n){for(var a=this,r=function(r){var i=c.filter((function(e){return e.shape.length===r}));a.findShapeMatchesByPatterns(e,t,n,i)},i=5;i>=3;i--)r(i)},r.findShapeMatchesByPatterns=function(e,t,a,r){for(var i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++){var c=e[i][o];if(c&&!a.has(c)&&c.getSpecialType()!==h.RAINBOW)for(var s,u=n(r);!(s=u()).done;){var f=s.value,l=this.findPatternMatch(e,o,i,f,a);l&&(t.push(l),l.forEach((function(e){return a.add(e)})))}}},r.isInGrid=function(e,t){return e>=0&&e<o.GridWidth&&t>=0&&t<o.GridHeight},r.findPatternMatch=function(e,t,a,r,i){for(var o,c,h=[],s=r.shape,u=null==(o=e[a][t])?void 0:o.getTileType(),f=n(s);!(c=f()).done;){var l=c.value,p=t+l.x,v=a+l.y;if(!this.isInGrid(p,v))return null;var d=e[v][p];if(!d||i.has(d)||d.getTileType()!==u||d.isRainbowTile())return null;h.push(d)}return h.length>=r.shape.length?h:null},a}(i))||s);a._RF.pop()}}}));

System.register("chunks:///_virtual/MilestoneAchievementUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,a,o,l,s,c,u,p,h,f,b,m,v,g,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){l=e.cclegacy,s=e._decorator,c=e.Node,u=e.Label,p=e.Sprite,h=e.Prefab,f=e.Tween,b=e.Component,m=e.instantiate,v=e.UIOpacity,g=e.tween,d=e.Vec3}],execute:function(){var w,y,P,L,I,S,x,k,E,z,A,M,T,q,C;l._RF.push({},"583aatI2IlIeqzd1+f18JPf","MilestoneAchievementUI",void 0);var U=s.ccclass,D=s.property;e("MilestoneAchievementUI",(w=U("MilestoneAchievementUI"),y=D(c),P=D(u),L=D(u),I=D(u),S=D(p),x=D(h),w((z=t((E=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,r(t,"achievementPanel",z,i(t)),r(t,"titleLabel",A,i(t)),r(t,"levelLabel",M,i(t)),r(t,"messageLabel",T,i(t)),r(t,"backgroundSprite",q,i(t)),r(t,"confettiPrefab",C,i(t)),t}n(t,e);var l=t.prototype;return l.showMilestoneAchievement=function(){var e=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Showing milestone achievement UI",t),this.updateLabels(t),this.node.active=!0,this.achievementPanel&&(this.achievementPanel.setScale(0,0,0),(n=this.achievementPanel.getComponent(v))&&(n.opacity=255)),e.next=6,this.animateEntrance();case 6:return this.confettiPrefab&&((r=m(this.confettiPrefab)).setParent(this.node),r.setPosition(0,350,0),r.setScale(0,0,0),(i=r.getComponent(v))&&(i.opacity=255),g(r).to(.5,{scale:new d(1.1,1.1,1.1)},{easing:"quadOut"}).to(.2,{scale:new d(1,1,1)},{easing:"quadIn"}).start()),e.next=9,new Promise((function(e){return setTimeout(e,3e3)}));case 9:return e.next=11,this.animateExit();case 11:this.node.active=!1;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.updateLabels=function(e){this.titleLabel&&(this.titleLabel.string="MILESTONE ACHIEVED!"),this.levelLabel&&(this.levelLabel.string="LEVEL "+e.currentMilestone),this.messageLabel&&(this.messageLabel.string="Congratulations!\nYou've reached level "+e.currentMilestone+"!\nTotal Score: "+e.currentScore)},l.animateEntrance=function(){var e=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.achievementPanel){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){g(t.achievementPanel).to(.5,{scale:new d(1.1,1.1,1.1)},{easing:"quadOut"}).to(.2,{scale:new d(1,1,1)},{easing:"quadIn"}).call((function(){e()})).start()})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.animateExit=function(){var e=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.achievementPanel){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){var n=t.achievementPanel.getComponent(v);n&&g(n).to(.3,{opacity:0},{easing:"quadIn"}).start(),g(t.achievementPanel).to(.3,{scale:new d(.8,.8,.8)},{easing:"quadIn"}).call((function(){e()})).start()})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.onDestroy=function(){this.achievementPanel&&f.stopAllByTarget(this.achievementPanel),this.backgroundSprite&&f.stopAllByTarget(this.backgroundSprite)},t}(b)).prototype,"achievementPanel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(E.prototype,"titleLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(E.prototype,"levelLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(E.prototype,"messageLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(E.prototype,"backgroundSprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(E.prototype,"confettiPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=E))||k));l._RF.pop()}}}));

System.register("chunks:///_virtual/ParticleEffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpecialTileConfig.ts"],(function(t){var e,n,r,i,o,a,c,f,u,s,l,p,h,b,d,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){c=t.cclegacy,f=t._decorator,u=t.Prefab,s=t.Vec3,l=t.UITransform,p=t.instantiate,h=t.ParticleSystem2D,b=t.Color,d=t.Component},function(t){w=t.SpecialTileType}],execute:function(){var E,y,v,g,m,C,k,x,P,B,T,A,S,z,O,M,V,R,I;c._RF.push({},"e3f4g5h6-i7j8-9012-3456-789012cdefgh","ParticleEffectManager",void 0);var N=f.ccclass,W=f.property;t("ParticleEffectManager",(E=N("ParticleEffectManager"),y=W(u),v=W(u),g=W(u),m=W(u),C=W(u),k=W(u),x=W(u),P=W(u),E((A=e((T=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,r(e,"bombCreationEffect",A,i(e)),r(e,"rainbowCreationEffect",S,i(e)),r(e,"bombActivationEffect",z,i(e)),r(e,"rainbowActivationEffect",O,i(e)),r(e,"explosionEffect",M,i(e)),r(e,"sparkleEffect",V,i(e)),r(e,"confettiEffect",R,i(e)),r(e,"shockwaveEffect",I,i(e)),e}n(e,t);var c=e.prototype;return c.playSpecialTileCreationEffect=function(){var t=o(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=this.getCreationEffectPrefab(n))&&e.node&&e.node.isValid){t.next=3;break}return t.abrupt("return");case 3:return t.abrupt("return",this.playEffect(r,e.node.worldPosition,e.node.parent));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.playSpecialTileActivationEffect=function(t,e){var n=this.getActivationEffectPrefab(e);n&&t.node&&t.node.isValid&&this.playEffect(n,t.node.worldPosition,t.node.parent)},c.playExplosionEffect=function(){var t=o(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.explosionEffect){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",this.playEffect(this.explosionEffect,e,n));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.playSparkleEffect=function(){var t=o(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sparkleEffect){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",this.playEffect(this.sparkleEffect,e,n));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.playConfettiEffect=function(){var t=o(a().mark((function t(e,n,r){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.confettiEffect||this.sparkleEffect){t.next=3;break}return t.abrupt("return");case 3:return t.abrupt("return",this.playColoredEffect(i,e,n,r));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}(),c.playMilestoneConfetti=function(){var t=o(a().mark((function t(e){var n,r,i,o=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[new b(255,215,0,255),new b(255,20,147,255),new b(0,191,255,255),new b(50,205,50,255),new b(255,165,0,255),new b(138,43,226,255)],r=this.generateConfettiPositions(e),i=r.map((function(t,r){return new Promise((function(i){setTimeout((function(){var a=n[r%n.length];o.playConfettiEffect(t,e,a).then(i)}),150*r)}))})),t.next=5,Promise.all(i);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),c.generateConfettiPositions=function(t){var e=[],n=this.getNodeBounds(t);return e.push(new s(n.left+100,n.top-100,0),new s(n.right-100,n.top-100,0),new s(n.center.x,n.top-50,0),new s(n.left+50,n.center.y+100,0),new s(n.right-50,n.center.y+100,0),new s(n.center.x-200,n.top-150,0),new s(n.center.x+200,n.top-150,0)),e},c.getNodeBounds=function(t){try{var e=t.getComponent(l);if(e&&e.contentSize){var n=e.contentSize;return{left:-n.width/2,right:n.width/2,top:n.height/2,bottom:-n.height/2,center:{x:0,y:0}}}}catch(t){console.warn("Could not get node bounds, using defaults:",t)}return{left:-400,right:400,top:300,bottom:-300,center:{x:0,y:0}}},c.getCreationEffectPrefab=function(t){switch(t){case w.BOMB:return this.bombCreationEffect;case w.RAINBOW:return this.rainbowCreationEffect;default:return null}},c.getActivationEffectPrefab=function(t){switch(t){case w.BOMB:return this.bombActivationEffect;case w.RAINBOW:return this.rainbowActivationEffect;default:return null}},c.playEffect=function(t,e,n){if(n){var r=p(t);n.addChild(r),r.setWorldPosition(e);var i=r.getComponent(h);i&&(i.playOnLoad=!0,setTimeout((function(){r&&r.isValid&&r.destroy()}),3e3))}},c.playColoredEffect=function(t,e,n,r){if(n){var i=p(t);n.addChild(i),i.setWorldPosition(e);var o=i.getComponent(h);o&&(o.playOnLoad=!0,r&&(o.startColor=r,o.endColor=r,o.startColorVar=new b(50,50,50,0),o.endColorVar=new b(50,50,50,0)),setTimeout((function(){i&&i.isValid&&i.destroy()}),3e3))}},c.playMultipleEffects=function(){var t=o(a().mark((function t(e,n,r){var i,o=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.map((function(t,e){return new Promise((function(i){setTimeout((function(){"explosion"===n?o.playExplosionEffect(t,r).then(i):"sparkle"===n?o.playSparkleEffect(t,r).then(i):"confetti"===n?o.playConfettiEffect(t,r).then(i):"shockwave"===n?o.playShockwaveEffect(t,r).then(i):i()}),100*e)}))})),t.next=3,Promise.all(i);case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),c.playSpecialTileDestroyEffect=function(){var t=o(a().mark((function t(e,n,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shockwaveEffect){t.next=2;break}return t.abrupt("return");case 2:t.t0=r,t.next=t.t0===w.BOMB?5:t.t0===w.RAINBOW?6:7;break;case 5:return t.abrupt("return",this.playEffect(this.shockwaveEffect,e,n));case 6:case 7:return t.abrupt("break",8);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}(),c.getParticleEffectPrefab=function(t){switch(t){case w.BOMB:return this.bombCreationEffect;case w.RAINBOW:return this.rainbowCreationEffect;default:return null}},c.createTileParticleEffect=function(t,e){if(t.node&&t.node.isValid){var n=t.getTileType().color,r=this.getParticleEffectPrefab(e);if(console.log("effectPrefab",r),r){var i=p(r);i.setParent(t.node),t.node.addChild(i),i.setPosition(0,-20,0);var o=i.getComponent(h);console.log("particleSystem",o),o&&e!==w.RAINBOW&&(o.startColor=n,o.startColorVar=new b(0,0,0,255),o.endColor=n,o.endColorVar=new b(0,0,0,255),o.playOnLoad=!0)}}},c.playShockwaveEffect=function(){var t=o(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shockwaveEffect){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",this.playEffect(this.shockwaveEffect,e,n));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.onDestroy=function(){this.node.children.forEach((function(t){t.isValid&&t.destroy()}))},e}(d)).prototype,"bombCreationEffect",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(T.prototype,"rainbowCreationEffect",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(T.prototype,"bombActivationEffect",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(T.prototype,"rainbowActivationEffect",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(T.prototype,"explosionEffect",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(T.prototype,"sparkleEffect",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(T.prototype,"confettiEffect",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(T.prototype,"shockwaveEffect",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=T))||B));c._RF.pop()}}}));

System.register("chunks:///_virtual/PausePopup.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,o,i,a,u,s,l,r,c,p,h,d,g,f,b,v,C;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){a=t.cclegacy,u=t._decorator,s=t.Node,l=t.Button,r=t.Toggle,c=t.Label,p=t.EventHandler,h=t.Sprite,d=t.tween,g=t.Vec3,f=t.Color,b=t.UIOpacity,v=t.AudioSource,C=t.Component}],execute:function(){var m,y,k,w,P,T,O,E,B,S,N,G,V,q,A;a._RF.push({},"a1b2cPU5fZ4kKvNEjRWeJAS","PausePopup",void 0);var _=u.ccclass,z=u.property;t("PausePopup",(m=_("PausePopup"),y=z(s),k=z(s),w=z(l),P=z(l),T=z(r),O=z(c),m((S=n((B=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),u=0;u<e;u++)a[u]=arguments[u];return n=t.call.apply(t,[this].concat(a))||this,o(n,"popupPanel",S,i(n)),o(n,"backgroundOverlay",N,i(n)),o(n,"continueButton",G,i(n)),o(n,"newGameButton",V,i(n)),o(n,"soundToggle",q,i(n)),o(n,"titleLabel",A,i(n)),n.isVisible=!1,n.onContinueCallback=null,n.onNewGameCallback=null,n}e(n,t);var a=n.prototype;return a.start=function(){this.isVisible=!1,this.setupButtons(),this.hide(!1),this.enhanceVisualStyling()},a.setupButtons=function(){if(this.continueButton){this.setupButtonAnimations(this.continueButton);var t=new p;t.target=this.node,t.component="PausePopup",t.handler="onContinueClicked",this.continueButton.clickEvents.push(t)}if(this.newGameButton){this.setupButtonAnimations(this.newGameButton);var n=new p;n.target=this.node,n.component="PausePopup",n.handler="onNewGameClicked",this.newGameButton.clickEvents.push(n)}if(this.soundToggle){var e=new p;e.target=this.node,e.component="PausePopup",e.handler="onSoundToggled",this.soundToggle.checkEvents.push(e),this.soundToggle.isChecked=!0}},a.setupButtonAnimations=function(t){var n=t.node,e=n.scale.clone(),o=n.getComponent(h),i=o.color.clone();n.on(s.EventType.MOUSE_ENTER,(function(){d(n).to(.1,{scale:new g(1.1,1.1,1)},{easing:"quadOut"}).start(),d(o).to(.1,{color:new f(i.r+30,i.g+30,i.b+30,i.a)}).start()})),n.on(s.EventType.MOUSE_LEAVE,(function(){d(n).to(.1,{scale:e},{easing:"quadOut"}).start(),d(o).to(.1,{color:i}).start()})),n.on(s.EventType.TOUCH_START,(function(){d(n).to(.05,{scale:new g(.95,.95,1)},{easing:"quadOut"}).start()})),n.on(s.EventType.TOUCH_END,(function(){d(n).to(.1,{scale:new g(1.1,1.1,1)},{easing:"backOut"}).start()})),n.on(s.EventType.TOUCH_CANCEL,(function(){d(n).to(.1,{scale:e},{easing:"quadOut"}).start()}))},a.enhanceVisualStyling=function(){this.popupPanel&&d(this.popupPanel.getComponent(h)).to(2,{color:new f(255,255,255,255)}).to(2,{color:new f(255,240,200,255)}).union().repeatForever().start()},a.show=function(){if(!this.isVisible){if(this.isVisible=!0,this.node.active=!0,this.popupPanel)this.popupPanel.setScale(0,0,1),(this.popupPanel.getComponent(b)||this.popupPanel.addComponent(b)).opacity=0;if(this.backgroundOverlay)(this.backgroundOverlay.getComponent(b)||this.backgroundOverlay.addComponent(b)).opacity=0;if(this.backgroundOverlay){var t=this.backgroundOverlay.getComponent(b);d(t).to(.3,{opacity:255},{easing:"quadOut"}).start()}if(this.popupPanel){var n=this.popupPanel.getComponent(b);d(n).to(.2,{opacity:255},{easing:"quadOut"}).start(),d(this.popupPanel).to(.4,{scale:new g(1.2,1.2,1)},{easing:"backOut"}).to(.2,{scale:new g(1,1,1)},{easing:"quadOut"}).start()}}},a.hide=function(t){var n=this;if(void 0===t&&(t=!0),this.isVisible||!t)if(this.isVisible=!1,t){if(this.popupPanel){var e=this.popupPanel.getComponent(b)||this.popupPanel.addComponent(b);d(this.popupPanel).to(.3,{scale:new g(.8,.8,1)},{easing:"backIn"}).start(),d(e).to(.3,{opacity:0},{easing:"quadIn"}).start()}if(this.backgroundOverlay){var o=this.backgroundOverlay.getComponent(b)||this.backgroundOverlay.addComponent(b);d(o).to(.2,{opacity:0},{easing:"quadIn"}).call((function(){n.node.active=!1})).start()}else setTimeout((function(){n.node.active=!1}),300)}else this.node.active=!1},a.setCallbacks=function(t,n){this.onContinueCallback=t,this.onNewGameCallback=n},a.onContinueClicked=function(){var t=this;this.hide(),this.onContinueCallback&&setTimeout((function(){return t.onContinueCallback()}),300)},a.onNewGameClicked=function(){var t=this;this.hide(),this.onNewGameCallback&&setTimeout((function(){return t.onNewGameCallback()}),300)},a.onSoundToggled=function(){if(this.soundToggle){var t=this.soundToggle.isChecked;this.node.getComponentsInChildren(v).forEach((function(n){n.volume=t?1:0})),console.log("Sound toggled:",t?"ON":"OFF")}},a.isSoundEnabled=function(){return!this.soundToggle||this.soundToggle.isChecked},a.setSoundEnabled=function(t){this.soundToggle&&(this.soundToggle.isChecked=t,this.onSoundToggled())},a.onDestroy=function(){},n}(C)).prototype,"popupPanel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(B.prototype,"backgroundOverlay",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=n(B.prototype,"continueButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(B.prototype,"newGameButton",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(B.prototype,"soundToggle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(B.prototype,"titleLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=B))||E));a._RF.pop()}}}));

System.register("chunks:///_virtual/ProgressManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Singleton2.ts"],(function(e){var t,n,s,o,r,i,c;return{setters:[function(e){t=e.inheritsLoose,n=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy,o=e._decorator,r=e.EventTarget},function(e){i=e.GameConfig},function(e){c=e.Singleton}],execute:function(){var l;s._RF.push({},"a1b2cPU5fZ4kBI0VniQq83v","ProgressManager",void 0);var a=o.ccclass;e("ProgressManager",a("ProgressManager")(l=function(e){function s(){for(var t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(t=e.call.apply(e,[this].concat(s))||this).eventTarget=new r,t.currentScore=0,t.currentMilestone=0,t.moveLeft=0,t.totalMilestones=i.MilestoneSystem.milestoneThresholds.length,t.pendingMilestoneData=[],t}t(s,e);var o=s.prototype;return o.onLoad=function(){},o.onDestroy=function(){},o.addPendingScore=function(e,t){this.pendingMilestoneData.push({matchCount:e,matchSize:t})},o.processPendingScores=function(){if(0===this.pendingMilestoneData.length)return!1;for(var e,t=0,s=n(this.pendingMilestoneData);!(e=s()).done;){var o=e.value,r=o.matchCount*i.MilestoneSystem.pointsPerTile;o.matchSize>=5?r+=i.MilestoneSystem.bonusPoints.match5Plus:4===o.matchSize&&(r+=i.MilestoneSystem.bonusPoints.match4),t+=r}this.currentScore+=t,this.pendingMilestoneData=[];var c=this.checkMilestoneCompletion();return console.log("Processed pending scores, total points:",t,"currentScore:",this.currentScore),this.eventTarget.emit("progress-updated",this.getMilestoneData()),c},o.addScore=function(e,t){var n=e*i.MilestoneSystem.pointsPerTile;t>=5?n+=i.MilestoneSystem.bonusPoints.match5Plus:4===t&&(n+=i.MilestoneSystem.bonusPoints.match4),this.currentScore+=n;var s=this.checkMilestoneCompletion();return console.log("currentScore",this.currentScore),this.eventTarget.emit("progress-updated",this.getMilestoneData()),s},o.checkMilestoneCompletion=function(){if(this.currentMilestone>=this.totalMilestones)return!1;var e=i.MilestoneSystem.milestoneThresholds[this.currentMilestone];return this.currentScore>=e&&(this.currentMilestone++,this.eventTarget.emit("milestone-completed",this.getMilestoneData()),!0)},o.getMilestoneData=function(){var e=this.currentMilestone<this.totalMilestones?i.MilestoneSystem.milestoneThresholds[this.currentMilestone]:i.MilestoneSystem.milestoneThresholds[this.totalMilestones-1],t=this.currentMilestone>0?i.MilestoneSystem.milestoneThresholds[this.currentMilestone-1]:0,n=this.currentScore-t,s=e-t,o=Math.min(n/s,1);return{currentMilestone:this.currentMilestone,currentScore:this.currentScore,currentMilestoneProgress:o,milestoneThreshold:e,totalMilestones:this.totalMilestones}},o.onProgressUpdate=function(e){this.eventTarget.on("progress-updated",e)},o.onMilestoneCompleted=function(e){this.eventTarget.on("milestone-completed",e)},o.resetProgress=function(){this.currentScore=0,this.currentMilestone=0,this.moveLeft=0,this.pendingMilestoneData=[],this.eventTarget.emit("progress-updated",this.getMilestoneData())},o.getCurrentScore=function(){return this.currentScore},o.getCurrentMilestone=function(){return this.currentMilestone},o.getMoveLeft=function(){return this.moveLeft},s}(c))||l);s._RF.pop()}}}));

System.register("chunks:///_virtual/ProgressUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ProgressManager.ts"],(function(e){var r,o,s,t,n,i,a,l,c,g,h,d,u,p,b,B,L;return{setters:[function(e){r=e.applyDecoratedDescriptor,o=e.inheritsLoose,s=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){n=e.cclegacy,i=e._decorator,a=e.ProgressBar,l=e.Label,c=e.Node,g=e.Color,h=e.Vec2,d=e.tween,u=e.Vec3,p=e.UITransform,b=e.Sprite,B=e.Component},function(e){L=e.ProgressManager}],execute:function(){var f,w,m,S,k,C,M,v,y,P,z,I,O;n._RF.push({},"b2c3d4e5-f6g7-8901-2345-678901bcdefg","ProgressUI",void 0);var U=i.ccclass,D=i.property;e("ProgressUI",(f=U("ProgressUI"),w=D(a),m=D(l),S=D(l),k=D(l),C=D(c),f((y=r((v=function(e){function r(){for(var r,o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return r=e.call.apply(e,[this].concat(n))||this,s(r,"progressBar",y,t(r)),s(r,"milestoneLabel",P,t(r)),s(r,"scoreLabel",z,t(r)),s(r,"progressLabel",I,t(r)),s(r,"celebrationNode",O,t(r)),r.progressManager=null,r.scoreBackground=null,r.progressBackground=null,r.milestoneBackground=null,r}o(r,e);var n=r.prototype;return n.start=function(){this.progressManager=L.getInstance(),this.progressManager?(this.enhanceUIElements(),this.progressManager.onProgressUpdate(this.updateProgressDisplay.bind(this)),this.progressManager.onMilestoneCompleted(this.onMilestoneCompleted.bind(this)),this.updateProgressDisplay(this.progressManager.getMilestoneData())):console.error("ProgressManager not found")},n.enhanceUIElements=function(){this.enhanceScoreLabel(),this.enhanceMilestoneLabel(),this.enhanceProgressLabel(),this.enhanceProgressBar(),this.addUIBackgrounds()},n.enhanceScoreLabel=function(){this.scoreLabel&&(this.scoreLabel.color=new g(255,215,0,255),this.scoreLabel.fontSize=28,this.scoreLabel.isBold=!0,this.scoreLabel.enableOutline=!0,this.scoreLabel.outlineColor=new g(139,69,19,255),this.scoreLabel.outlineWidth=3,this.scoreLabel.enableShadow=!0,this.scoreLabel.shadowColor=new g(255,165,0,150),this.scoreLabel.shadowOffset=new h(0,0),this.scoreLabel.shadowBlur=8)},n.enhanceMilestoneLabel=function(){this.milestoneLabel&&(this.milestoneLabel.color=new g(147,0,211,255),this.milestoneLabel.fontSize=24,this.milestoneLabel.isBold=!0,this.milestoneLabel.enableOutline=!0,this.milestoneLabel.outlineColor=new g(255,255,255,255),this.milestoneLabel.outlineWidth=2,this.milestoneLabel.enableShadow=!0,this.milestoneLabel.shadowColor=new g(0,0,0,100),this.milestoneLabel.shadowOffset=new h(1,-1),this.milestoneLabel.shadowBlur=3)},n.enhanceProgressLabel=function(){this.progressLabel&&(this.progressLabel.color=new g(0,255,255,255),this.progressLabel.fontSize=22,this.progressLabel.isBold=!0,this.progressLabel.enableOutline=!0,this.progressLabel.outlineColor=new g(0,0,139,255),this.progressLabel.outlineWidth=2)},n.enhanceProgressBar=function(){if(this.progressBar){this.progressBar.barSprite&&this.updateProgressBarColor(this.progressBar.progress);var e=this.progressBar.node;e&&d(e).to(.3,{scale:new u(1.05,1.05,1)}).to(.3,{scale:new u(1,1,1)}).union().repeatForever().start()}},n.updateProgressBarColor=function(e){var r;if(null!=(r=this.progressBar)&&r.barSprite){var o;if(e<.3)o=new g(255,Math.floor(e/.3*165),0,255);else if(e<.7){var s=(e-.3)/.4;o=new g(255,Math.floor(165+90*s),0,255)}else{var t=(e-.7)/.3;o=new g(Math.floor(255-255*t),255,Math.floor(100*t),255)}this.progressBar.barSprite.color=o}},n.addUIBackgrounds=function(){this.createScoreBackground(),this.createMilestoneBackground(),this.createProgressBackground()},n.createScoreBackground=function(){var e;if(this.scoreLabel){this.scoreBackground=new c("ScoreBackground"),null==(e=this.scoreLabel.node.parent)||e.addChild(this.scoreBackground),this.scoreBackground.setPosition(this.scoreLabel.node.position),this.scoreBackground.setSiblingIndex(this.scoreLabel.node.getSiblingIndex()),this.scoreBackground.addComponent(p).setContentSize(120,50);var r=this.scoreBackground.addComponent(b);r.type=b.Type.SLICED,r.sizeMode=b.SizeMode.CUSTOM,r.color=new g(139,69,19,200),d(this.scoreBackground).to(1,{scale:new u(1.1,1.1,1)}).to(1,{scale:new u(1,1,1)}).union().repeatForever().start()}},n.createMilestoneBackground=function(){var e;if(this.milestoneLabel){this.milestoneBackground=new c("MilestoneBackground"),null==(e=this.milestoneLabel.node.parent)||e.addChild(this.milestoneBackground),this.milestoneBackground.setPosition(this.milestoneLabel.node.position),this.milestoneBackground.setSiblingIndex(this.milestoneLabel.node.getSiblingIndex()),this.milestoneBackground.addComponent(p).setContentSize(160,45);var r=this.milestoneBackground.addComponent(b);r.type=b.Type.SLICED,r.sizeMode=b.SizeMode.CUSTOM,r.color=new g(75,0,130,180)}},n.createProgressBackground=function(){var e;if(this.progressBar){this.progressBackground=new c("ProgressBackground"),null==(e=this.progressBar.node.parent)||e.addChild(this.progressBackground),this.progressBackground.setPosition(this.progressBar.node.position.x,this.progressBar.node.position.y+5),this.progressBackground.setSiblingIndex(this.progressBar.node.getSiblingIndex()),this.progressBackground.addComponent(p).setContentSize(220,60);var r=this.progressBackground.addComponent(b);r.type=b.Type.SLICED,r.sizeMode=b.SizeMode.CUSTOM,r.color=new g(25,25,112,150);var o=new c("ProgressBorder");this.progressBackground.addChild(o),o.addComponent(p).setContentSize(225,65);var s=o.addComponent(b);s.type=b.Type.SLICED,s.sizeMode=b.SizeMode.CUSTOM,s.color=new g(255,215,0,100)}},n.updateProgressDisplay=function(e){var r=this;if(this.progressBar){var o=e.currentMilestoneProgress;d(this.progressBar).to(.8,{progress:o},{easing:"quartOut",onUpdate:function(){r.updateProgressBarColor(r.progressBar.progress)}}).start()}if(this.milestoneLabel){var s="Level: "+(e.currentMilestone+1);this.milestoneLabel.string!==s&&this.animateTextChange(this.milestoneLabel,s)}if(this.scoreLabel){var t="Score: "+e.currentScore.toLocaleString();this.scoreLabel.string!==t&&this.animateScoreChange(this.scoreLabel,t)}if(this.progressLabel){var n=Math.floor(100*e.currentMilestoneProgress)+"%";this.progressLabel.string!==n&&this.animateTextChange(this.progressLabel,n)}},n.animateTextChange=function(e,r){d(e.node).to(.1,{scale:new u(1.3,1.3,1)}).call((function(){e.string=r})).to(.2,{scale:new u(1,1,1)},{easing:"backOut"}).start()},n.animateScoreChange=function(e,r){var o=e.color.clone(),s=new g(255,255,255,255);d(e).to(.1,{color:s}).to(.2,{color:o}).start(),d(e.node).to(.15,{scale:new u(1.4,1.4,1)}).call((function(){e.string=r})).to(.25,{scale:new u(1,1,1)},{easing:"elasticOut"}).start()},n.onMilestoneCompleted=function(e){this.playEnhancedCelebrationAnimation(),this.updateProgressDisplay(e)},n.playEnhancedCelebrationAnimation=function(){var e=this;this.celebrateScoreLabel(),this.celebrateMilestoneLabel(),this.celebrateProgressBar(),this.celebrationNode&&(this.celebrationNode.setScale(0,0,1),this.celebrationNode.active=!0,d(this.celebrationNode).to(.4,{scale:new u(1.3,1.3,1)},{easing:"backOut"}).to(.3,{scale:new u(1,1,1)},{easing:"quadOut"}).delay(2).to(.4,{scale:new u(0,0,1)},{easing:"backIn"}).call((function(){e.celebrationNode.active=!1})).start())},n.celebrateScoreLabel=function(){var e=this;if(this.scoreLabel){var r=this.scoreLabel.color.clone(),o=[new g(255,215,0,255),new g(255,255,255,255),new g(255,165,0,255),new g(255,215,0,255)],s=0;d(this.scoreLabel).repeat(4,d().call((function(){e.scoreLabel.color=o[s],s=(s+1)%o.length})).delay(.2)).call((function(){e.scoreLabel.color=r})).start()}},n.celebrateMilestoneLabel=function(){this.milestoneLabel&&d(this.milestoneLabel.node).to(.2,{scale:new u(1.5,1.5,1)}).to(.3,{scale:new u(1,1,1)},{easing:"bounceOut"}).start()},n.celebrateProgressBar=function(){var e,r=this;if(null!=(e=this.progressBar)&&e.barSprite){var o=this.progressBar.barSprite.color.clone(),s=[new g(255,0,0,255),new g(255,165,0,255),new g(255,255,0,255),new g(0,255,0,255),new g(0,0,255,255),new g(75,0,130,255),new g(238,130,238,255)],t=0;d(this.progressBar.barSprite).repeat(s.length,d().call((function(){r.progressBar.barSprite.color=s[t],t++})).delay(.15)).call((function(){r.progressBar.barSprite.color=o})).start()}},n.resetProgress=function(){this.progressManager&&this.progressManager.resetProgress()},n.onDestroy=function(){this.scoreBackground&&this.scoreBackground.isValid&&this.scoreBackground.destroy(),this.progressBackground&&this.progressBackground.isValid&&this.progressBackground.destroy(),this.milestoneBackground&&this.milestoneBackground.isValid&&this.milestoneBackground.destroy()},r}(B)).prototype,"progressBar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=r(v.prototype,"milestoneLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=r(v.prototype,"scoreLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=r(v.prototype,"progressLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=r(v.prototype,"celebrationNode",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=v))||M));n._RF.pop()}}}));

System.register("chunks:///_virtual/SelectState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileState.ts","./AnimationManager.ts"],(function(n){var t,e,a,i;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy},function(n){a=n.TileState},function(n){i=n.AnimationManager}],execute:function(){e._RF.push({},"f621dOHpPFLWbtXLt0mpO4n","SelectState",void 0);n("SelectState",function(n){function e(t){var e;return(e=n.call(this,t)||this).animationHandler=null,e.animationHandler=t.getComponent(i),e}t(e,n);var a=e.prototype;return a.onEnter=function(){var n;null==(n=this.animationHandler)||n.animateSelection()},a.onExit=function(){var n;null==(n=this.animationHandler)||n.animateDeselection()},a.onUpdate=function(){},a.onPlayerIdle=function(){var n;null==(n=this.animationHandler)||n.animatePlayerIdle()},e}(a));e._RF.pop()}}}));

System.register("chunks:///_virtual/singleton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,i;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,i=n.Component}],execute:function(){e._RF.push({},"f0d79BgePNIh6MBcfYXaFnz","singleton",void 0),n("Singleton",function(n){function e(){return n.apply(this,arguments)||this}return t(e,n),e.getInstance=function(){if(!e.instances.has(this)){var n=new this;e.instances.set(this,n),"function"==typeof n.initialize&&n.initialize()}return e.instances.get(this)},e.hasInstance=function(){return e.instances.has(this)},e.destroyInstance=function(){e.instances.delete(this)},e.getAllInstances=function(){return new Map(e.instances)},e.clearAllInstances=function(){e.instances.clear()},e.prototype.initialize=function(){},e.getCurrentInstance=function(){return e.instances.get(this)||null},e}(i)).instances=new Map,e._RF.pop()}}}));

System.register("chunks:///_virtual/SpecialTileConfig.ts",["cc"],(function(e){var o,i;return{setters:[function(e){o=e.cclegacy,i=e.Color}],execute:function(){o._RF.push({},"c1d2e3f4-g5h6-7890-1234-567890abcdef","SpecialTileConfig",void 0);var n=e("SpecialTileType",function(e){return e.NORMAL="normal",e.BOMB="bomb",e.RAINBOW="rainbow",e.STRIPED_HORIZONTAL="striped_horizontal",e.STRIPED_VERTICAL="striped_vertical",e.WRAPPED="wrapped",e}({}));e("SpecialTileConfig",{NORMAL:{type:n.NORMAL,name:"Normal",color:new i(255,255,255,255)},BOMB:{type:n.BOMB,name:"Bomb Candy",color:new i(128,128,128,255),effectRadius:1,activationSound:"bomb_explosion"},RAINBOW:{type:n.RAINBOW,name:"Rainbow Candy",color:new i(255,255,255,255),matchesAllColors:!0,activationSound:"rainbow_burst"},STRIPED_HORIZONTAL:{type:n.STRIPED_HORIZONTAL,name:"Horizontal Striped Candy",color:new i(255,255,255,255),direction:"horizontal",activationSound:"striped_activation"},STRIPED_VERTICAL:{type:n.STRIPED_VERTICAL,name:"Vertical Striped Candy",color:new i(255,255,255,255),direction:"vertical",activationSound:"striped_activation"},WRAPPED:{type:n.WRAPPED,name:"Wrapped Candy",color:new i(255,255,255,255),effectRadius:2,activationSound:"wrapped_explosion"}});o._RF.pop()}}}));

System.register("chunks:///_virtual/SpecialTileManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpecialTileConfig.ts","./GameConfig.ts","./BoardManager.ts","./ParticleEffectManager.ts"],(function(e){var t,r,i,a,n,o,c,l,s,u,f,d;return{setters:[function(e){t=e.inheritsLoose,r=e.asyncToGenerator,i=e.regeneratorRuntime,a=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,o=e._decorator,c=e.Component},function(e){l=e.SpecialTileType,s=e.SpecialTileConfig},function(e){u=e.GameConfig},function(e){f=e.BoardManager},function(e){d=e.ParticleEffectManager}],execute:function(){var p;n._RF.push({},"d2e3f4g5-h6i7-8901-2345-678901bcdefg","SpecialTileManager",void 0);var h=o.ccclass;e("SpecialTileManager",h("SpecialTileManager")(p=function(e){function n(){for(var t,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))||this).boardManager=null,t.particleEffectManager=null,t}t(n,e);var o=n.prototype;return o.onLoad=function(){this.boardManager=this.node.getComponent(f),this.particleEffectManager=this.node.getComponent(d)},o.determineSpecialTileType=function(e){return 4===e.length?l.BOMB:l.RAINBOW},o.createSpecialTile=function(){var e=r(i().mark((function e(t,r,n,o){var c,l,s,u,f,d,p,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.node&&t.node.isValid){e.next=2;break}return e.abrupt("return");case 2:t.setSpecialType(r),null==(c=this.particleEffectManager)||c.createTileParticleEffect(t,r),l=Array(),s=n.filter((function(e){return e.node&&e.node.isValid})).length,u=0,f=function(){++u>=s&&(null==o||o())},d=a(n);case 9:if((p=d()).done){e.next=16;break}if((h=p.value)&&h.node&&h.node.isValid){e.next=13;break}return e.abrupt("continue",14);case 13:l.push(h.playCombineEffect(t,(function(){f()})));case 14:e.next=9;break;case 16:return e.next=18,Promise.all(l);case 18:case"end":return e.stop()}}),e,this)})));return function(t,r,i,a){return e.apply(this,arguments)}}(),o.activateSpecialTile=function(e,t,r,i){if(void 0===i&&(i=!1),!e||!e.node||!e.node.isValid)return[];var a=e.getSpecialType(),n=this.boardManager.getTileGrid();if(console.log("Activating special tile:",a,"at coords:",r,"isPlayerSwap:",i),!r)return[];switch(a){case l.BOMB:return this.activateBombTile(r.x,r.y,n,e);case l.RAINBOW:return i?this.activateRainbowTile(e,t,n):[];case l.STRIPED_HORIZONTAL:return this.activateStripedTile(r.x,r.y,n,"horizontal");case l.STRIPED_VERTICAL:return this.activateStripedTile(r.x,r.y,n,"vertical");case l.WRAPPED:return this.activateWrappedTile(r.x,r.y,n,e);default:return[]}},o.activateBombTile=function(e,t,r,i){for(var a=[],n=s.BOMB.effectRadius||1,o=-n;o<=n;o++)for(var c=-n;c<=n;c++){var l=e+c,f=t+o;if(l>=0&&l<u.GridWidth&&f>=0&&f<u.GridHeight){var d=r[f][l];d&&d.node&&d.node.isValid&&a.push(d)}}return a},o.activateStripedTile=function(e,t,r,i){var a=[];if("horizontal"===i)for(var n=0;n<u.GridWidth;n++){var o=r[t][n];o&&o.node&&o.node.isValid&&a.push(o)}else for(var c=0;c<u.GridHeight;c++){var l=r[c][e];l&&l.node&&l.node.isValid&&a.push(l)}return a},o.activateWrappedTile=function(e,t,a,n){for(var o=this,c=[],l=s.WRAPPED.effectRadius||2,f=-1;f<=1;f++)for(var d=-1;d<=1;d++){var p=e+d,h=t+f;if(p>=0&&p<u.GridWidth&&h>=0&&h<u.GridHeight){var v=a[h][p];v&&v.node&&v.node.isValid&&c.push(v)}}return setTimeout(r(i().mark((function r(){var c,s,f,d,p,h,v,g;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(c=[],s=-l;s<=l;s++)for(f=-l;f<=l;f++)p=t+s,(d=e+f)>=0&&d<u.GridWidth&&p>=0&&p<u.GridHeight&&(h=a[p][d])&&h.node&&h.node.isValid&&c.push(h);if(!(o.particleEffectManager&&n.node&&n.node.parent)){r.next=6;break}return g=c.map((function(e){return e.node.worldPosition})),r.next=6,null==(v=o.particleEffectManager)?void 0:v.playMultipleEffects(g,"explosion",n.node.parent);case 6:case"end":return r.stop()}}),r)}))),300),c},o.activateRainbowTile=function(e,t,r){var i=[];if(t.isRainbowTile())return r.forEach((function(e){e.forEach((function(e){e&&e.node&&e.node.isValid&&i.push(e)}))})),i;for(var a=0;a<u.GridHeight;a++)for(var n=0;n<u.GridWidth;n++){var o=r[a][n];o&&t&&o.getTileType()===t.getTileType()&&i.push(o)}return i},n}(c))||p);n._RF.pop()}}}));

System.register("chunks:///_virtual/Tile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./SpecialTileConfig.ts","./IdleState.ts","./SelectState.ts","./GameGlobalData.ts","./AnimationManager.ts"],(function(e){var t,n,i,o,s,a,r,l,c,u,p,h,f,d,m,w,b,g,v,y,T,C,k,S,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose,a=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){l=e.cclegacy,c=e._decorator,u=e.Sprite,p=e.Prefab,h=e.resources,f=e.SpriteFrame,d=e.Color,m=e.UITransform,w=e.Vec3,b=e.Component,g=e.instantiate,v=e.ParticleSystem2D},function(e){y=e.GameConfig},function(e){T=e.SpecialTileType},function(e){C=e.IdleState},function(e){k=e.SelectState},function(e){S=e.GameGlobalData},function(e){M=e.AnimationManager}],execute:function(){var R,D,A,P,F,E,O;l._RF.push({},"df56acXknlGaYhEaXrwyRVa","Tile",void 0);var I=c.ccclass,L=c.property;e("Tile",(R=I("Tile"),D=L(u),A=L(p),R((E=t((F=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,i(t,"sprite",E,o(t)),i(t,"particleEffect",O,o(t)),t.tileType=y.CandyTypes[0],t.specialType=T.NORMAL,t.isRainbow=!1,t.callbacks=[],t.currentState=null,t.states=new Map,t.correspondingFrame=null,t.mouseDownPos=null,t.isMouseDownOnThis=!1,t.clickThreshold=10,t.onRainbowClickCallbacks=[],t}n(t,e);var l=t.prototype;return l.__preload=function(){if(!this.sprite)throw new Error("Sprite is required");if(!this.particleEffect)throw new Error("Particle effect is required")},l.onLoad=function(){this.states.set("idle",new C(this)),this.states.set("select",new k(this)),this.changeState("idle"),this.node.on("mouse-down",this.onMouseDown,this),this.node.on("mouse-enter",this.onMouseEnter,this),this.node.on("mouse-leave",this.onMouseLeave,this),this.node.on("mouse-up",this.onMouseUp,this)},l.addOnClickCallback=function(e){this.callbacks.push(e)},l.removeOnClickCallback=function(e){this.callbacks=e?this.callbacks.filter((function(t){return t!==e})):[]},l.addOnMouseDownCallback=function(e){this.callbacks.push(e)},l.removeOnMouseDownCallback=function(e){e&&(this.callbacks=this.callbacks.filter((function(t){return t!==e})))},l.addOnMouseUpCallback=function(e){this.callbacks.push(e)},l.removeOnMouseUpCallback=function(e){this.callbacks=e?this.callbacks.filter((function(t){return t!==e})):[]},l.addOnRainbowClickCallback=function(e){this.onRainbowClickCallbacks.push(e)},l.removeOnRainbowClickCallback=function(e){this.onRainbowClickCallbacks=e?this.onRainbowClickCallbacks.filter((function(t){return t!==e})):[]},l.emitOnMouseDown=function(){for(var e,t=s(this.callbacks);!(e=t()).done;){(0,e.value)(this)}},l.emitOnMouseUp=function(){for(var e,t=s(this.callbacks);!(e=t()).done;){(0,e.value)(this)}},l.getTileType=function(){return this.tileType},l.setTileType=function(e){this.tileType=e,this.updateTileAppearance()},l.getSpecialType=function(){return this.specialType},l.setSpecialType=function(e){this.specialType=e,this.isRainbow=e===T.RAINBOW,this.updateTileAppearance()},l.isSpecial=function(){return this.specialType!==T.NORMAL},l.setRainbowTile=function(e){this.isRainbow=e,this.updateTileAppearance()},l.isRainbowTile=function(){return this.isRainbow},l.canMatchWith=function(e){return!(!this.isRainbow&&!e.isRainbow)||this.tileType===e.tileType},l.updateTileAppearance=function(){this.isRainbow?this.updateRainbowAppearance():this.specialType===T.BOMB?this.updateBombAppearance():this.specialType===T.STRIPED_HORIZONTAL?this.updateStripedAppearance("horizontal"):this.specialType===T.STRIPED_VERTICAL?this.updateStripedAppearance("vertical"):this.specialType===T.WRAPPED?this.updateWrappedAppearance():this.updateNormalAppearance()},l.updateNormalAppearance=function(){var e=h.get("images/"+this.tileType.name+"/spriteFrame",f);if(!e)throw new Error("Sprite frame for "+this.tileType.name+" not found");this.sprite.spriteFrame=e,this.sprite.color=new d(255,255,255,255),this.sprite.node.getComponent(m).setContentSize(50,50)},l.updateBombAppearance=function(){var e=h.get("images/"+this.tileType.name+"/spriteFrame",f);e&&(this.sprite.spriteFrame=e),this.sprite.node.getComponent(m).setContentSize(50,50),console.log("updateBombAppearance",this.specialType)},l.updateStripedAppearance=function(e){var t=h.get("images/"+this.tileType.name+"/spriteFrame",f);t&&(this.sprite.spriteFrame=t),this.sprite.color=new d(200,200,255,255),this.sprite.node.getComponent(m).setContentSize(50,50)},l.updateWrappedAppearance=function(){var e=h.get("images/"+this.tileType.name+"/spriteFrame",f);e&&(this.sprite.spriteFrame=e),this.sprite.color=new d(255,255,200,255),this.sprite.node.getComponent(m).setContentSize(50,50)},l.updateRainbowAppearance=function(){this.sprite.color=new d(255,255,255,255);var e=h.get("images/Rainbow Candy/spriteFrame",f);e&&(this.sprite.spriteFrame=e),console.log("updateRainbowAppearance",this.specialType),this.sprite.node.getComponent(m).setContentSize(50,50)},l.changeState=function(e){var t;if(this.states){if(this.states.has(e)){var n=this.states.get(e);n?this.currentState!==n&&(null==(t=this.currentState)||t.onExit(),this.currentState=n,this.currentState.onEnter()):console.error("State "+e+" not found")}}else console.warn("Tile states not initialized or tile has been destroyed")},l.getCurrentStateName=function(){for(var e,t=s(this.states.entries());!(e=t()).done;){var n=e.value,i=n[0];if(n[1]===this.currentState)return i}return"unknown"},l.getSprite=function(){return this.sprite},l.setFrame=function(e){this.correspondingFrame=e},l.getFrame=function(){return this.correspondingFrame},l.onPlayerIdle=function(){var e;null==(e=this.currentState)||e.onPlayerIdle()},l.onMouseDown=function(e){this.isMouseDownOnThis=!0,this.mouseDownPos=new w(e.getLocationX(),e.getLocationY(),0),S.getInstance().setIsMouseDown(!0);for(var t,n=s(this.callbacks);!(t=n()).done;){(0,t.value)(this)}},l.onMouseEnter=function(e){if(this.correspondingFrame&&this.correspondingFrame.triggerMouseEnter(),S.getInstance().getIsMouseDown())for(var t,n=s(this.callbacks);!(t=n()).done;){(0,t.value)(this)}},l.onMouseLeave=function(e){this.correspondingFrame&&this.correspondingFrame.triggerMouseLeave()},l.onMouseUp=function(e){var t=this.isMouseDownOnThis;if(this.isMouseDownOnThis=!1,t&&this.mouseDownPos&&this.isRainbowTile()){var n=new w(e.getLocationX(),e.getLocationY(),0);if(w.distance(this.mouseDownPos,n)<=this.clickThreshold){for(var i,o=s(this.onRainbowClickCallbacks);!(i=o()).done;){(0,i.value)(this)}return this.mouseDownPos=null,void S.getInstance().setIsMouseDown(!1)}}this.mouseDownPos=null;for(var a,r=s(this.callbacks);!(a=r()).done;){(0,a.value)(this)}S.getInstance().setIsMouseDown(!1)},l.onDestroy=function(){var e;this.callbacks=[],this.onRainbowClickCallbacks=[],this.node&&this.node.isValid&&(this.node.off("mouse-down",this.onMouseDown,this),this.node.off("mouse-enter",this.onMouseEnter,this),this.node.off("mouse-leave",this.onMouseLeave,this),this.node.off("mouse-up",this.onMouseUp,this)),null==(e=this.currentState)||e.onExit()},l.playParticleEffect=function(){var e=a(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(!n.particleEffect||!n.node||!n.node.isValid)return console.warn("Particle effect prefab is not assigned or node is invalid"),null==t||t(),void e();var i=g(n.particleEffect);n.node.parent.addChild(i),i.setPosition(n.node.getPosition());var o=i.getComponent(v);o&&(o.startColor=n.tileType.color,o.startColorVar=new d(0,0,0,255),o.endColor=n.tileType.color,o.endColorVar=new d(0,0,0,255),o.playOnLoad=!0),null==t||t(),e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l.playDestroyAnimation=function(e){var t=this;return new Promise((function(n){if(!t.node||!t.node.isValid)return console.warn("Cannot play destroy animation: node is null or invalid"),null==e||e(),void n();var i=t.node.getComponent(M);i?i.animateDestroy(e,n):(console.warn("AnimationManager not found on tile node"),null==e||e(),n())}))},l.playCombineEffect=function(e,t){var n=this;return new Promise((function(i){if(!(n.node&&n.node.isValid&&e.node&&e.node.isValid))return console.warn("Cannot play combine effect: node is null or invalid"),null==t||t(),void i();var o=n.node.getComponent(M);o?o.animateCombine(n,e,t,i):(console.warn("AnimationManager not found on tile node"),null==t||t(),i())}))},t}(b)).prototype,"sprite",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(F.prototype,"particleEffect",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=F))||P));l._RF.pop()}}}));

System.register("chunks:///_virtual/TileState.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"ea6eexfy39MQLyAmofkj/wD","TileState",void 0);t("TileState",(function(t){this.tile=void 0,this.tile=t}));e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});